{"version":3,"sources":["app.js","controllers.js","winners.js","directives.js","services.js","utils.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1iCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACr8FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3sDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3kBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["function loadScript(url, callback) {\r\n\r\n    var script = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n\r\n    script.onload = function () {\r\n        callback();\r\n    };\r\n    script.src = url;\r\n    document.getElementsByTagName('head')[0].appendChild(script);\r\n}\r\n\r\n/*if (window.chrome && window.chrome.cookies) {\r\n    loadScript('/pushwoosh-web-pushes-http-sdk.js?pw_application_code=73409-786EB', function () {\r\n    })\r\n} else {\r\n    loadScript('/pushwoosh-web-notifications.js', function () {\r\n    })\r\n}*/\r\n\r\n\r\n// jQuery.noConflict();\r\njQuery(document).foundation();\r\njQuery(document).ready(function (jQuery) {\r\n    'use strict';\r\n    //back to top\r\n    var backtotop = '#back-to-top';\r\n    if (jQuery(backtotop).length) {\r\n        var scrollTrigger = 100, // px\r\n            backToTop = function () {\r\n                var scrollTop = jQuery(window).scrollTop();\r\n                if (scrollTop > scrollTrigger) {\r\n                    jQuery(backtotop).addClass('show');\r\n                } else {\r\n                    jQuery(backtotop).removeClass('show');\r\n                }\r\n            };\r\n        backToTop();\r\n        jQuery(window).on('scroll', function () {\r\n            backToTop();\r\n        });\r\n        jQuery('#back-to-top').on('click', function (e) {\r\n            e.preventDefault();\r\n            jQuery('html,body').animate({\r\n                scrollTop: 0\r\n            }, 700);\r\n        });\r\n    }\r\n    \r\n    //register form\r\n    jQuery('div.social-login').mouseenter(function () {\r\n        jQuery('i.arrow-left').addClass('active');\r\n    }).mouseleave(function () {\r\n        jQuery('i.arrow-left').removeClass('active');\r\n    });\r\n    jQuery('div.register-form').mouseenter(function () {\r\n        jQuery('i.arrow-right').addClass('active');\r\n    }).mouseleave(function () {\r\n        jQuery('i.arrow-right').removeClass('active');\r\n    });\r\n\r\n    //vertical thumb slider\r\n    var thumb = jQuery('.thumb-slider .thumbs').find('.ver-thumbnail');\r\n    jQuery(thumb).on('click', function () {\r\n        var id = jQuery(this).attr('id');\r\n        //alert(id);\r\n        jQuery('.image').eq(0).show();\r\n        jQuery('.image').hide();\r\n        jQuery('.image').hide();\r\n        jQuery('.' + id).fadeIn();\r\n    });\r\n    var $par = jQuery('.thumb-slider .thumbs .thumbnails').scrollTop(0);\r\n    jQuery('.thumb-slider .thumbs a').click(function (e) {\r\n        e.preventDefault();                      // Prevent defautl Anchors behavior\r\n        var n = jQuery(this).hasClass('down') ? '+=200' : '-=200'; // Direction\r\n        $par.animate({scrollTop: n});\r\n    });\r\n});\r\n(function () {\r\n    'use strict';\r\n    angular.module('underscore', [])\r\n        .factory('_', function () {\r\n            return window.___; // assumes underscore has already been loaded on the page\r\n        });\r\n\r\n    angular\r\n        .module('IndieWise', [\r\n            'templates',\r\n            'ngIntercom',\r\n            'ngMaterial',\r\n            'ngSanitize',\r\n            'mm.foundation',\r\n            'angucomplete-alt',\r\n            'ngMessages',\r\n            'ngResource',\r\n            'ngWebSocket',\r\n            'angular-cloudinary',\r\n            'underscore',\r\n            'angularMoment',\r\n            'videosharing-embed',\r\n            'angular-loading-bar',\r\n            'LocalForageModule',\r\n            'ui.router',\r\n            'angular-google-analytics',\r\n            'angular-iscroll',\r\n            'ui.scroll',\r\n            'ui.scroll.jqlite',\r\n            'ngFileUpload',\r\n            'satellizer',\r\n            'angular-filepicker',\r\n            'pascalprecht.translate',\r\n            '720kb.socialshare',\r\n            'ngAnimate-animate.css',\r\n            'vjs.video',\r\n\r\n            // Videogular\r\n            // 'com.2fdevs.videogular',\r\n            // 'com.2fdevs.videogular.plugins.controls',\r\n            // 'com.2fdevs.videogular.plugins.overlayplay',\r\n            // 'com.2fdevs.videogular.plugins.poster',\r\n            // 'com.2fdevs.videogular.plugins.buffering',\r\n            // 'info.vietnamcode.nampnq.videogular.plugins.youtube',\r\n            // 'videogular.plugins.texttrack',\r\n            // 'videogular.plugins.vimeo',\r\n            // 'th.co.softever.videogular.plugins.quality',\r\n\r\n\r\n            'IndieWise.controllers',\r\n            'IndieWise.services',\r\n            'IndieWise.directives',\r\n            'IndieWise.filters',\r\n            'IndieWise.utilities',\r\n\r\n            // Modularity\r\n            'IndieWise.winners'\r\n        ])\r\n        .constant('moment', window.momentTimeZone)\r\n        .constant('angularMomentConfig', { timezone: 'UTC' })\r\n        .constant('API', window.API || '/api/')\r\n        .constant('BASE', window.BASE || BASE + 'public/')\r\n        .constant('INTERCOM_APPID', 'ppp65byn')\r\n        .config(['$authProvider', function ($authProvider) {\r\n            $authProvider.loginUrl = '/api/login';\r\n            $authProvider.signupUrl = '/api/register';\r\n\r\n            $authProvider.facebook({\r\n                clientId: '150687055270744'\r\n            });\r\n\r\n            $authProvider.google({\r\n                clientId: '322274582930-4m1dueb708gvdic28n12e5dhqq121a6b.apps.googleusercontent.com'\r\n            });\r\n\r\n            $authProvider.twitter({\r\n                clientId: 'nnSvvHd86gBpxPwJaLGvzM2Mm'\r\n            });\r\n        }])\r\n        .config(['$intercomProvider', 'INTERCOM_APPID', function($intercomProvider, INTERCOM_APPID) {\r\n            // Either include your app_id here or later on boot\r\n            $intercomProvider\r\n                .appID(INTERCOM_APPID);\r\n\r\n            // you can include the Intercom's script yourself or use the built in async loading feature\r\n            $intercomProvider\r\n                .asyncLoading(true)\r\n        }])\r\n        /*.config(['flowFactoryProvider', function (flowFactoryProvider) {\r\n            flowFactoryProvider.defaults = {\r\n                //target: 'utils/upload.php',\r\n                query: {\r\n                    upload_preset: 'r0kuyqef'\r\n                },\r\n                target: 'https://api.cloudinary.com/v1_1/indiewise/upload',\r\n                permanentErrors: [404, 500, 501],\r\n                maxChunkRetries: 1,\r\n                chunkRetryInterval: 5000,\r\n                simultaneousUploads: 1,\r\n                singleFile: true\r\n            };\r\n            /!*flowFactoryProvider.on('catchAll', function (event) {\r\n             console.log('catchAll', arguments);\r\n             })*!/\r\n        }])*/\r\n        .config(['filepickerProvider', function (filepickerProvider) {\r\n            filepickerProvider.setKey('APbjTx44SlSuCI6P58jwvz');\r\n        }])\r\n        .config(['cloudinaryProvider', function (cloudinaryProvider) {\r\n            cloudinaryProvider.config({\r\n                upload_endpoint: 'https://api.cloudinary.com/v1_1/', // default\r\n                cloud_name: 'indiewise', // required\r\n                upload_preset: 'r0kuyqef', // optional\r\n            });\r\n\r\n            /*cloudinaryProvider\r\n                .set('cloud_name', 'indiewise')\r\n                .set('upload_preset', 'r0kuyqef');*/\r\n        }])\r\n        .config(['$compileProvider', function ($compileProvider) {\r\n            // significant performance boost\r\n            $compileProvider.debugInfoEnabled(false);\r\n        }])\r\n        .config(['AnalyticsProvider', function (AnalyticsProvider) {\r\n            // Add configuration code as desired - see below\r\n            AnalyticsProvider\r\n                .setAccount('UA-27155404-17')\r\n                // Remove prefix on launch\r\n                // .trackPrefix('alpha')\r\n                ;\r\n        }])\r\n        .config(['$httpProvider', function ($httpProvider) {\r\n            $httpProvider.interceptors.push('authInterceptor');\r\n        }])\r\n        .factory('authInterceptor', ['$q', '$injector', '$location', 'API', function ($q, $injector, $location, API) {\r\n            function retryHttpRequest(config, deferred){\r\n                function successCallback(response){\r\n                    deferred.resolve(response);\r\n                }\r\n                function errorCallback(response){\r\n                    deferred.reject(response);\r\n                }\r\n                var $http = $injector.get('$http');\r\n                $http(config).then(successCallback, errorCallback);\r\n            }\r\n\r\n            return {\r\n                'request': function (config) {\r\n                    config.headers = config.headers || {};\r\n                    return config;\r\n                },\r\n                'response': function (response) {\r\n                    // only contains 'content-type' and 'cache-control'\r\n                    // console.log(response.headers());\r\n                    return response;\r\n                },\r\n                'responseError': function (response) {\r\n\r\n                    if (response.status === 401 || response.status === 403) {\r\n                        //$location.path('/sign-in');\r\n                    } else if (response.status == 500 && response.config.url.indexOf('http') === -1 && response.config.url.indexOf('/api') > -1) {\r\n                        var deferred = $q.defer();\r\n                        //retryHttpRequest(response.config, deferred);\r\n                        return deferred.promise;\r\n                    }\r\n\r\n                    return response;\r\n                }\r\n            };\r\n        }])\r\n\r\n        .config(['$mdThemingProvider', '$mdIconProvider', 'BASE', function ($mdThemingProvider, $mdIconProvider, BASE) {\r\n            $mdThemingProvider.theme('default')\r\n                .primaryPalette('grey')\r\n                .accentPalette('indigo').dark();;\r\n\r\n            // Emoticons\r\n            $mdIconProvider\r\n                .icon('emotion', BASE + 'assets/svg/emotion.svg', 120)\r\n                .icon('angry', BASE + 'assets/svg/emoticons/angry.svg', 120)\r\n                .icon('annoyed', BASE + 'assets/svg/emoticons/annoyed.svg', 120)\r\n                .icon('big-smile', BASE + 'assets/svg/emoticons/big-smile.svg', 120)\r\n                .icon('bored', BASE + 'assets/svg/emoticons/bored.svg', 120)\r\n                .icon('confused', BASE + 'assets/svg/emoticons/confused.svg', 120)\r\n                .icon('crying', BASE + 'assets/svg/emoticons/crying.svg', 120)\r\n                .icon('disappointed', BASE + 'assets/svg/emoticons/disappointed.svg', 120)\r\n                .icon('emotional', BASE + 'assets/svg/emoticons/emotional.svg', 120)\r\n                .icon('grinning', BASE + 'assets/svg/emoticons/grinning.svg', 120)\r\n                .icon('happy', BASE + 'assets/svg/emoticons/happy.svg', 120)\r\n                .icon('hehe', BASE + 'assets/svg/emoticons/hehe.svg', 120)\r\n                .icon('hopeful', BASE + 'assets/svg/emoticons/hopeful.svg', 120)\r\n                .icon('interested', BASE + 'assets/svg/emoticons/interested.svg', 120)\r\n                .icon('joking', BASE + 'assets/svg/emoticons/joking.svg', 120)\r\n                .icon('kiss', BASE + 'assets/svg/emoticons/kiss.svg', 120)\r\n                .icon('love', BASE + 'assets/svg/emoticons/love.svg', 120)\r\n                .icon('mad', BASE + 'assets/svg/emoticons/mad.svg', 120)\r\n                .icon('meh', BASE + 'assets/svg/emoticons/meh.svg', 120)\r\n                .icon('mute', BASE + 'assets/svg/emoticons/mute.svg', 120)\r\n                .icon('nerdy', BASE + 'assets/svg/emoticons/nerdy.svg', 120)\r\n                .icon('neutral', BASE + 'assets/svg/emoticons/neutral.svg', 120)\r\n                .icon('ninja', BASE + 'assets/svg/emoticons/ninja.svg', 120)\r\n                .icon('nostalgic', BASE + 'assets/svg/emoticons/nostalgic.svg', 120)\r\n                .icon('oh-really', BASE + 'assets/svg/emoticons/oh-really.svg', 120)\r\n                .icon('sad', BASE + 'assets/svg/emoticons/sad.svg', 120)\r\n                .icon('sad-tear', BASE + 'assets/svg/emoticons/sad-tear.svg', 120)\r\n                .icon('sarcastic', BASE + 'assets/svg/emoticons/sarcastic.svg', 120)\r\n                .icon('sexy', BASE + 'assets/svg/emoticons/sexy.svg', 120)\r\n                .icon('shocked', BASE + 'assets/svg/emoticons/shocked.svg', 120)\r\n                .icon('silent', BASE + 'assets/svg/emoticons/silent.svg', 120)\r\n                .icon('silly', BASE + 'assets/svg/emoticons/silly.svg', 120)\r\n                .icon('smile', BASE + 'assets/svg/emoticons/smile.svg', 120)\r\n                .icon('sympathetic', BASE + 'assets/svg/emoticons/sympathetic.svg', 120)\r\n                .icon('wink', BASE + 'assets/svg/emoticons/wink.svg', 120)\r\n                .icon('woah', BASE + 'assets/svg/emoticons/woah.svg', 120)\r\n\r\n                // Other\r\n                .icon('matureSmall', BASE + 'assets/svg/OFLC_small_M.svg', 120)\r\n                .icon('matureSmall', BASE + 'assets/svg/OFLC_small_M.svg', 120)\r\n                .icon('trophy', BASE + 'assets/svg/trophy.svg', 120)\r\n                .icon('matureLarge', BASE + 'assets/svg/OFLC_large_M.svg', 120);\r\n        }])\r\n        .config(['$stateProvider', '$urlRouterProvider', '$locationProvider', 'BASE', function ($stateProvider, $urlRouterProvider, $locationProvider, BASE) {\r\n\r\n            $urlRouterProvider.when('', '/home');\r\n            $urlRouterProvider.when('/', '/home');\r\n            $stateProvider\r\n                .state('home', {\r\n                    url: '/home',\r\n                    authenticate: false,\r\n                    templateUrl: 'home/view/index.html',\r\n                    controller: 'HomeCtrl as Home'\r\n                })\r\n                .state('browse', {\r\n                    url: '/browse?q&sort&types&genres',\r\n                    authenticate: false,\r\n                    templateUrl: 'browse/view/index.html',\r\n                    controller: 'BrowseCtrl as Browse'\r\n                })\r\n                .state('latest', {\r\n                    url: '/latest',\r\n                    authenticate: false,\r\n                    templateUrl: 'latest/view/index.html',\r\n                    controller: 'LatestCtrl as LC'\r\n                })\r\n                .state('winners', {\r\n                    url: '/winners',\r\n                    authenticate: false,\r\n                    templateUrl: 'winners/index.html',\r\n                    controller: 'WinnersCtrl as WC'\r\n                })\r\n                .state('video_critique', {\r\n                    url: '/{video_url_id}/critique/{url_id}',\r\n                    authenticate: false,\r\n                    templateUrl: 'common/critique.html',\r\n                    controller: 'VideoCritiqueCtrl as VCC',\r\n                    resolve: {\r\n                        Critique: ['$stateParams', 'DataService', function ($stateParams, DataService) {\r\n                            return DataService.item('critiques', $stateParams.url_id, 'project.owner').then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('video_critique-edit', {\r\n                    url: '/{video_url_id}/critique/{url_id}/edit',\r\n                    authenticate: true,\r\n                    templateUrl: 'common/critique-edit.html',\r\n                    controller: 'VideoCritiqueEditCtrl',\r\n                    resolve: {\r\n                        Critique: ['AuthService', '$stateParams', 'DataService', function (AuthService, $stateParams, DataService) {\r\n                            return DataService.item('critiques', $stateParams.url_id, 'project.owner').then(function (result) {\r\n                                return (AuthService.isAuthenticated() && result.data.data.user_id === AuthService.currentUser.id) ? result : 'Not Owner';\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                // Authenticated Pages\r\n                .state('user', {\r\n                    url: '/user/{url_id}',\r\n                    authenticate: true,\r\n                    abstract: true,\r\n                    templateUrl: 'auth/user.html',\r\n                    controller: 'UserCtrl as UserC',\r\n                    resolve: {\r\n                        User: ['$stateParams', 'DataService', function ($stateParams, DataService) {\r\n                            return DataService.item('users', $stateParams.url_id).then(function (result) {\r\n                                return result.data.data;\r\n                            });\r\n                        }],\r\n                        UserStats: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.item('users/countUserStats', User.id).then(function (response) {\r\n                                return response.data;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('user.about', {\r\n                    url: '/about',\r\n                    templateUrl: 'auth/user-about.html',\r\n                    controller: 'UserAboutController as UserAboutCtrl'\r\n                })\r\n                .state('user.videos', {\r\n                    url: '/videos',\r\n                    templateUrl: 'auth/user-videos.html',\r\n                    controller: 'UserVideosController as UserVideosCtrl',\r\n                    resolve: {\r\n                        Videos: ['User', 'DataService', '$q', function (User, DataService, $q) {\r\n                            return DataService.collection('projects', {\r\n                                owner: User.id,\r\n                                sort: 'created_at',\r\n                                per_page: 50\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('user.critiques', {\r\n                    url: '/critiques',\r\n                    templateUrl: 'auth/user-critiques.html',\r\n                    controller: 'UserCritiquesController as UserCritiquesCtrl',\r\n                    resolve: {\r\n                        Critiques: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('critiques', {user: User.id, include: 'project'})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Critiqued: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('critiques', {notUser: User.id, include: 'project'})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('user.reactions', {\r\n                    url: '/reactions',\r\n                    templateUrl: 'auth/user-reactions.html',\r\n                    controller: 'UserReactionsController as UserReactionsCtrl',\r\n                    resolve: {\r\n                        Reactions: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('reactions', {user: User.id, include: 'user,project'})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Reacted: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('reactions', {notUser: User.id, include: 'user,project'})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('user.awards', {\r\n                    url: '/awards',\r\n                    templateUrl: 'auth/user-awards.html',\r\n                    controller: 'UserAwardsController as UserAwardsCtrl',\r\n                    resolve: {\r\n                        Awards: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('wins', {user: User.id}).then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }],\r\n                        Nominations: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('nominations', {\r\n                                user: User.id,\r\n                                include: 'user,project,award'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Nominated: ['User', 'DataService', function (User, DataService) {\r\n                            return DataService.collection('nominations', {\r\n                                notUser: User.id,\r\n                                include: 'user,project,award'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile', {\r\n                    url: '/profile',\r\n                    authenticate: true,\r\n                    abstract: true,\r\n                    templateUrl: 'auth/profile.html',\r\n                    controller: 'ProfileCtrl as Profile',\r\n                    resolve: {\r\n                        User: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.item('users', AuthService.currentUser.id, { include: 'genres' }).then(function (response) {\r\n                                return response.data.data;\r\n                            });\r\n                            /*return AuthService.getCurrentUser().then(function (response) {\r\n                                return response;\r\n                            });*/\r\n                        }],\r\n                        UserStats: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('users/countUserStats').then(function (response) {\r\n                                return response.data;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.about', {\r\n                    url: '/about',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-about.html',\r\n                    controller: 'ProfileAboutController as ProfileAboutCtrl'\r\n                })\r\n                .state('profile.upload', {\r\n                    url: '/upload',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-upload.html',\r\n                    controller: 'ProfileUploadController as UC',\r\n                    resolve: {\r\n                        Access: ['$rootScope', 'DataService', 'AuthService', '$q', function ($rootScope, DataService, AuthService, $q) {\r\n                            var deferred = $q.defer();\r\n                            if ($rootScope.isNotVerified()) {\r\n                                $rootScope.toastAction('Please verify your account so you can upload videos! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                                deferred.reject(false);\r\n                            } else {\r\n                                DataService.collection('projects/limit').then(function (response) {\r\n                                    if (response.data.status) {\r\n                                        deferred.resolve(true);\r\n                                    } else {\r\n                                        $rootScope.toastMessage('Your upload limit of 3 has been reached');\r\n                                        deferred.reject(false);\r\n                                    }\r\n                                });\r\n                            }\r\n                            return deferred.promise;\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.videos', {\r\n                    url: '/videos',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-videos.html',\r\n                    controller: 'ProfileVideosController as ProfileVideosCtrl',\r\n                    resolve: {\r\n                        Videos: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('projects', {\r\n                                owner: AuthService.currentUser.id,\r\n                                sort: 'created_at',\r\n                                per_page: 50\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.videos-edit', {\r\n                    url: '/videos/{url_id}/edit',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-videos-edit.html',\r\n                    controller: 'ProfileVideoEditCtrl as VEC',\r\n                    resolve: {\r\n                        Project: ['AuthService', '$stateParams', 'DataService', function (AuthService, $stateParams, DataService) {\r\n                            return DataService.item('projects', $stateParams.url_id).then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.critiques', {\r\n                    url: '/critiques',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-critiques.html',\r\n                    controller: 'ProfileCritiquesController as ProfileCritiquesCtrl',\r\n                    resolve: {\r\n                        Critiques: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('critiques', {user: AuthService.currentUser.id})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Critiqued: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('critiques', {notUser: AuthService.currentUser.id})\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.reactions', {\r\n                    url: '/reactions',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-reactions.html',\r\n                    controller: 'ProfileReactionsController as ProfileReactionsCtrl',\r\n                    resolve: {\r\n                        Reactions: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('reactions', {\r\n                                user: AuthService.currentUser.id,\r\n                                include: 'user,project'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Reacted: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('reactions', {\r\n                                notUser: AuthService.currentUser.id,\r\n                                include: 'user,project'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.awards', {\r\n                    url: '/awards',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-awards.html',\r\n                    controller: 'ProfileAwardsController as ProfileAwardsCtrl',\r\n                    resolve: {\r\n                        Awards: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('wins', {user: AuthService.currentUser.id}).then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }],\r\n                        Nominations: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('nominations', {\r\n                                user: AuthService.currentUser.id,\r\n                                include: 'user,project,award'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }],\r\n                        Nominated: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('nominations', {\r\n                                notUser: AuthService.currentUser.id,\r\n                                include: 'user,project,award'\r\n                            })\r\n                                .then(function (result) {\r\n                                    return result;\r\n                                });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.playlists', {\r\n                    url: '/playlists',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-playlists.html',\r\n                    controller: 'ProfilePlaylistsController as ProfilePlaylistsCtrl',\r\n                    resolve: {\r\n                        Playlists: ['AuthService', 'DataService', function (AuthService, DataService) {\r\n                            return DataService.collection('playlists').then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('profile.settings', {\r\n                    url: '/settings',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/profile-settings.html',\r\n                    controller: 'ProfileSettingsController as PSC',\r\n                    resolve: {\r\n                        Genres: ['AuthService', 'DataService', '$q', function (AuthService, DataService, $q) {\r\n                            return DataService.collection('genres', [],\r\n                                [{fieldName: 'user', operator: 'in', value: AuthService.currentUser.id}],\r\n                                20, false, false, 1).then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }],\r\n                        UserTypes: ['AuthService', 'DataService', '$q', function (AuthService, DataService, $q) {\r\n                            return DataService.collection('types', [],\r\n                                [{fieldName: 'user', operator: 'in', value: AuthService.currentUser.id}],\r\n                                20, false, false, 1).then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('messages', {\r\n                    url: '/messages',\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/messages.html',\r\n                    controller: 'MessagesCtrl as Msgs',\r\n                    resolve: {\r\n                        Conversations: ['AuthService', 'DataService', '$q', function (AuthService, DataService, $q) {\r\n                            return DataService.collection('messages').then(function (result) {\r\n                                return result;\r\n                            });\r\n                        }]\r\n                    }\r\n                })\r\n                .state('messages.message', {\r\n                    authenticate: true,\r\n                    templateUrl: 'auth/messages.html',\r\n                    controller: 'MessagesCtrl as Msgs'\r\n                })\r\n                /*.state('notifications', {\r\n                 url: '/notifications',\r\n                 authenticate: true,\r\n                 templateUrl: 'auth/notifications.html',\r\n                 controller: 'NotificationsCtrl as NC'\r\n                 })*/\r\n\r\n                // Auth Pages\r\n                .state('register', {\r\n                    url: '/register',\r\n                    authenticate: false,\r\n                    templateUrl: 'auth/register.html',\r\n                    controller: 'RegisterCtrl as RC'\r\n                })\r\n                .state('sign_in', {\r\n                    url: '/sign-in?redirect',\r\n                    authenticate: false,\r\n                    templateUrl: 'auth/sign-in.html',\r\n                    controller: 'SignInCtrl as SIC'\r\n                })\r\n                .state('reset_password', {\r\n                    url: '/reset-password?email&token',\r\n                    authenticate: false,\r\n                    templateUrl: 'auth/reset-password.html',\r\n                    controller: 'ForgotPasswordCtrl as FPC'\r\n                })\r\n\r\n                // Static Pages\r\n                .state('about', {\r\n                    url: '/about',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/about.html'\r\n                })\r\n                .state('faq', {\r\n                    url: '/faq',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/faq.html'\r\n                })\r\n                .state('contact', {\r\n                    url: '/contact?email',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/contact.html',\r\n                    controller: 'ContactPageCtrl as CC'\r\n                })\r\n                .state('tos', {\r\n                    url: '/terms-of-service',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/tos.html'\r\n                })\r\n                .state('advertise', {\r\n                    url: '/advertise',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/advertise.html'\r\n                })\r\n                .state('privacy', {\r\n                    url: '/privacy-policy',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/privacy.html'\r\n                })\r\n                .state('404', {\r\n                    url: '/404',\r\n                    authenticate: false,\r\n                    templateUrl: 'static/404.html'\r\n                })\r\n\r\n                // Video Pages\r\n                .state('video', {\r\n                    url: '/{url_id:[0-9a-zA-Z]{1,13}}',\r\n                    authenticate: false,\r\n                    templateUrl: 'common/video.html',\r\n                    controller: 'VideoCtrl as VC',\r\n                    resolve: {\r\n                        Project: ['$stateParams', 'DataService', '$q', function ($stateParams, DataService, $q) {\r\n                            var deferred = $q.defer();\r\n                            DataService.item('projects', $stateParams.url_id, '')\r\n                                .then(function (result) {\r\n                                    deferred.resolve(result.data.data);\r\n                                })\r\n                                .catch(function (response) {\r\n                                    deferred.reject(response);\r\n                                });\r\n\r\n                            return deferred.promise;\r\n                        }]\r\n                    }\r\n                })\r\n            ;\r\n\r\n            // $urlRouterProvider.otherwise('/404');\r\n            $locationProvider.html5Mode({\r\n                enabled: true,\r\n                requireBase: false,\r\n                rewriteLinks: false\r\n            });\r\n\r\n        }])\r\n        .config(['$transitionsProvider', function($transitionsProvider) {\r\n            $transitionsProvider.onError({}, function(transition) {\r\n                // debugger;\r\n                transition.promise.catch(function(error) {\r\n                    // debugger;\r\n                    console.error(error);\r\n                });\r\n            });\r\n        }])\r\n        .constant('StreamConfig', {\r\n            streamApiKey: '97wfnrargt9f',\r\n            streamApiSecret: '4t8dpp9bsap2svjhvu2n4x3h3bvwyyb3kgvg7san3bab2esu6vmnquffq2u95z82',\r\n            streamApp: '6408'\r\n        })\r\n        .run(['$rootScope', '$state', '$stateParams', 'AuthService', 'UtilsService', 'DataService', '$http', '$timeout', '$transitions', 'StreamConfig', 'anchorSmoothScroll', 'amMoment', '$intercom', 'FacebookAngularPatch', 'socket',\r\n            function ($rootScope, $state, $stateParams, AuthService, UtilsService, DataService, $http, $timeout, $transitions, StreamConfig, anchorSmoothScroll, amMoment, $intercom, FacebookAngularPatch, socket) {\r\n                attachFastClick(document.body);\r\n                $rootScope.AppData = {\r\n                    User: AuthService.currentUser,\r\n                    Notifications: {\r\n                        loaded: 'indeterminate'\r\n                    },\r\n                    NotificationsFeed: {\r\n                        loaded: 'indeterminate'\r\n                    },\r\n                    MessageNotifications: {\r\n                        loaded: 'indeterminate'\r\n                    },\r\n                    searchText: ''\r\n                };\r\n                $rootScope.$state = window.thisState = $state;\r\n                $rootScope.metadata = {\r\n                    title: '',\r\n                    description: '',\r\n                    image: '',\r\n                    url: ''\r\n                };\r\n                $rootScope.$stateParams = $stateParams;\r\n                $rootScope.isViewLoading = false;\r\n                $rootScope.today = moment().toDate();\r\n\r\n                $rootScope.isAuthenticated = function () {\r\n                    return AuthService.isAuthenticated();\r\n                };\r\n\r\n                $rootScope.isVerified = function () {\r\n                    return AuthService.isAuthenticated() && angular.isObject($rootScope.AppData.User) && $rootScope.AppData.User.verified === 1;\r\n                };\r\n\r\n                $rootScope.isNotVerified = function () {\r\n                    return AuthService.isAuthenticated() && angular.isObject($rootScope.AppData.User) && $rootScope.AppData.User.verified === 0;\r\n                };\r\n\r\n                $rootScope.listenNotifications = function (username) {\r\n                    $rootScope.refreshNotifications(username);\r\n                };\r\n\r\n                $rootScope.refreshNotifications = function (id) {\r\n                    $rootScope.AppData.Notifications.loaded = 'indeterminate';\r\n                    DataService.collection('getUserNotifications', {\r\n                        username: id\r\n                    }).then(function (res) {\r\n                        console.log(res.data);\r\n                        $rootScope.AppData.Notifications = {\r\n                            loaded: '',\r\n                            list: res.data,\r\n                            unseen: _.where(res.data, { seen: false }).length,\r\n                            unread: 0\r\n                        };\r\n                        console.log($rootScope.AppData.Notifications);\r\n                    });\r\n                };\r\n\r\n                $rootScope.StreamClient = stream.connect(StreamConfig.streamApiKey, null, StreamConfig.streamApp, {location: 'us-east'});\r\n                $rootScope.getNewToken = function (type, id) {\r\n                    return $http.get('/api/notifications/token?type=' + type).then(function (res) {\r\n                        return res.data.token;\r\n                    });\r\n                };\r\n\r\n                $rootScope.getMessagesFeed = function (feed) {\r\n                    feed.get({limit: 10}, function (error, response, body) {\r\n                        console.log('Messages Notifications: ', body);\r\n                        try {\r\n                            //var data = UtilsService.enrichRawNotifications(body.results);\r\n                            //console.log(data);\r\n                            $rootScope.AppData.MessageNotifications = {\r\n                                loaded: '',\r\n                                list: body.results,\r\n                                unseen: body.unseen,\r\n                                unread: body.unread\r\n                            };\r\n                            console.log($rootScope.AppData.MessageNotifications);\r\n                        } catch (e) {\r\n                            console.log(e);\r\n                        }\r\n                    });\r\n                };\r\n\r\n                $rootScope.subscribeUserFeeds = function () {\r\n                    $rootScope.getNewToken('notification', $rootScope.AppData.User.id).then(function (token) {\r\n                        var feed = $rootScope.StreamClient.feed('notification', $rootScope.AppData.User.id, token);\r\n                        feed.subscribe(function (obj) {\r\n                            console.log('Notification: ', obj);\r\n                            $rootScope.getNotificationsFeed(feed);\r\n                        }).then(function () {\r\n                            $rootScope.getNotificationsFeed(feed);\r\n                        });\r\n                    });\r\n                    $rootScope.getNewToken('message', $rootScope.AppData.User.id).then(function (token) {\r\n                        var feed = $rootScope.StreamClient.feed('message', $rootScope.AppData.User.id, token);\r\n                        feed.subscribe(function (obj) {\r\n                            console.log('Messages: ', obj);\r\n                            $rootScope.getMessagesFeed(feed);\r\n                        }).then(function () {\r\n                            $rootScope.getMessagesFeed(feed);\r\n                        });\r\n                    });\r\n                };\r\n\r\n                $rootScope.getNotificationsFeed = function (feed) {\r\n                    $http.get('/api/notifications/feed').then(function (res) {\r\n                        console.log('Notification: ', res.data.activities);\r\n                        $rootScope.AppData.Notifications = {\r\n                            loaded: '',\r\n                            list: res.data.activities,\r\n                            unseen: res.data.unseen,\r\n                            unread: res.data.unread\r\n                        };\r\n                    });\r\n                    /*feed.get({limit: 10}, function (error, response, body) {\r\n                        console.log('Notifications: ', body);\r\n                        try {\r\n                            var data = UtilsService.enrichRawNotifications(body.results);\r\n                            console.log(data);\r\n                            $rootScope.AppData.RawNotifications = {\r\n                                loaded: '',\r\n                                list: data.data,\r\n                                unseen: body.unseen,\r\n                                unread: body.unread\r\n                            };\r\n                        } catch (e) {\r\n                            console.log(e);\r\n                        }\r\n                    });*/\r\n                };\r\n\r\n                $rootScope.getNewMessages = function () {\r\n                    /*DataService.collection('messages/new').then(function (response) {\r\n                        $rootScope.AppData.MessageNotifications.loaded = true;\r\n                        $rootScope.AppData.MessageNotifications.unread = response.data.length;\r\n                    });*/\r\n                };\r\n\r\n                // Register listeners to $intercom using '.$on()' rather than '.on()' to trigger a safe $apply on $rootScope\r\n                $intercom.$on('show', function() {\r\n                    $rootScope.intercomShowing = true; // currently Intercom onShow callback isn't working\r\n                });\r\n                $intercom.$on('hide', function() {\r\n                    $rootScope.intercomShowing = false;\r\n                });\r\n\r\n                var endWatch = $rootScope.$watch('AppData.User', function (newValue, oldValue) {\r\n                    if (newValue && angular.isString(newValue.id)) {\r\n                        console.log('User Logged In');\r\n\r\n                        // Intercom\r\n                        newValue.name = newValue.fullName;\r\n                        $intercom.boot(newValue);\r\n                        // $intercom.show();\r\n\r\n                        // Push Notifications\r\n                        var OneSignal = window.OneSignal || [];\r\n                        OneSignal.push([\"init\", {\r\n                            appId: \"9972c4b2-7bd1-47c0-a2f8-213b8c767cd8\",\r\n                            safari_web_id: 'web.onesignal.auto.3f58661c-f8ad-4946-a9b6-84125eec4421',\r\n                            autoRegister: true,\r\n                            notifyButton: {\r\n                                enable: false /* Set to false to hide */\r\n                            }\r\n                        }]);\r\n\r\n                        if (!newValue.push_id) {\r\n                            OneSignal.getUserId().then(function(userId) {\r\n                                // console.log(\"OneSignal User ID:\", userId);\r\n                                AuthService.updateUser({id: newValue.id, push_id: userId});\r\n                                // DataService.update('users', newValue.id, { push_id: userId});\r\n                                // (Output) OneSignal User ID: 270a35cd-4dda-4b3f-b04e-41d7463a2316\r\n                            });\r\n                        }\r\n\r\n                        // initialize stream\r\n                        $rootScope.subscribeUserFeeds();\r\n                        //$rootScope.listenNotifications(newValue.username);\r\n\r\n                        $rootScope.getNewMessages();\r\n                        endWatch();\r\n                    }\r\n                });\r\n\r\n                // loading animation\r\n                $rootScope.setLoading = function () {\r\n                    $rootScope.isViewLoading = true;\r\n                };\r\n                $rootScope.unsetLoading = function () {\r\n                    $rootScope.isViewLoading = false;\r\n                };\r\n\r\n                // State transition hooks\r\n                $transitions.onBefore({}, function ($transition$) {\r\n                    $rootScope.setLoading();\r\n                });\r\n\r\n                $transitions.onStart({to: 'register', from: '*'}, function ($transition$) {\r\n                    return AuthService.isAuthenticated() ? $state.target('home') : true;\r\n                });\r\n                $transitions.onStart({to: 'sign_in', from: '*'}, function ($transition$) {\r\n                    return AuthService.isAuthenticated() ? $state.target('home') : true;\r\n                });\r\n                $transitions.onStart({to: 'reset_password', from: '*'}, function ($transition$) {\r\n                    return AuthService.isAuthenticated() ? $state.target('home') : true;\r\n                });\r\n                $transitions.onStart({\r\n                    to: function (state) {\r\n                        return !!state.authenticate;\r\n                    }\r\n                }, function ($transition$) {\r\n                    return AuthService.currentUser ? true : AuthService.getCurrentUser().then(function () {\r\n                        return true;\r\n                    }, function () {\r\n                        return $state.target('sign_in');\r\n                    });\r\n\r\n                });\r\n\r\n                $transitions.onSuccess({}, function () {\r\n                    $rootScope.unsetLoading();\r\n                    $timeout(function () {\r\n                        jQuery(document).foundation();\r\n                        // angular.element('body').scrollTop(0);\r\n                        anchorSmoothScroll.scrollTo('body');\r\n                    }, 100);\r\n                    // Analytics.trackPage($location.path());\r\n                });\r\n\r\n                $transitions.onError({}, function ($transition$) {\r\n                    // debugger;\r\n                    console.log($state);\r\n                });\r\n\r\n                $state.defaultErrorHandler(function(err) {\r\n                    // debugger;\r\n                    // handle err\r\n                });\r\n\r\n                //search bar\r\n                jQuery('.search.end').on('click', function () {\r\n                    if (jQuery(this).children().hasClass('fa-search')) {\r\n                        jQuery(this).children().removeClass('fa-search');\r\n                        jQuery(this).children().addClass('fa-times');\r\n                        $rootScope.$broadcast('overVideoPlayer', false);\r\n\r\n                    } else {\r\n                        jQuery(this).children().removeClass('fa-times');\r\n                        jQuery(this).children().addClass('fa-search');\r\n                        $rootScope.$broadcast('overVideoPlayer', true);\r\n                    }\r\n                    jQuery(this).toggleClass('search-active');\r\n                    jQuery('#search-bar').slideToggle();\r\n\r\n                });\r\n\r\n            }\r\n        ])\r\n        .config(['$localForageProvider', function ($localForageProvider) {\r\n            $localForageProvider.config({\r\n                //driver: 'localStorageWrapper', // if you want to force a driver\r\n                name: 'iw', // name of the database and prefix for your data, it is 'lf' by default\r\n                version: 1.0, // version of the database, you shouldn't have to use this\r\n                storeName: 'keyvaluepairs', // name of the table\r\n                description: 'some description'\r\n            });\r\n        }])\r\n        .config(['$sceDelegateProvider', function ($sceDelegateProvider) {\r\n            $sceDelegateProvider.resourceUrlWhitelist([\r\n                'self',\r\n                'https://getindiewise.com/**',\r\n                'https://www.getindiewise.com/**',\r\n                new RegExp('^(http[s]?):\\/\\/(w{3}.)?youtube\\.com/.+$')\r\n            ]);\r\n        }]);\r\n})();\r\n","(function () {\r\n    'use strict';\r\n\r\n    function mysql_real_escape_string(str) {\r\n        return str.replace(/[\\0\\x08\\x09\\x1a\\n\\r\"'\\\\\\%]/g, function (char) {\r\n            switch (char) {\r\n                case \"\\0\":\r\n                    return \"\\\\0\";\r\n                case \"\\x08\":\r\n                    return \"\\\\b\";\r\n                case \"\\x09\":\r\n                    return \"\\\\t\";\r\n                case \"\\x1a\":\r\n                    return \"\\\\z\";\r\n                case \"\\n\":\r\n                    return \"\\\\n\";\r\n                case \"\\r\":\r\n                    return \"\\\\r\";\r\n                case \"\\\"\":\r\n                case \"'\":\r\n                case \"\\\\\":\r\n                case \"%\":\r\n                    return \"\\\\\" + char; // prepends a backslash to backslash, percent,\r\n                                        // and double/single quotes\r\n            }\r\n        });\r\n    }\r\n\r\n    angular.module('IndieWise.controllers', [])\r\n    // Auth Controllers\r\n        .controller('SignInCtrl', SignInCtrl)\r\n        .controller('ForgotPasswordCtrl', ForgotPasswordCtrl)\r\n        .controller('RegisterCtrl', RegisterCtrl)\r\n\r\n        // Profile Controllers\r\n        .controller('ProfileCtrl', ProfileCtrl)\r\n        .controller('ProfileAboutController', UserAboutController)\r\n        .controller('ProfilePlaylistsController', ProfilePlaylistsController)\r\n        .controller('ProfileVideosController', UserVideosController)\r\n        .controller('ProfileVideoEditCtrl', ProfileVideoEditCtrl)\r\n        .controller('ProfileCritiquesController', UserCritiquesController)\r\n        .controller('ProfileReactionsController', UserReactionsController)\r\n        .controller('ProfileAwardsController', UserAwardsController)\r\n        .controller('ProfileSettingsController', ProfileSettingsController)\r\n        .controller('ProfileUploadController', ProfileUploadController)\r\n\r\n        // User Controllers\r\n        .controller('UserCtrl', UserCtrl)\r\n        .controller('UserAboutController', UserAboutController)\r\n        .controller('UserVideosController', UserVideosController)\r\n        .controller('UserCritiquesController', UserCritiquesController)\r\n        .controller('UserReactionsController', UserReactionsController)\r\n        .controller('UserAwardsController', UserAwardsController)\r\n        // .controller('EditProfileCtrl', EditProfileCtrl)\r\n        .controller('MessagesCtrl', MessagesCtrl)\r\n        .controller('NotificationsCtrl', NotificationsCtrl)\r\n\r\n        // Other App Controllers\r\n        .controller('BodyCtrl', BodyCtrl)\r\n        .controller('HomeCtrl', HomeCtrl)\r\n        .controller('BrowseCtrl', BrowseCtrl)\r\n        .controller('LatestCtrl', LatestCtrl)\r\n        // .controller('AdvancedResultsCtrl', AdvancedResultsCtrl)\r\n        // .controller('ResultsCtrl', ResultsCtrl)\r\n        .controller('VideoCtrl', VideoCtrl)\r\n        .controller('VideoCritiqueCtrl', VideoCritiqueCtrl)\r\n        .controller('VideoCritiqueEditCtrl', VideoCritiqueEditCtrl)\r\n        .controller('ContactPageCtrl', ContactPageCtrl)\r\n\r\n    ;\r\n\r\n    RegisterCtrl.$inject = ['$rootScope', '$timeout', '$q', '$state', 'AuthService', 'DataService', 'anchorSmoothScroll', '_'];\r\n    function RegisterCtrl($rootScope, $timeout, $q, $state, AuthService, DataService, anchorSmoothScroll, _) {\r\n        $rootScope.metadata.title = 'Register';\r\n        var self = this;\r\n        self.creating = false;\r\n        self.accountCreated = false;\r\n        self.genresArr = [];\r\n        self.typesArr = [];\r\n        self.user = {\r\n            email: '',\r\n            password: '',\r\n            passwordCheck: '',\r\n            firstName: '',\r\n            lastName: '',\r\n            gender: '',\r\n            // genres: [],\r\n            // types: []\r\n            //selected_genres: ''\r\n        };\r\n\r\n        self.dobDay = '';\r\n        self.dobMonth = '';\r\n        self.dobYear = '';\r\n        self.authErrors = null;\r\n        self.errors = {\r\n            email: false,\r\n            gender: false,\r\n            genres: false,\r\n            types: false\r\n        };\r\n\r\n        self.thisYear = moment().year();\r\n        self.yearsList = [];\r\n        for (var i = self.thisYear; i > (self.thisYear - 100); i--) {\r\n            self.yearsList.push(i);\r\n        }\r\n\r\n        /*$rootScope.generateGenres().then(function (res) {\r\n         $rootScope.genresList = self.genresList = res;\r\n         });\r\n         $rootScope.generateTypes().then(function (res) {\r\n         $rootScope.typesList = self.typesList = res;\r\n         });*/\r\n        $rootScope.generateCountries().then(function (res) {\r\n            $rootScope.countryList = self.countryList = res;\r\n        });\r\n\r\n        self.checkEmailUse = function () {\r\n            if (angular.isString(self.user.email) && self.user.email.length) {\r\n                DataService.collection('emailCheck', {email: mysql_real_escape_string(self.user.email)}).then(function (res) {\r\n                    self.errors.email = res.data && res.data.verify === true ? 1 : 0;\r\n                });\r\n            } else self.errors.email = false;\r\n        };\r\n\r\n        self.doRegister = function () {\r\n            if (!self.creating) {\r\n                self.creating = true;\r\n                self.errors.gender = !self.user.gender.length;\r\n\r\n                if (self.errors.gender) {\r\n                    anchorSmoothScroll.scrollTo('errors');\r\n                    return false;\r\n                }\r\n\r\n                self.user.dob = moment().set({\r\n                    'year': self.dobYear,\r\n                    'month': parseInt(self.dobMonth) - 1,\r\n                    'date': self.dobDay\r\n                }).startOf('day').format('YYYY-MM-DD HH:mm:ss');\r\n                AuthService.createUser(self.user).then(function (res) {\r\n                    if (!res.status) {\r\n                        self.authErrors = res.errors;\r\n                        $rootScope.toastMessage('There is an error, please check your form');\r\n                        // console.log('Failed', res);\r\n                    } else {\r\n                        // console.log('Success', res);\r\n                        //window.location.reload();\r\n                        $rootScope.toastMessage('Account created!');\r\n                    }\r\n                    // window.location.reload();\r\n                    self.creating = false;\r\n                });\r\n            } else {\r\n                $rootScope.toastMessage('Please wait...');\r\n            }\r\n        };\r\n\r\n        self.authenticate = function (provider) {\r\n            self.error = null;\r\n            AuthService.socialLogin(provider, true).then(function (a) {\r\n                if (a) {\r\n                    $state.go('profile.about', {reload: true});\r\n                    // console.log(a);\r\n                }\r\n            });\r\n        };\r\n\r\n        $timeout(function () {\r\n            jQuery(document).foundation();\r\n            $timeout(function () {\r\n                jQuery(document).foundation();\r\n            }, 500);\r\n        }, 500);\r\n    }\r\n\r\n    SignInCtrl.$inject = ['$rootScope', '$timeout', '$q', '$state', 'AuthService', '$window', '$modal', 'cfpLoadingBar'];\r\n    function SignInCtrl($rootScope, $timeout, $q, $state, AuthService, $window, $modal, cfpLoadingBar) {\r\n        $rootScope.metadata.title = 'Sign In';\r\n        var self = this;\r\n        self.authErrors = null;\r\n        self.user = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        self.doLogin = function (redirect) {\r\n            redirect = redirect || true;\r\n            self.error = false;\r\n            AuthService.login(self.user.email, self.user.password).then(function (res) {\r\n                if (res.status === false) {\r\n                    self.authErrors = res.errors;\r\n                    return false;\r\n                } else {\r\n                    if (redirect && angular.isDefined(res)) {\r\n                        if($rootScope.$stateParams.redirect) {\r\n                            return $window.location.href = $rootScope.$stateParams.redirect;\r\n                        }\r\n                        $state.go('home');\r\n                    }\r\n                }\r\n                cfpLoadingBar.complete();\r\n            }, function (res) {\r\n                self.error = res;\r\n                // console.log('Failed', res);\r\n            });\r\n        };\r\n\r\n        self.authenticate = function (provider) {\r\n            self.error = null;\r\n            AuthService.socialLogin(provider, false).then(function (res) {\r\n                if (!res.status) {\r\n                    self.authErrors = res.errors;\r\n                    $rootScope.toastMessage('There is an error, please check your form');\r\n                    // console.log('Failed', res);\r\n                }\r\n            });\r\n        };\r\n\r\n        $timeout(function () {\r\n            jQuery(document).foundation();\r\n            $timeout(function () {\r\n                jQuery(document).foundation();\r\n            }, 500);\r\n        }, 500);\r\n    }\r\n\r\n    ForgotPasswordCtrl.$inject = ['$rootScope', '$state', 'AuthService'];\r\n    function ForgotPasswordCtrl($rootScope, $state, AuthService) {\r\n        $rootScope.metadata.title = 'Password Recovery';\r\n\r\n        var self = this;\r\n        self.email = '';\r\n        self.reseting = {\r\n            newPassword: null,\r\n            newPasswordCheck: null\r\n        };\r\n        self.hasToken = $rootScope.$stateParams.token || false;\r\n\r\n        self.doPasswordResetRequest = function () {\r\n            AuthService.requestPasswordReset(self.email).then(function (res) {\r\n                // console.log(res);\r\n                $rootScope.toastMessage('Check your inbox for our email! Should be there soon.');\r\n                $state.go('sign_in');\r\n            }, function (error) {\r\n                $rootScope.toastMessage('Error: ' + error.message);\r\n            });\r\n        };\r\n\r\n        self.confirmReset = function () {\r\n            if (self.reseting.newPassword === self.reseting.newPasswordCheck && angular.isString(self.hasToken)) {\r\n                AuthService.passwordReset($rootScope.$stateParams.email, self.reseting.newPassword, self.reseting.newPasswordCheck, self.hasToken)\r\n                    .then(function (res) {\r\n\r\n                    })\r\n            } else return false;\r\n        };\r\n\r\n        if (self.hasToken) {\r\n\r\n        }\r\n    }\r\n\r\n    BodyCtrl.$inject = ['$rootScope', '$localForage', '$q', '$state', 'AuthService', '$mdToast', 'UserActions', '$sce', 'DataService', '_', '$interval', '$mdSidenav'];\r\n    function BodyCtrl($rootScope, $localForage, $q, $state, AuthService, $mdToast, UserActions, $sce, DataService, _, $interval, $mdSidenav) {\r\n        var self = this;\r\n\r\n        self.selected = null;\r\n        $rootScope.AppData.searchText = decodeURIComponent($rootScope.$stateParams.q || '');\r\n        self.selectedItem = '';\r\n\r\n        self.notificationsTemplate = $sce.trustAsResourceUrl('src/directives/notification.html');\r\n        self.newsletterRegister = newsletterRegister;\r\n\r\n\r\n        // Recent Videos Footer Section\r\n        DataService.collection('projects', {per_page: 3, sort: 'created_at'}).then(function (result) {\r\n            _.each(result.data.data, function (i) {\r\n                // i.created_at = $filter('amUTC')(i.created_at);\r\n            });\r\n            self.footerRecentVideos = result.data;\r\n        });\r\n\r\n        self.startSearch = function (text) {\r\n            if (text) {\r\n                self.toPage('browse', {q: text});\r\n            }\r\n        };\r\n\r\n        var isIOS = function() {\r\n            return !!(navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/iPad/i));\r\n        };\r\n        var isAndroid = function() {\r\n            return !!navigator.userAgent.match(/Android/i);\r\n        };\r\n\r\n        $rootScope.isMobile = self.isMobile = function () {\r\n            return isIOS() || isAndroid() || Foundation.MediaQuery.current === 'small';\r\n        };\r\n\r\n        $rootScope.requestVerificationEmail = function () {\r\n            AuthService.requestVerification().then(function () {\r\n                self.verificationEmailSentMessage = true;\r\n            });\r\n        };\r\n\r\n        $rootScope.generateGenres = function () {\r\n            var deferred = $q.defer();\r\n            // $localForage.removeItem('genres');\r\n            $localForage.getItem('genres', true).then(function (data) {\r\n                $rootScope.genresList = data;\r\n                deferred.resolve(data);\r\n            }, function (error) {\r\n                DataService.collection('genres').then(function (result) {\r\n                    $rootScope.genresList = result.data.Genres;\r\n                    $localForage.setItem('genres', result.data.Genres);\r\n                    deferred.resolve(result.data.Genres);\r\n                });\r\n            });\r\n\r\n            return deferred.promise;\r\n        };\r\n\r\n        $rootScope.generateTypes = function () {\r\n            var deferred = $q.defer();\r\n            // $localForage.removeItem('types');\r\n            $localForage.getItem('types', true).then(function (data) {\r\n                $rootScope.typesList = data;\r\n                deferred.resolve(data);\r\n            }, function (error) {\r\n                DataService.collection('types').then(function (result) {\r\n                    $rootScope.typesList = result.data.Types;\r\n                    $localForage.setItem('types', result.data.Types);\r\n                    deferred.resolve(result.data.Types);\r\n                });\r\n            });\r\n\r\n            return deferred.promise;\r\n        };\r\n\r\n        $rootScope.generateCountries = function () {\r\n            var deferred = $q.defer();\r\n            // $localForage.removeItem('countries');\r\n            $localForage.getItem('countries', true).then(function (data) {\r\n                $rootScope.countryList = data;\r\n                deferred.resolve(data);\r\n            }, function (error) {\r\n                DataService.collection('countries').then(function (result) {\r\n                    $rootScope.countryList = result.data.Countries;\r\n                    $localForage.setItem('countries', result.data.Countries);\r\n                    deferred.resolve(result.data.Countries);\r\n                });\r\n            });\r\n\r\n            return deferred.promise;\r\n        };\r\n\r\n        $rootScope.generateLanguages = function () {\r\n            var deferred = $q.defer();\r\n            // $localForage.removeItem('languages');\r\n            $localForage.getItem('languages', true).then(function (data) {\r\n                $rootScope.languageList = data;\r\n                deferred.resolve(data);\r\n            }, function (error) {\r\n                DataService.collection('languages').then(function (result) {\r\n                    $rootScope.languageList = result.data.Languages;\r\n                    $localForage.setItem('languages', result.data.Languages);\r\n                    deferred.resolve(result.data.Languages);\r\n                });\r\n            });\r\n\r\n            return deferred.promise;\r\n        };\r\n\r\n        $rootScope.generateReactions = function () {\r\n            return [\r\n                {name: 'Happy', emotion: 'happy', icon: 'happy'},\r\n                {name: 'Sad', emotion: 'sad', icon: 'sad'},\r\n                {name: 'Offended', emotion: 'offended', icon: 'annoyed'},\r\n                {name: 'Amused', emotion: 'amused', icon: 'grinning'},\r\n                {name: 'Mad', emotion: 'mad', icon: 'mad'},\r\n                {name: 'Furious', emotion: 'furious', icon: 'angry'},\r\n                {name: 'Awesome', emotion: 'awesome', icon: 'woah'},\r\n                {name: 'Terrified', emotion: 'terrified', icon: 'shocked'},\r\n                {name: 'Confused', emotion: 'confused', icon: 'confused'},\r\n                {name: 'In-Love', emotion: 'in-love', icon: 'love'},\r\n                {name: 'Amazed', emotion: 'amazed', icon: 'woah'},\r\n                {name: 'Motivated', emotion: 'motivated', icon: 'interested'},\r\n                {name: 'Inspired', emotion: 'inspired', icon: 'interested'},\r\n                {name: 'Bored', emotion: 'bored', icon: 'bored'},\r\n                {name: 'Sleepy', emotion: 'sleepy', icon: 'bored'},\r\n                //  {name: 'Determined', emotion: 'determined', icon: 'interested'},\r\n                {name: 'Emotional', emotion: 'emotional', icon: 'emotional'},\r\n                {name: 'Excited', emotion: 'excited', icon: 'big-smile'},\r\n                {name: 'Nostalgic', emotion: 'nostalgic', icon: 'nostalgic'},\r\n                {name: 'Annoyed', emotion: 'annoyed', icon: 'annoyed'},\r\n                {name: 'Sorry', emotion: 'sorry', icon: 'sad-tear'},\r\n                {name: 'Ashamed', emotion: 'ashamed', icon: 'sad-tear'},\r\n                {name: 'Meh', emotion: 'meh', icon: 'meh'},\r\n                {name: 'Special', emotion: 'special', icon: 'wink'},\r\n                {name: 'Sick', emotion: 'sick', icon: 'mute'},\r\n                {name: 'Great', emotion: 'great', icon: 'grinning'},\r\n                // {name: 'Down', emotion: 'down', icon: 'sad'},\r\n                // {name: 'Better', emotion: 'better', icon: 'interested'},\r\n                {name: 'Guilty', emotion: 'guilty', icon: 'sympathetic'},\r\n                {name: 'Hopeful', emotion: 'hopeful', icon: 'hopeful'},\r\n                {name: 'Hopeless', emotion: 'hopeless', icon: 'sad'},\r\n                {name: 'Secure', emotion: 'secure', icon: 'nerdy'},\r\n                {name: 'Blessed', emotion: 'blessed', icon: 'grinning'},\r\n                {name: 'Interested', emotion: 'interested', icon: 'interested'},\r\n                {name: 'Comfortable', emotion: 'comfortable', icon: 'hehe'},\r\n                {name: 'Disturbed', emotion: 'disturbed', icon: 'confused'},\r\n                {name: 'Stupid', emotion: 'stupid', icon: 'confused'},\r\n                {name: 'Sexy', emotion: 'sexy', icon: 'sexy'},\r\n                {name: 'Relaxed', emotion: 'relaxed', icon: 'happy'},\r\n\r\n                {name: 'Empowered', emotion: 'empowered', icon: 'happy'},\r\n                {name: 'Cool', emotion: 'cool', icon: 'happy'},\r\n                {name: 'Pumped', emotion: 'pumped', icon: 'happy'},\r\n                {name: 'Turned On', emotion: 'turned on', icon: 'happy'},\r\n                {name: 'Proud', emotion: 'Proud', icon: 'happy'},\r\n                {name: 'Disgusted', emotion: 'disgusted', icon: 'annoyed'},\r\n                {name: 'Sympathetic', emotion: 'sympathetic', icon: 'happy'},\r\n                {name: 'Overwhelmed', emotion: 'overwhelmed', icon: 'happy'},\r\n                {name: 'Passionate', emotion: 'passionate', icon: 'happy'},\r\n                {name: 'Thrilled', emotion: 'thrilled', icon: 'happy'},\r\n                {name: 'Loved', emotion: 'loved', icon: 'happy'},\r\n                {name: 'Thankful', emotion: 'thankful', icon: 'happy'},\r\n                {name: 'Appreciated', emotion: 'appreciated', icon: 'happy'},\r\n                {name: 'Romantic', emotion: 'romantic', icon: 'love'},\r\n                {name: 'Chill', emotion: 'chill', icon: 'happy'},\r\n                {name: 'Pissed Off', emotion: 'pissed off', icon: 'annoyed'},\r\n                {name: 'Accomplished', emotion: 'accomplished', icon: 'happy'},\r\n                {name: 'Honored', emotion: 'honored', icon: 'happy'},\r\n                {name: 'Young', emotion: 'young', icon: 'happy'},\r\n                {name: 'Wild', emotion: 'wild', icon: 'happy'},\r\n                {name: 'Old', emotion: 'old', icon: 'happy'},\r\n                {name: 'Free', emotion: 'free', icon: 'happy'},\r\n                {name: 'Epic', emotion: 'epic', icon: 'happy'},\r\n                // {name: 'Engaged', emotion: 'engaged', icon: 'happy'},\r\n                {name: 'Fired Up', emotion: 'fired up', icon: 'happy'},\r\n                {name: 'Detached', emotion: 'detached', icon: 'happy'},\r\n                {name: 'Disconnected', emotion: 'disconnected', icon: 'confused'},\r\n                {name: 'Connected', emotion: 'connected', icon: 'happy'},\r\n                // {name: 'Distant', emotion: 'distant', icon: 'happy'},\r\n                {name: 'Beautiful', emotion: 'beautiful', icon: 'happy'},\r\n\r\n                {name: 'Confident', emotion: 'confident', icon: 'happy'},\r\n                {name: 'Positive', emotion: 'positive', icon: 'happy'},\r\n                {name: 'Negative', emotion: 'negative', icon: 'annoyed'},\r\n                {name: 'Heartbroken', emotion: 'heartbroken', icon: 'emotional'},\r\n                {name: 'Silly', emotion: 'silly', icon: 'hehe'},\r\n                {name: 'Disappointed', emotion: 'disappointed', icon: 'sad'},\r\n                {name: 'Stressed', emotion: 'stressed', icon: 'annoyed'},\r\n                {name: 'Fantastic', emotion: 'fantastic', icon: 'big-smile'},\r\n                {name: 'Hungry', emotion: 'hungry', icon: 'annoyed'},\r\n                {name: 'Shocked', emotion: 'shocked', icon: 'shocked'},\r\n                {name: 'Frustrated', emotion: 'frustrated', icon: 'annoyed'},\r\n                {name: 'Engrossed', emotion: 'engrossed', icon: 'interested'},\r\n                {name: 'Peaceful', emotion: 'peaceful', icon: 'happy'},\r\n                {name: 'Surprised', emotion: 'surprised', icon: 'woah'},\r\n                {name: 'Satisfied', emotion: 'satisfied', icon: 'happy'},\r\n                {name: 'Incomplete', emotion: 'incomplete', icon: 'sad'},\r\n                {name: 'Complete', emotion: 'complete', icon: 'happy'},\r\n                {name: 'Entertained', emotion: 'entertained', icon: 'hehe'},\r\n                {name: 'Enlightened', emotion: 'enlightened', icon: 'interested'},\r\n                {name: 'Relieved', emotion: 'relieved', icon: 'happy'},\r\n                {name: 'Concerned', emotion: 'concerned', icon: 'sympathetic'},\r\n                {name: 'Strong', emotion: 'strong', icon: 'happy'},\r\n                {name: 'Optimistic', emotion: 'optimistic', icon: 'happy'},\r\n                {name: 'Discouraged', emotion: 'discouraged', icon: 'happy'},\r\n                {name: 'Lucky', emotion: 'lucky', icon: 'happy'},\r\n                {name: 'Scared', emotion: 'scared', icon: 'happy'},\r\n                {name: 'Brave', emotion: 'brave', icon: 'happy'},\r\n                {name: 'Naughty', emotion: 'naughty', icon: 'sexy'},\r\n                {name: 'Alert', emotion: 'alert', icon: 'happy'},\r\n                {name: 'Alive', emotion: 'alive', icon: 'happy'},\r\n                {name: 'Perfect', emotion: 'perfect', icon: 'happy'},\r\n                {name: 'Nervous', emotion: 'nervous', icon: 'happy'},\r\n                {name: 'Tense', emotion: 'tense', icon: 'annoyed'},\r\n                // {name: 'Eager', emotion: 'eager', icon: 'happy'},\r\n                {name: 'Impatient', emotion: 'impatient', icon: 'annoyed'},\r\n                {name: 'Philosophical', emotion: 'philosophical', icon: 'interested'},\r\n                {name: 'Empty', emotion: 'empty', icon: 'happy'},\r\n                {name: 'Informed', emotion: 'informed', icon: 'nerdy'},\r\n                {name: 'Playful', emotion: 'playful', icon: 'happy'},\r\n                {name: 'Wise', emotion: 'wise', icon: 'nerdy'},\r\n                {name: 'Refreshed', emotion: 'refreshed', icon: 'happy'},\r\n                // {name: 'Fortunate', emotion: 'fortunate', icon: 'happy'},\r\n                {name: 'Wanted', emotion: 'wanted', icon: 'annoyed'},\r\n                {name: 'Thirsty', emotion: 'thirsty', icon: 'happy'},\r\n                {name: 'Desperate', emotion: 'desperate', icon: 'happy'}\r\n            ];\r\n        };\r\n\r\n        $rootScope.generateGenres();\r\n        $rootScope.generateTypes();\r\n\r\n        $rootScope.toastMessage = function (msg) {\r\n            var toast = $mdToast.simple()\r\n                .textContent(msg)\r\n                .position('bottom right')\r\n                .parent(jQuery('#alerts'));\r\n            $mdToast.show(toast);\r\n        };\r\n\r\n        $rootScope.toastAction = function (msg, action, cb) {\r\n            var toast = $mdToast.simple()\r\n                .textContent(msg)\r\n                .action(action)\r\n                .hideDelay(0)\r\n                .highlightAction(false)\r\n                .position('bottom right')\r\n                .parent(jQuery('#alerts'));\r\n            $mdToast.show(toast).then(function (response) {\r\n                if (response == 'ok') {\r\n                    cb();\r\n                }\r\n            });\r\n        };\r\n\r\n        self.toggleSideNav = toggleSideNav;\r\n        self.closeSideNav = closeSideNav;\r\n\r\n        function toggleSideNav(navID) {\r\n            $mdSidenav(navID)\r\n                .toggle()\r\n                .then(function () {\r\n                    $rootScope.$broadcast('overVideoPlayer', false);\r\n                });\r\n        }\r\n\r\n        function closeSideNav(navID) {\r\n            $mdSidenav(navID)\r\n                .close()\r\n                .then(function () {\r\n                    $rootScope.$broadcast('overVideoPlayer', true);\r\n                });\r\n        }\r\n\r\n        self.toPage = function (state, args) {\r\n            $state.go(state, args);\r\n        };\r\n\r\n        self.notiURL = function (n) {\r\n            if (!n.is_read) {\r\n                self.markAsRead(n);\r\n            }\r\n            self.toPage(n.main_url.state, n.main_url.args);\r\n            jQuery('#NotificationsArea').foundation('close');\r\n        };\r\n\r\n        self.markAllAsSeen = function () {\r\n            var unseenList = _.where($rootScope.AppData.Notifications.list, {seen: false});\r\n            var i = 0;\r\n\r\n            _.each($rootScope.AppData.Notifications.list, function (a) {\r\n                if (!a.seen) {\r\n                    a.seen = true;\r\n                }\r\n            });\r\n\r\n            $rootScope.getNewToken('notification', $rootScope.AppData.User.id).then(function (token) {\r\n                var feed = $rootScope.StreamClient.feed('notification', $rootScope.AppData.User.id, token);\r\n                feed.get({limit: 20, mark_seen: true}, function (a) {\r\n                    _.each($rootScope.AppData.Notifications.list, function (n) {\r\n                        n.is_seen = true;\r\n                    });\r\n                    $rootScope.AppData.Notifications.unseen = 0;\r\n                })\r\n            });\r\n        };\r\n\r\n        self.markAllAsRead = function () {\r\n            $rootScope.getNewToken('notification', $rootScope.AppData.User.id).then(function (token) {\r\n                var feed = $rootScope.StreamClient.feed('notification', $rootScope.AppData.User.id, token);\r\n                feed.get({limit: 20, mark_read: true}, function (a) {\r\n                    _.each($rootScope.AppData.Notifications.list, function (n) {\r\n                        n.is_read = true;\r\n                    });\r\n                    $rootScope.AppData.Notifications.unread = 0;\r\n                })\r\n            });\r\n        };\r\n\r\n        self.markAsRead = function (obj) {\r\n            if (!obj.is_seen) {\r\n                $rootScope.getNewToken('notification', $rootScope.AppData.User.id).then(function (token) {\r\n                    var feed = $rootScope.StreamClient.feed('notification', $rootScope.AppData.User.id, token);\r\n                    feed.get({limit:25, mark_read: [obj.id], mark_seen: [obj.id]})\r\n                        .then(function(data) { /* on success */ })\r\n                        .catch(function(reason) { /* on failure */ });\r\n                    if ($rootScope.AppData.Notifications.unseen > 0) {\r\n                        $rootScope.AppData.Notifications.unseen--;\r\n                    }\r\n                    obj.is_seen = true;\r\n                });\r\n            }\r\n            return obj;\r\n        };\r\n\r\n        self.doSignOut = function () {\r\n            AuthService.logout().then(function (res) {\r\n                window.location.reload();\r\n            })\r\n        };\r\n\r\n        self.openNotificationsMenu = function () {\r\n            jQuery('#NotificationsArea').foundation('toggle');\r\n            self.markAllAsSeen();\r\n        };\r\n\r\n        self.toSignInRedirect = function () {\r\n            return window.location = window.location.origin + '/sign-in?redirect=' + window.location.pathname;\r\n        };\r\n\r\n        $rootScope.toFavorites = self.toFavorites = toFavorites;\r\n        $rootScope.toWatchLater = self.toWatchLater = toWatchLater;\r\n        $rootScope.checkContains = self.checkContains = checkContains;\r\n        $rootScope.isSame = self.isSame = isSame;\r\n\r\n        function toFavorites(obj) {\r\n            return UserActions.favorite(obj);\r\n        }\r\n\r\n        function toWatchLater(obj) {\r\n            return UserActions.watchLater(obj);\r\n        }\r\n\r\n        function checkContains(obj, search) {\r\n            return _.contains(obj, search);\r\n        }\r\n\r\n        function isSame(a, b) {\r\n            return moment(a).isSame(b, 'hour');\r\n        }\r\n\r\n        function newsletterRegister(notifyMe) {\r\n            DataService.notifyMe(notifyMe)\r\n                .then(function (res) {\r\n                    if (res.data.status == 'success') {\r\n                        $rootScope.toastMessage('Thanks for joining our newsletter!');\r\n                        return self.notifyMe = {};\r\n                    }\r\n                }, function (err) {\r\n                    // console.log(err);\r\n                });\r\n        }\r\n    }\r\n\r\n    HomeCtrl.$inject = ['$rootScope', 'DataService', '$scope', '$window', '$modal', '$interval'];\r\n    function HomeCtrl($rootScope, DataService, $scope, $window, $modal, $interval) {\r\n        var self = this;\r\n        $rootScope.metadata.title = 'Home';\r\n\r\n        self.refresh = function () {\r\n            // Trending Videos\r\n            DataService.collection('projects', {sort: 'reactions_count', per_page: 8}).then(function (result) {\r\n                self.trending = result.data;\r\n            });\r\n\r\n            // Highest Rated Videos\r\n            DataService.collection('projects', {sort: 'topRating', per_page: 8}).then(function (result) {\r\n                self.highestRated = result.data;\r\n            });\r\n\r\n            // Highest Awarded Videos\r\n            DataService.collection('projects', {sort: 'wins_count', per_page: 8}).then(function (result) {\r\n                self.highestAwarded = result.data;\r\n            });\r\n\r\n            // Recent Videos\r\n            DataService.collection('projects', {sort: 'created_at', per_page: 8}).then(function (result) {\r\n                self.recentFilms = result.data;\r\n            });\r\n        };\r\n        self.refresh();\r\n        self.refInterval = $interval(self.refresh, 300000);\r\n\r\n        $scope.$on('$destroy', function () {\r\n            $interval.cancel(self.refInterval);\r\n        });\r\n\r\n        $window.onfocus = function () {\r\n            //do something\r\n        };\r\n\r\n        $window.onblur = function () {\r\n            // console.log('Refresh Stopped');\r\n            $interval.cancel(self.refInterval);\r\n        };\r\n    }\r\n\r\n    BrowseCtrl.$inject = ['$scope', '$rootScope', '$state', 'DataService', '$q', '$timeout', '$modal', '$mdSidenav', '_'];\r\n    function BrowseCtrl($scope, $rootScope, $state, DataService, $q, $timeout, $modal, $mdSidenav, _) {\r\n        $rootScope.metadata.title = 'Browse';\r\n        var self = this;\r\n        self.isOpen = false;\r\n        self.loading = false;\r\n        self.selectedGenres = [];\r\n        self.selectedTypes = [];\r\n        self.films = [];\r\n        self.arrs = {\r\n            genres: [],\r\n            types: []\r\n        };\r\n        self.filters = {\r\n            sort: $rootScope.$stateParams.sort || 'created_at',\r\n            genres: $rootScope.$stateParams.genres || undefined,\r\n            type: $rootScope.$stateParams.types || undefined,\r\n            search: $rootScope.$stateParams.q || undefined,\r\n            page: 1\r\n        };\r\n        $rootScope.AppData.searchText = $rootScope.$stateParams.q;\r\n\r\n        $rootScope.generateTypes().then(function (types) {\r\n            var d = $q.defer();\r\n\r\n            self.arrs.types = angular.isArray(self.selectedTypes) && self.selectedTypes.length ? self.selectedTypes : types;\r\n            return d.promise;\r\n        });\r\n\r\n        $rootScope.generateGenres().then(function (genres) {\r\n            var d = $q.defer();\r\n            self.arrs.genres = angular.isArray(self.selectedGenres) && self.selectedGenres.length ? self.selectedGenres : genres;\r\n            return d.promise;\r\n        });\r\n\r\n        self.refresh = function () {\r\n            $q.all([$rootScope.generateTypes(), $rootScope.generateGenres()]).then(function (values) {\r\n                self.filters.sort = $rootScope.$stateParams.sort || 'recent';\r\n                self.search();\r\n            });\r\n        };\r\n\r\n        self.search = function () {\r\n            self.loading = true;\r\n            var filterField = '';\r\n            switch (self.filters.sort) {\r\n                case 'trending':\r\n                    filterField = 'reactions_count';\r\n                    break;\r\n                case 'rating':\r\n                    filterField = 'iwRating';\r\n                    break;\r\n                case 'awards':\r\n                    filterField = 'wins_count';\r\n                    break;\r\n                case 'recent':\r\n                default:\r\n                    filterField = 'created_at';\r\n                    break;\r\n            }\r\n\r\n            $rootScope.AppData.searchText = $rootScope.$stateParams.q = self.filters.search || undefined;\r\n            DataService.collection('projects', {\r\n                sort: filterField,\r\n                order: 'DESC',\r\n                types: _.pluck(self.selectedTypes, 'id').toString(),\r\n                genres: _.pluck(self.selectedGenres, 'id').toString(),\r\n                search: self.filters.search || undefined,\r\n                per_page: 50,\r\n                page: self.filters.page\r\n            }).then(function (res) {\r\n                self.pagination = res.data.meta.pagination;\r\n                return self.films = res.data.data;\r\n            }).then(function () {\r\n                self.loading = false;\r\n            });\r\n\r\n\r\n            $scope.$broadcast('scroll.refreshComplete');\r\n        };\r\n\r\n        self.loadMore = function () {\r\n            if (self.loading) {\r\n                $rootScope.toastMessage('Please wait...');\r\n            }\r\n\r\n            self.loading = true;\r\n            var filterField = '';\r\n            switch (self.filters.sort) {\r\n                case 'trending':\r\n                    filterField = 'reactions_count';\r\n                    break;\r\n                case 'rating':\r\n                    filterField = 'iwRating';\r\n                    break;\r\n                case 'awards':\r\n                    filterField = 'wins_count';\r\n                    break;\r\n                case 'recent':\r\n                default:\r\n                    filterField = 'created_at';\r\n                    break;\r\n            }\r\n\r\n            DataService.collection('projects', {\r\n                sort: filterField,\r\n                order: 'DESC',\r\n                types: _.pluck(self.selectedTypes, 'id').toString(),\r\n                genres: _.pluck(self.selectedGenres, 'id').toString(),\r\n                search: self.filters.search || undefined,\r\n                per_page: 50,\r\n                page: ++self.filters.page\r\n            }).then(function (res) {\r\n                return self.films = _.union(self.films, res.data.data);\r\n            }).then(function () {\r\n                self.loading = false;\r\n            });\r\n        };\r\n\r\n        self.selectGenres = function (genre) {\r\n            var exists = _.findWhere(self.selectedGenres, {id: genre.id});\r\n            !!exists ? self.selectedGenres = _.reject(self.selectedGenres, genre) : self.selectedGenres.push(genre);\r\n            self.search();\r\n        };\r\n\r\n        self.selectTypes = function (type) {\r\n            var exists = _.find(self.selectedTypes, {id: type.id});\r\n            !!exists ? self.selectedTypes = _.reject(self.selectedTypes, type) : self.selectedTypes.push(type);\r\n            self.search();\r\n        };\r\n\r\n        self.filterBy = function (filter) {\r\n            self.search();\r\n        };\r\n\r\n        self.toggleFilterNav = function () {\r\n            $mdSidenav('filterNav')\r\n                .toggle()\r\n                .then(function () {\r\n\r\n                });\r\n\r\n        };\r\n\r\n        /*$scope.$watch('filters.search', function (newValue, oldValue) {\r\n            debugger;\r\n        });*/\r\n\r\n        self.refresh();\r\n    }\r\n\r\n    LatestCtrl.$inject = ['$rootScope', '$scope', 'DataService', '$timeout', '$interval'];\r\n    function LatestCtrl($rootScope, $scope, DataService, $timeout, $interval) {\r\n        $rootScope.metadata.title = 'Latest';\r\n        var self = this;\r\n\r\n        self.init = function () {\r\n            DataService.collection('reactions/latest').then(function (res) {\r\n                self.reactions = res.data;\r\n            });\r\n            DataService.collection('nominations/latest').then(function (res) {\r\n                self.nominations = res.data;\r\n            });\r\n            DataService.collection('critiques/latest').then(function (res) {\r\n                self.critiques = res.data;\r\n            });\r\n        };\r\n\r\n        self.init();\r\n        self.refInterval = $interval(self.init, 10000);\r\n\r\n        $scope.$on('$destroy', function () {\r\n            $interval.cancel(self.refInterval);\r\n        });\r\n\r\n        $timeout(jQuery(document).foundation(), 0);\r\n    }\r\n\r\n    VideoCtrl.$inject = ['$rootScope', '$scope', 'Project', '$modal', 'UserActions', 'DataService', '$state', 'Analytics', '$window', '$timeout', '_'];\r\n    function VideoCtrl($rootScope, $scope, Project, $modal, UserActions, DataService, $state, Analytics, $window, $timeout, _) {\r\n        var self = this;\r\n        self.loaded = false;\r\n        self.displayShare = false;\r\n        self.toggleReactionsList = false;\r\n        self.emotions = $rootScope.generateReactions();\r\n        self.critiqueAverage = 0;\r\n        self.critiquesPage = 1;\r\n        self.nominationsPage = 1;\r\n        self.activeTab = 'critiques';\r\n        self.isFaved = false;\r\n        self.isSaved = false;\r\n        self.playerResponsiveMode = $window.localStorage.playerResponsiveMode ? JSON.parse($window.localStorage.playerResponsiveMode) : _.contains(['small', 'medium', 'large'], Foundation.MediaQuery.current);\r\n        self.tagsArray = [];\r\n        self.lightsOff = false;\r\n\r\n        self.film = Project;\r\n        function init(result) {\r\n            $rootScope.currentTitle = result.name;\r\n\r\n            self.loaded = true;\r\n\r\n            $rootScope.metadata = {\r\n                title: result.name,\r\n                description: angular.isString(result.description) ? result.description.substr(0, 150) : '',\r\n                image: result.thumbnail_url,\r\n                url: window.location.href\r\n            };\r\n\r\n            self.qReactions();\r\n\r\n            self.qCritiques();\r\n\r\n            self.qNominations();\r\n\r\n            self.qWins();\r\n\r\n            self.checkUserActions();\r\n\r\n            $rootScope.initWatch = function () {\r\n                Analytics.trackEvent('video', 'play', self.film.name);\r\n                UserActions.markAsWatched(self.film)\r\n            };\r\n            //self.activeWatch = UserActions.markAsWatched(self.film);\r\n\r\n            $scope.$on('$destroy', function () {\r\n                $rootScope.initWatch = undefined;\r\n            });\r\n\r\n            $scope.$on('overVideoPlayer', function (state) {\r\n                zIndexPlayer(state);\r\n            });\r\n            //UserActions.cancelWatched(self.activeWatch);\r\n\r\n            self.test = function () {\r\n                // console.log('Clicked');\r\n            };\r\n\r\n            //Populate tags array\r\n            if (angular.isString(self.film.tags) && self.film.tags.length) {\r\n                if (self.film.tags.indexOf(',') > -1) {\r\n                    self.tagsArray = self.film.tags.split(',');\r\n                }\r\n            }\r\n\r\n            // Get related video\r\n            DataService.collection('projects', {\r\n                notVideo: self.film.id,\r\n                notOwner: $rootScope.AppData.User ? $rootScope.AppData.User.id : undefined,\r\n                per_page: 1,\r\n                random: true,\r\n            })\r\n                .then(function (res) {\r\n                    if (res) {\r\n                        self.relatedvideo = res.data.data[0];\r\n                    }\r\n                });\r\n\r\n            // Register Listener\r\n            // console.log('Listener registered!');\r\n            //Backand.on('video_updated_' + self.film.url_id, function (data) {\r\n            //// console.log(self.film);\r\n            // console.log('Listener Triggered!');\r\n            // console.log(data);\r\n            //self.updateVideoObj();\r\n            /*_.each(data, function (a) {\r\n             self.film[a.Key] = a.value;\r\n             })*/\r\n            //});\r\n        }\r\n\r\n        // Listen for events from the videoplayer\r\n        $scope.$on('VideoPlayer:sourceChanged', function (event, video) {\r\n            self.film = video;\r\n            init(video);\r\n\r\n            // Update browser history\r\n            /*$state.transitionTo('video', {url_id: video.url_id}, {\r\n                location: true,\r\n                inherit: true,\r\n                // relative: $state.$current,\r\n                notify: false\r\n            });*/\r\n\r\n            $state.go('video', {url_id: video.url_id}, {notify: false, location: \"replace\"})\r\n        });\r\n\r\n        if (!$rootScope.isAuthenticated()) {\r\n            var endWatch = $rootScope.$watch('AppData.User', function (newValue, oldValue) {\r\n                if (newValue && angular.isString(newValue.id)) {\r\n                    console.log('User Logged In');\r\n                    self.checkUserActions();\r\n                    endWatch();\r\n                }\r\n            });\r\n        }\r\n\r\n        self.checkUserActions = function () {\r\n            if ($rootScope.isAuthenticated()) {\r\n                UserActions.canReact(self.film.id).then(function (res) {\r\n                    self.canReact = res;\r\n                }, function (error) {\r\n                    self.canReact = error;\r\n                });\r\n\r\n                if (self.film.disableCritique || (self.film.owner_id === $rootScope.AppData.User.id)) {\r\n                    console.log('owner');\r\n                    self.canCritique = false;\r\n                } else {\r\n                    UserActions.canCritique(self.film.id).then(function (res) {\r\n                        self.canCritique = res;\r\n                    }, function (error) {\r\n                        self.canCritique = error;\r\n                    });\r\n                }\r\n\r\n                UserActions.canRate(self.film.id).then(function (res) {\r\n                    self.canRate = res;\r\n                }, function (error) {\r\n                    self.canRate = error;\r\n                });\r\n            } else {\r\n                self.canCritique = true;\r\n            }\r\n        };\r\n\r\n        /*self.qComments = function () {\r\n         // Fetch Comments\r\n         DataService.collection('comments', [{fieldName: 'created_at', order: 'desc'}],\r\n         [\r\n         {fieldName: 'project', operator: 'in', value: self.film.id},\r\n         {fieldName: 'parentComment', operator: 'in', value: ''}\r\n         ],\r\n         20, false, false, 1).then(function (result) {\r\n         self.comments = result.data;\r\n         // console.log('comments: \", result.data);\r\n         });\r\n         };*/\r\n\r\n        self.qReactions = function () {\r\n            // Fetch Reactions\r\n            DataService.collection('reactions', {project: self.film.id, sort: 'created_at', per_page: 500})\r\n                .then(function (result) {\r\n                    self.reactions = result.data;\r\n                    self.chartedReactions = _.countBy(self.reactions.data, function (r) {\r\n                        return _.contains(self.reactions.data, r) ? r.emotion : undefined;\r\n                    });\r\n                    self.reactionCountMax = _.max(self.chartedReactions, function (i) {\r\n                        return i;\r\n                    });\r\n\r\n                    var sortable = [];\r\n                    for (var r in self.chartedReactions)\r\n                        sortable.push([r, self.chartedReactions[r]])\r\n                    sortable.sort(function (a, b) {\r\n                        return b[1] - a[1]\r\n                    });\r\n\r\n                    self.chartedReactions = _.object(sortable);\r\n                });\r\n        };\r\n\r\n        self.qCritiques = function () {\r\n            // Fetch Critiques\r\n            DataService.collection('critiques', {include: 'comments', project: self.film.id, per_page: 200, page: self.critiquesPage})\r\n                .then(function (result) {\r\n                    self.critiques = result.data.data;\r\n                    self.calcIwAverage(self.critiques);\r\n                });\r\n        };\r\n\r\n        self.qNominations = function () {\r\n            DataService.collection('nominations', {include: 'user,award', project: self.film.id, sort: 'created_at', per_page: 200, page: self.nominationsPage})\r\n                .then(function (result) {\r\n                    self.nominations = result.data.data;\r\n                    //// console.log('Nomination: ', result.data);\r\n                });\r\n        };\r\n\r\n        self.qWins = function () {\r\n            DataService.collection('wins', {project: self.film.id, sort: 'created_at'}).then(function (result) {\r\n                self.wins = result.data.data;\r\n                // console.log('AwardWin: ', result.data);\r\n            });\r\n        };\r\n\r\n        self.calcIwAverage = function (critiques) {\r\n            var total = 0;\r\n            _.each(critiques, function (a) {\r\n                total += a.overall;\r\n            });\r\n            self.critiqueAverage = total / critiques.length;\r\n        };\r\n\r\n        self.getEmoticonByEmotion = function (emotion) {\r\n            var reactions = $rootScope.generateReactions();\r\n            return _.findWhere(reactions, {emotion: emotion});\r\n        };\r\n\r\n        self.showMessageDialog = function () {\r\n            UserActions.checkAuth().then(function (res) {\r\n                if (res) {\r\n                    var params = {\r\n                        templateUrl: 'common/contactUserDialog.html',\r\n                        resolve: {\r\n                            recipient: function () {\r\n                                return self.videoOwner.id;\r\n                            }\r\n                        },\r\n                        controller: ContactUserDialogController\r\n                    };\r\n                    var msgModal = $modal.open(params);\r\n                }\r\n            }, function (err) {\r\n                UserActions.loginModal();\r\n            });\r\n        };\r\n\r\n        self.rateThrottled = false;\r\n        self.rate = function (direction) {\r\n            if (!!self.rateThrottled) {\r\n                return false;\r\n            }\r\n\r\n            if (!$rootScope.isAuthenticated()) {\r\n                UserActions.loginModal();\r\n                return false;\r\n            }\r\n\r\n            if ($rootScope.isNotVerified()) {\r\n                $rootScope.toastAction('Please verify your account so you can rate videos! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                return false;\r\n            }\r\n\r\n            self.rateThrottled = true;\r\n            var actionVerb = 'like';\r\n            if (self.canRate === true) {\r\n                DataService.save('ratings', {\r\n                    author_id: $rootScope.AppData.User.id,\r\n                    project_id: self.film.id,\r\n                    up: direction === 'up',\r\n                    down: direction === 'down'\r\n                }).then(function (res) {\r\n                    // console.log(res);\r\n                    switch (direction) {\r\n                        case 'up':\r\n                            // Increment film up_ratings_count\r\n                            self.film.up_ratings_count++;\r\n                            break;\r\n                        case 'down':\r\n                            // Increment film down_ratings_count\r\n                            self.film.down_ratings_count++;\r\n                            actionVerb = 'unlike';\r\n                            break;\r\n                    }\r\n\r\n                    self.updateVideoObj();\r\n                    angular.extend(res.data, {projectOwner: self.film.owner_id});\r\n                    self.checkUserActions();\r\n                });\r\n\r\n            } else if (angular.isObject(self.canRate)) {\r\n                //up is false && down is false\r\n                if (!self.canRate.up && !self.canRate.down) {\r\n                    DataService.update('ratings', self.canRate.id, {\r\n                        up: direction === 'up',\r\n                        down: direction === 'down',\r\n                    })\r\n                        .then(function (res) {\r\n                            switch (direction) {\r\n                                case 'up':\r\n                                    // Increment film up_ratings_count\r\n                                    self.film.up_ratings_count++;\r\n                                    break;\r\n                                case 'down':\r\n                                    // Increment film down_ratings_count\r\n                                    self.film.down_ratings_count++;\r\n                                    actionVerb = 'unlike';\r\n                                    break;\r\n                            }\r\n                            angular.extend(self.canRate, {up: direction === 'up', down: direction === 'down'});\r\n                            //self.updateVideoObj();\r\n                            angular.extend(res.data, {projectOwner: self.film.owner_id});\r\n                            //self.checkUserActions();\r\n                        });\r\n\r\n                    // up is already true && direction is up\r\n                } else if (!!self.canRate.up && direction === 'up') {\r\n                    //DataService.delete('Rating', self.canRate.id)\r\n                    angular.extend(self.canRate, {up: false});\r\n                    DataService.update('ratings', self.canRate.id, {up: false, down: false})\r\n                        .then(function (res) {\r\n                            self.film.up_ratings_count--;\r\n                            //self.updateVideoObj();\r\n                            angular.extend(res.data, {projectOwner: self.film.owner_id});\r\n                            //self.checkUserActions();\r\n                        });\r\n\r\n                    // down is already true && direction is down\r\n                } else if (!!self.canRate.down && direction === 'down') {\r\n                    //DataService.delete('Rating', self.canRate.id)\r\n                    angular.extend(self.canRate, {down: false});\r\n                    DataService.update('ratings', self.canRate.id, {up: false, down: false})\r\n                        .then(function (res) {\r\n                            self.film.down_ratings_count--;\r\n                            //self.updateVideoObj();\r\n                            angular.extend(res.data, {projectOwner: self.film.owner_id});\r\n                            //self.checkUserActions();\r\n                        });\r\n\r\n                    // down is true && direction is up || up is true && direction is down -> reversal\r\n                } else if ((!!self.canRate.down && direction === 'up') || (!!self.canRate.up && direction === 'down')) {\r\n                    var up = false, down = false;\r\n                    switch (direction) {\r\n                        case 'up':\r\n                            up = true;\r\n                            self.film.up_ratings_count++;\r\n                            self.film.down_ratings_count--;\r\n                            angular.extend(self.canRate, {up: up, down: down});\r\n                            break;\r\n                        case 'down':\r\n                            down = true;\r\n                            self.film.up_ratings_count--;\r\n                            self.film.down_ratings_count++;\r\n                            angular.extend(self.canRate, {up: up, down: down});\r\n                            actionVerb = 'unlike';\r\n                            break;\r\n                    }\r\n                    DataService.update('ratings', self.canRate.id, {up: up, down: down}).then(function (res) {\r\n                        //self.updateVideoObj();\r\n                        //self.checkUserActions();\r\n                        angular.extend(res.data, {projectOwner: self.film.owner_id});\r\n                    });\r\n                }\r\n            }\r\n            $timeout(function () {\r\n                            self.rateThrottled = false;\r\n                        }, 1000);\r\n        };\r\n\r\n        self.react = function (emotion) {\r\n            if (angular.isDefined(emotion)) {\r\n                if (!$rootScope.isAuthenticated()) {\r\n                    UserActions.loginModal();\r\n                    return false;\r\n                }\r\n\r\n                if ($rootScope.isNotVerified()) {\r\n                    $rootScope.toastAction('Please verify your account and join the conversation! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                    return false;\r\n                }\r\n\r\n                var actionVerb = 'react';\r\n                if (self.canReact === true) {\r\n                    DataService.save('reactions', {\r\n                        user_id: $rootScope.AppData.User.id,\r\n                        project_id: self.film.id,\r\n                        emotion: emotion.emotion\r\n                    }).then(function (resA) {\r\n                        self.film.reactions_count++;\r\n                        // self.updateVideoObj();\r\n                        self.checkUserActions();\r\n                        self.qReactions();\r\n                    });\r\n                } else if (angular.isObject(self.canReact)) {\r\n                    if (self.canReact.emotion !== emotion.emotion) {\r\n                        DataService.update('reactions', self.canReact.id, {\r\n                            emotion: emotion.emotion\r\n                        }).then(function (resA) {\r\n                            self.canReact = resA.data;\r\n                            // self.updateVideoObj();\r\n                            self.checkUserActions();\r\n                            self.qReactions();\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.canReactIcon = function () {\r\n            if (angular.isObject(self.canReact)) {\r\n                var emoticon = _.findWhere(self.emotions, {'emotion': self.canReact.emotion});\r\n                return angular.isObject(emoticon) ? emoticon.icon : false;\r\n            } else return false;\r\n        };\r\n\r\n        self.deleteCritique = function (c, ev) {\r\n            if (!$rootScope.isAuthenticated()) {\r\n                UserActions.loginModal();\r\n                return false;\r\n            }\r\n\r\n            if ($rootScope.isNotVerified()) {\r\n                $rootScope.toastAction('Please verify your account and join the conversation! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                return false;\r\n            }\r\n\r\n            var modalInstance = $modal.open({\r\n                templateUrl: 'common/confirmDialog.html',\r\n                controller: ['$scope', '$modalInstance', function ($scope, $modalInstance) {\r\n                    $scope.ok = function () {\r\n                        $modalInstance.close(true);\r\n                    };\r\n\r\n                    $scope.cancel = function () {\r\n                        $modalInstance.dismiss('cancel');\r\n                    };\r\n                }],\r\n                size: Foundation.MediaQuery.atLeast('large') ? 'tiny' : 'small',\r\n                keyboard: true\r\n            });\r\n            modalInstance.result.then(function () {\r\n                DataService.collection('nominations', [], [{\r\n                    critique: c.id\r\n                }]).then(function (noms) {\r\n                    var nom = noms.data.data[0];\r\n                    DataService.delete('Nominations', nom.id).then(function () {\r\n                        // Decrement film nominationCount\r\n                        self.film.nominationCount--;\r\n                    });\r\n\r\n                    DataService.delete('Critique', c.id).then(function () {\r\n                        $rootScope.toastMessage('Your critique was deleted.');\r\n                        // Decrement film critiques_count\r\n                        self.film.critiques_count--;\r\n                        self.updateVideoObj();\r\n                        self.checkUserActions();\r\n                        self.critiques = _.reject(self.critiques, function (a) {\r\n                            return a.id === c.id;\r\n                        });\r\n                    });\r\n                })\r\n            }, function () {\r\n                // console.info('Modal dismissed at: ' + new Date());\r\n            });\r\n        };\r\n\r\n        self.openCritiqueDialog = function ($event) {\r\n            if (self.canCritique !== true && self.canCritique !== false) {\r\n                return $state.go('video_critique', {video_url_id: self.film.url_id, url_id: self.canCritique.url_id});\r\n            }\r\n\r\n            CritiqueDialogController.$inject = ['$scope', '$modalInstance', 'critique', 'film', '$q', 'Analytics'];\r\n            function CritiqueDialogController($scope, $modalInstance, critique, film, $q, Analytics) {\r\n                zIndexPlayer();\r\n                $scope.critique = critique;\r\n                $scope.film = film;\r\n                $scope.ratingMax = 10;\r\n                $scope.makePrivateHelp = false;\r\n                $scope.processing = false;\r\n                $scope.canNominate = false;\r\n                $scope.errors = [];\r\n\r\n                if ($scope.film.type.id === '39704d3d-2941-11e6-b8db-86ac961c55b2') {\r\n                    DataService.collection('awards', { trailer:true }).then(function (result) {\r\n                        $scope.awardsList = result.data.Awards;\r\n                    });\r\n                } else {\r\n                    DataService.collection('awards').then(function (result) {\r\n                        $scope.awardsList = result.data.Awards;\r\n                    });\r\n                }\r\n\r\n                $scope.dialogModel = {\r\n                    award_id: null\r\n                };\r\n\r\n                $scope.nominated = {\r\n                    award_id: $scope.dialogModel.award_id,\r\n                    user_id: $rootScope.AppData.User.id,\r\n                    project_id: $scope.critique.project_id,\r\n                    critique_id: undefined\r\n                };\r\n\r\n                $scope.starArray = angular.copy([{\"num\": 0}, {\"num\": 1}, {\"num\": 2}, {\"num\": 3}, {\"num\": 4}, {\"num\": 5}, {\"num\": 6}, {\"num\": 7}, {\"num\": 8}, {\"num\": 9}, {\"num\": 10}].reverse());\r\n\r\n                $scope.calcOverall = function () {\r\n                    $scope.critique.overall = ($scope.critique.originality + $scope.critique.direction + $scope.critique.writing +\r\n                        $scope.critique.cinematography + $scope.critique.performances + $scope.critique.production +\r\n                        $scope.critique.pacing + $scope.critique.structure + $scope.critique.audio + $scope.critique.music) / 10;\r\n                };\r\n\r\n                $scope.$watchCollection('critique', function () {\r\n                    $scope.calcOverall();\r\n                });\r\n\r\n                $scope.$watch('critique.overall', function (newValue) {\r\n                    $scope.canNominate = newValue >= 6;\r\n                });\r\n\r\n                $scope.validateCritique = function () {\r\n                    $scope.errors = [];\r\n\r\n                    var failA = true;\r\n                    var failB = true;\r\n                    $scope.critique.body.trim();\r\n                    failA = $scope.critique.body.length < 1;\r\n                    if (failA) {\r\n                        $scope.errors.push('Tell us why you gave this critique an overall rating of ' + $scope.critique.overall);\r\n                    }\r\n                    failB = $scope.critique.originality < 1 || $scope.critique.direction < 1 || $scope.critique.writing < 1 ||\r\n                        $scope.critique.cinematography < 1 || $scope.critique.performances < 1 || $scope.critique.production < 1 ||\r\n                        $scope.critique.pacing < 1 || $scope.critique.structure < 1 || $scope.critique.audio < 1 || $scope.critique.music < 1;\r\n                    if (failB) {\r\n                        $scope.errors.push('Be sure to put a minimum of 1-star in every category.')\r\n                    }\r\n\r\n                    if(!failA && !failB) {\r\n                        $scope.postCritique();\r\n                    };\r\n                };\r\n\r\n                $scope.closeDialog = function () {\r\n                    zIndexPlayer(true);\r\n                    $modalInstance.close(true);\r\n                };\r\n\r\n                $scope.cancel = function () {\r\n                    zIndexPlayer(true);\r\n                    $modalInstance.dismiss('cancel');\r\n                };\r\n\r\n                $scope.hoveringOver = function (value) {\r\n                    $scope.overStar = value;\r\n                    $scope.percent = 100 * (value / $scope.max);\r\n                };\r\n\r\n                $scope.postCritique = function () {\r\n                    if ($scope.processing) {\r\n                        return false;\r\n                    }\r\n\r\n                    $scope.processing = true;\r\n                    $scope.critique.url_id = moment().valueOf();\r\n                    DataService.save('critiques?include=user,award', $scope.critique).then(function (res) {\r\n                        var obj = res.data.data;\r\n\r\n                        self.critiques.push(obj);\r\n                        self.calcIwAverage(self.critiques);\r\n                        // Increment film critiques_count\r\n                        self.film.critiques_count++;\r\n\r\n                        // register Action\r\n                        Analytics.trackEvent('video', 'critique', self.film.name);\r\n\r\n                        // if an award has been selected, create a nomination\r\n                        if (!!$scope.dialogModel.award_id && angular.isString($scope.dialogModel.award_id)) {\r\n                            $scope.nominated.critique_id = obj.id;\r\n                            $scope.nominated.award_id = $scope.dialogModel.award_id;\r\n                            DataService.save('nominations', $scope.nominated).then(function (nom) {\r\n                                // Increment film commentCount\r\n                                self.film.nominationCount++;\r\n                                self.updateVideoObj();\r\n                                // register Action\r\n                                self.qNominations();\r\n                                nom.critique = obj;\r\n                                Analytics.trackEvent('video', 'nominate', self.film.name);\r\n                            }, function (error) {\r\n                                alert('Failed to create new nomination, with error code: ' + error.message);\r\n                            })\r\n                        } else {\r\n\r\n                        }\r\n\r\n                    }, function (error) {\r\n                        alert('Failed to create new critique, with error code: ' + error.message);\r\n                        $scope.processing = false;\r\n                    }).then(function () {\r\n                        self.qCritiques();\r\n                        self.checkUserActions();\r\n                        $scope.closeDialog();\r\n                    });\r\n                };\r\n            }\r\n\r\n            UserActions.canCritique(self.film.id).then(function (res) {\r\n                // is logged in\r\n                if (res) {\r\n\r\n                    if ($rootScope.isNotVerified()) {\r\n                        $rootScope.toastAction('Please verify your account and join the conversation! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                        return false;\r\n                    }\r\n\r\n                    if (self.film.owner_id === $rootScope.AppData.User.id) {\r\n                        $rootScope.toastMessage('You cannot critique your own content.');\r\n                        return false;\r\n                    }\r\n\r\n                    $modal.open({\r\n                        templateUrl: 'common/critiqueDialog.html',\r\n                        resolve: {\r\n                            critique: function () {\r\n                                return {\r\n                                    originality: 0,\r\n                                    direction: 0,\r\n                                    writing: 0,\r\n                                    cinematography: 0,\r\n                                    performances: 0,\r\n                                    production: 0,\r\n                                    pacing: 0,\r\n                                    structure: 0,\r\n                                    audio: 0,\r\n                                    music: 0,\r\n                                    overall: 0,\r\n                                    private: false,\r\n                                    user_id: $rootScope.AppData.User.id,\r\n                                    body: '',\r\n                                    project_id: self.film.id\r\n                                };\r\n                            },\r\n                            film: function () {\r\n                                return self.film;\r\n                            }\r\n                        },\r\n                        controller: CritiqueDialogController,\r\n                        keyboard: true\r\n                    });\r\n                }\r\n            }, function (err) {\r\n                if (angular.isObject(err)) {\r\n                    return false;\r\n                } else UserActions.loginModal();\r\n            });\r\n        };\r\n\r\n        self.openShareDialog = function () {\r\n            $modal.open({\r\n                templateUrl: 'common/shareDialog.html',\r\n                resolve: {\r\n                    Video: function () {\r\n                        return self.film;\r\n                    }\r\n                },\r\n                size: Foundation.MediaQuery.atLeast('large') ? 'tiny' : 'small',\r\n                controller: ['$rootScope', '$scope', '$modalInstance', 'Video', function ($rootScope, $scope, $modalInstance, Video) {\r\n                    zIndexPlayer();\r\n                    $scope.video = Video;\r\n                    $scope.shareLink = window.location.origin + '/' + Video.url_id;\r\n                    $scope.cancel = function () {\r\n                        zIndexPlayer(true);\r\n                        $modalInstance.close();\r\n                    };\r\n                }]\r\n            })\r\n        };\r\n\r\n        self.openReactionDialog = function () {\r\n            UserActions.checkAuth(self.film.id).then(function (res) {\r\n                // is logged in\r\n                if (res) {\r\n\r\n                    if ($rootScope.isNotVerified()) {\r\n                        $rootScope.toastAction('Please verify your account and join the conversation! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                        return false;\r\n                    }\r\n\r\n                    var modalInstance = $modal.open({\r\n                        templateUrl: 'common/reactionDialog.html',\r\n                        resolve: {\r\n                            Video: function () {\r\n                                return self.film;\r\n                            },\r\n                            Reaction: function () {\r\n                                return self.canReact || null;\r\n                            },\r\n                            Emotions: function () {\r\n                                return self.emotions;\r\n                            }\r\n                        },\r\n                        size: Foundation.MediaQuery.atLeast('medium') ? 'tiny' : 'full',\r\n                        controller: ['$scope', '$modalInstance', 'Video', 'Reaction', 'Emotions', function ($scope, $modalInstance, Video, Reaction, Emotions) {\r\n                            zIndexPlayer();\r\n                            $scope.video = Video;\r\n                            $scope.emotions = Emotions;\r\n\r\n                            $scope.getEmoticonByEmotion = function (emotion) {\r\n                                return _.findWhere($scope.emotions, {emotion: emotion});\r\n                            };\r\n\r\n                            $scope.selectedEmotion = function (e) {\r\n                                zIndexPlayer(true);\r\n                                //$modalInstance.dismiss('cancel');\r\n                                $modalInstance.close(e);\r\n                            };\r\n\r\n                            $scope.cancel = function () {\r\n                                zIndexPlayer(true);\r\n                                $modalInstance.dismiss('cancel');\r\n                            };\r\n\r\n                            $scope.closeDialog = function () {\r\n                                zIndexPlayer(true);\r\n                                $modalInstance.dismiss('cancel');\r\n                            };\r\n\r\n                        }]\r\n                    });\r\n\r\n                    modalInstance.result.then(function (reaction) {\r\n                        self.react(reaction);\r\n                    }, function () {\r\n                        // console.info('Modal dismissed at: ' + new Date());\r\n                    }).then(function () {\r\n                        $timeout(function () {\r\n                            // console.log('remove is-reveal-open');\r\n                            jQuery('body').removeClass('is-reveal-open')\r\n                        }, 500);\r\n                    });\r\n                }\r\n            }, function (err) {\r\n                // console.log(err);\r\n                if (angular.isObject(err)) {\r\n                    return false;\r\n                } else UserActions.loginModal();\r\n            });\r\n        };\r\n\r\n        self.openAddToDialog = function () {\r\n            $modal.open({\r\n                templateUrl: 'common/shareDialog.html',\r\n                resolve: {\r\n                    Video: function () {\r\n                        return self.film;\r\n                    }\r\n                },\r\n                size: Foundation.MediaQuery.atLeast('large') ? 'tiny' : 'small',\r\n                controller: ['$scope', '$modalInstance', 'Video', function ($scope, $modalInstance, Video) {\r\n                    zIndexPlayer();\r\n                    $scope.video = Video;\r\n                    $scope.shareLink = window.location.origin + '/' + Video.url_id;\r\n                    $scope.cancel = function () {\r\n                        zIndexPlayer(true);\r\n                        $modalInstance.close();\r\n                    };\r\n                }]\r\n            })\r\n        };\r\n\r\n        self.toFavorites = function () {\r\n            return $rootScope.toFavorites(self.film);\r\n        };\r\n\r\n        self.toWatchLater = function () {\r\n            return $rootScope.toWatchLater(self.film);\r\n        };\r\n\r\n        self.toggleWidthMode = function () {\r\n            $window.localStorage.playerResponsiveMode = self.playerResponsiveMode = !self.playerResponsiveMode;\r\n            $timeout(function () {\r\n                $window.videoPlayer.resize();\r\n                //fail-safe\r\n                $timeout(function () {\r\n                    $window.videoPlayer.resize();\r\n                }, 500);\r\n            }, 100);\r\n        };\r\n\r\n        $scope.$on('$destroy', function (event) {\r\n            //$scope.commentSubscribe.cancel();\r\n        });\r\n\r\n        self.updateVideoObj = function () {\r\n            return DataService.item('projects', self.film.id)\r\n                .then(function (a) {\r\n                    console.log('Project Updated: ', a);\r\n                    self.film = a.data.data;\r\n                });\r\n        };\r\n\r\n        self.toggleLights = function () {\r\n            self.lightsOff = !self.lightsOff;\r\n            var overlay = jQuery('#overlay');\r\n            var body = jQuery('body');\r\n            overlay.fadeToggle(1000);\r\n            /* Choose desired delay */\r\n            if (!self.lightsOff) {\r\n                $timeout(function () {\r\n                    overlay.removeClass('highlight');\r\n                    body.removeClass('cinema-mode');\r\n                }, 1000);\r\n                /* Same delay */\r\n            } else {\r\n                overlay.addClass('highlight');\r\n                body.addClass('cinema-mode');\r\n            }\r\n        };\r\n\r\n        self.reportDialog = function () {\r\n            var modalInstance = $modal.open({\r\n                templateUrl: 'common/reportVideoDialog.html',\r\n                resolve: {\r\n                    Video: function () {\r\n                        return self.film;\r\n                    }\r\n                },\r\n                closeOnClick: false,\r\n                size: Foundation.MediaQuery.atLeast('medium') ? 'small' : 'full',\r\n                controller: ['$scope', '$modalInstance', 'DataService', 'Video', function ($scope, $modalInstance, DataService, Video) {\r\n                    zIndexPlayer();\r\n                    $scope.video = Video;\r\n                    $scope.report = {\r\n                        name: '',\r\n                        email: '',\r\n                        body: '',\r\n                        project_id: $scope.video.id,\r\n                        video: $scope.video.url_id\r\n                    };\r\n\r\n                    $scope.cancel = function () {\r\n                        zIndexPlayer(true);\r\n                        $modalInstance.dismiss('cancel');\r\n                    };\r\n\r\n                    $scope.closeDialog = function () {\r\n                        zIndexPlayer(true);\r\n                        $modalInstance.close($scope.report);\r\n                    };\r\n                }]\r\n            });\r\n\r\n            modalInstance.result.then(function (report) {\r\n                DataService.mail('report', report).then(function () {\r\n                    $rootScope.toastMessage('Your Report has been Sent');\r\n                });\r\n            }, function () {\r\n                // console.info('Modal dismissed at: ' + new Date());\r\n            }).then(function () {\r\n                $timeout(function () {\r\n                    // console.log('remove is-reveal-open');\r\n                    jQuery('body').removeClass('is-reveal-open')\r\n                }, 500);\r\n            });\r\n        };\r\n\r\n        function zIndexPlayer(remove) {\r\n            var vidDiv = jQuery('.flex-video');\r\n            !!remove ? vidDiv.css('z-index', '') : vidDiv.css('z-index', 0);\r\n        }\r\n\r\n        //Lets begin\r\n        init(self.film);\r\n    }\r\n\r\n    VideoCritiqueCtrl.$inject = ['$rootScope', '$scope', 'Critique', 'UserActions', 'DataService', '_'];\r\n    function VideoCritiqueCtrl($rootScope, $scope, Critique, UserActions, DataService, _) {\r\n        var self = this;\r\n        self.commentsPage = 1;\r\n\r\n        // Fetch Critique\r\n        var init = function (critique) {\r\n            self.critique = critique;\r\n            $scope.commentsParent = self.critique;\r\n\r\n            // Fetch Comments\r\n            DataService.collection('comments', {\r\n                critique: self.critique.id,\r\n                per_page: 10,\r\n                page: self.commentsPage,\r\n                replies: false\r\n            }).then(function (result) {\r\n                self.comments = result.data;\r\n            });\r\n\r\n        };\r\n        init(Critique.data.data);\r\n    }\r\n\r\n    VideoCritiqueEditCtrl.$inject = ['$rootScope', '$scope', 'DataService', '$state', 'Critique'];\r\n    function VideoCritiqueEditCtrl($rootScope, $scope, DataService, $state, Critique) {\r\n        $scope.critique = Critique.data.data;\r\n        $scope.ratingMax = 10;\r\n        $scope.makePrivateHelp = false;\r\n\r\n        $scope.editedCritique = angular.copy($scope.critique);\r\n\r\n        DataService.collection('awards')\r\n            .then(function (result) {\r\n                $scope.awardsList = result.data.awards;\r\n            });\r\n\r\n\r\n        $scope.update = function () {\r\n            $scope.editedCritique.edited_at = moment().toDate();\r\n            // $scope.editedCritique.private = !!$scope.editedCritique.private;\r\n            DataService.update('critiques', $scope.critique.id, $scope.editedCritique).then(function (res) {\r\n                    $rootScope.toastMessage('Critique Updated');\r\n                    /*if ($state.is('profile_critique-edit'))\r\n                     $state.go('profile_critiqueselfid: self.critique.id});*/\r\n                    if ($state.is('video_critique-edit'))\r\n                        $state.go('video_critique', {\r\n                            video_url_id: $rootScope.$stateParams.video_url_id, url_id: $scope.critique.url_id\r\n                        });\r\n                }, function (err) {\r\n                    // console.log(err);\r\n                    $rootScope.toastMessage('Something went wrong...')\r\n                }\r\n            )\r\n        };\r\n\r\n        $scope.starArray = angular.copy([{\"num\": 0}, {\"num\": 1}, {\"num\": 2}, {\"num\": 3}, {\"num\": 4}, {\"num\": 5}, {\"num\": 6}, {\"num\": 7}, {\"num\": 8}, {\"num\": 9}, {\"num\": 10}].reverse());\r\n\r\n        $scope.hoveringOver = function (value) {\r\n            $scope.overStar = value;\r\n            $scope.percent = 100 * (value / $scope.max);\r\n        };\r\n\r\n        $scope.calcOverall = function () {\r\n            $scope.editedCritique.overall = ($scope.editedCritique.originality + $scope.editedCritique.direction + $scope.editedCritique.writing +\r\n                $scope.editedCritique.cinematography + $scope.editedCritique.performances + $scope.editedCritique.production +\r\n                $scope.editedCritique.pacing + $scope.editedCritique.structure + $scope.editedCritique.audio + $scope.editedCritique.music) / 10;\r\n        };\r\n\r\n        $scope.$watchCollection('editedCritique', function () {\r\n            $scope.calcOverall();\r\n        });\r\n    }\r\n\r\n    ProfileCtrl.$inject = ['$rootScope', 'filepickerService', 'User', 'UserStats', 'AuthService', 'Upload', '_'];\r\n    function ProfileCtrl($rootScope, filepickerService, User, UserStats, AuthService, Upload, _) {\r\n        $rootScope.metadata.title = 'Profile';\r\n        var self = this;\r\n        self.user = User;\r\n        self.userStats = UserStats;\r\n        // self.updateAvatar = _.throttle(updateAvatar, 1000);\r\n        // self.updateCoverPhoto = _.throttle(updateCoverPhoto, 1000);\r\n        self.pickAvatar = pickAvatar;\r\n        self.pickBanner = pickBanner;\r\n\r\n        self.getEmoticonByEmotion = function (emotion) {\r\n            var reactions = $rootScope.generateReactions();\r\n            return _.findWhere(reactions, {emotion: emotion});\r\n        };\r\n\r\n        self.generatePublicId = function (type) {\r\n            return self.user.url_id + '_' + type + '_' + moment().valueOf();\r\n        };\r\n\r\n        function pickBanner(){\r\n            filepickerService.pick(\r\n                {\r\n                    cropRatio: 32/7,\r\n                    mimetype: 'image/*',\r\n                    services: ['CONVERT', 'COMPUTER', 'FACEBOOK', 'GOOGLE_DRIVE', 'WEBCAM', 'INSTAGRAM'],\r\n                    conversions: ['crop', 'rotate', 'filter'],\r\n                    customSourcePath: self.user.url_id + '/banners/'\r\n                },\r\n                function (Blob){\r\n                    self.user.coverPhoto = Blob.url + '?cache=true';\r\n                    AuthService.updateUser(self.user).then(function (res) {\r\n                        $rootScope.toastMessage('Cover Photo Updated!');\r\n                    });                }\r\n            );\r\n        }\r\n        function pickAvatar(){\r\n            filepickerService.pick(\r\n                {\r\n                    cropRatio: 1/1,\r\n                    mimetype: 'image/*',\r\n                    services: ['CONVERT', 'COMPUTER', 'FACEBOOK', 'GOOGLE_DRIVE', 'WEBCAM', 'INSTAGRAM'],\r\n                    conversions: ['crop', 'rotate', 'filter'],\r\n                    customSourcePath: self.user.url_id + '/avatars/'\r\n                },\r\n                function (Blob){\r\n                    self.user.avatar = Blob.url + '?cache=true';\r\n                    AuthService.updateUser(self.user).then(function (res) {\r\n                        $rootScope.toastMessage('Avatar Updated!');\r\n                    });\r\n                }\r\n            );\r\n        }\r\n\r\n        /*function updateAvatar(file) {\r\n            Upload.upload({\r\n                url: 'https://api.cloudinary.com/v1_1/indiewise/upload',\r\n                params: {upload_preset: 'r0kuyqef'},\r\n                data: {file: file, public_id: self.generatePublicId('avatar')},\r\n                skipAuthorization: true  // `Authorization: Bearer <token>` will not be sent on this request.\r\n            }).then(function (resp) {\r\n                console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);\r\n                self.user.avatar = resp.data.secure_url;\r\n                AuthService.updateUser(self.user).then(function (res) {\r\n                    $rootScope.toastMessage('Avatar Updated!');\r\n                });\r\n            }, function (resp) {\r\n                console.log('Error status: ' + resp.status);\r\n            }, function (evt) {\r\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\r\n                console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);\r\n            });\r\n        }*/\r\n\r\n        /*function updateCoverPhoto(file) {\r\n            Upload.upload({\r\n                url: 'https://api.cloudinary.com/v1_1/indiewise/upload',\r\n                params: {upload_preset: 'jmy7rdcs'},\r\n                data: {file: file, public_id: Profile.generatePublicId('cover')},\r\n                skipAuthorization: true  // `Authorization: Bearer <token>` will not be sent on this request.\r\n            }).then(function (resp) {\r\n                console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);\r\n                self.user.coverPhoto = resp.data.secure_url;\r\n                AuthService.updateUser(self.user).then(function (res) {\r\n                    $rootScope.toastMessage('Cover Photo Updated!');\r\n                });\r\n            }, function (resp) {\r\n                console.log('Error status: ' + resp.status);\r\n            }, function (evt) {\r\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\r\n                console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);\r\n            });\r\n\r\n        }*/\r\n\r\n    }\r\n\r\n    ProfileUploadController.$inject = ['$rootScope', '$state', 'User', '$http', 'DataService', '$window', 'Upload', 'filepickerService', '_'];\r\n    function ProfileUploadController($rootScope, $state, User, $http, DataService, $window, Upload, filepickerService, _) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.uploadType = 2;\r\n        self.newVideo = {\r\n            name: '',\r\n            description: '',\r\n            director: '',\r\n            writer: '',\r\n            producers: '',\r\n            keyCast: '',\r\n            language: '00000000-0000-6b6e-4371-305344643451',\r\n            completionDate: '',\r\n            filmingCountry: undefined,\r\n            originCountry: undefined,\r\n            owner: $rootScope.AppData.User.id,\r\n            genres: [],\r\n            type: undefined,\r\n            runTime: 0,\r\n            thumbnail_url: '',\r\n            hosting_type: undefined,\r\n            video_url: '',\r\n            tags: '',\r\n            unlist: false,\r\n            disableComments: false,\r\n            disableCritique: false,\r\n            nsfw: false,\r\n            copyrightOwner: false\r\n        };\r\n        self.genresArr = [];\r\n\r\n        self.runtime = {\r\n            hours: 0,\r\n            mins: 0,\r\n            secs: 0\r\n        };\r\n\r\n        self.maxDate = moment().toDate();\r\n\r\n        self.selectedGenre = null;\r\n\r\n        $rootScope.generateGenres().then(function (res) {\r\n            $rootScope.genresList = self.genresList = res;\r\n        });\r\n        $rootScope.generateTypes().then(function (res) {\r\n            $rootScope.typesList = self.typesList = res;\r\n        });\r\n        $rootScope.generateCountries().then(function (res) {\r\n            $rootScope.countryList = self.countryList = res;\r\n        });\r\n        $rootScope.generateLanguages().then(function (res) {\r\n            $rootScope.languageList = self.languageList = res;\r\n        });\r\n\r\n        self.runtimeToSeconds = function () {\r\n            self.newVideo.runTime = (self.runtime.hours * 3600) + (self.runtime.mins * 60) + self.runtime.secs;\r\n        };\r\n\r\n        self.getUserFilmPath = function () {\r\n            return self.user.url_id + '/films/';\r\n        };\r\n\r\n        self.isURL = function (str) {\r\n            var urlRegex = '[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)';\r\n            var url = new RegExp(urlRegex, 'i');\r\n            return str.length < 2083 && url.test(str);\r\n        };\r\n\r\n        self.getThumbnailUrl = function (url) {\r\n            if (url != null && url != '') {\r\n                if (url.indexOf('youtu') != -1) {\r\n                    var video_id = url.indexOf('v=') != -1 ? url.split('v=')[1].split('&')[0] : url.split('be/')[1];\r\n                    self.newVideo.hosting_type = 'youtube';\r\n                    self.newVideo.hosting_id = video_id;\r\n                    return self.newVideo.thumbnail_url = 'https://img.youtube.com/vi/' + video_id + '/hqdefault.jpg';\r\n                } else if (url.indexOf('vimeo') != -1) {\r\n                    var video_id = url.split('.com/')[1];\r\n                    self.newVideo.hosting_type = 'vimeo';\r\n                    self.newVideo.hosting_id = video_id;\r\n                    $http.jsonp('https://api.vimeo.com/videos/' + video_id + '/pictures.json?callback=JSON_CALLBACK').then(function (res) {\r\n                        //$http.jsonp('http://www.vimeo.com/api/v2/video/' + video_id + '.json?callback=JSON_CALLBACK').then(function (res) {\r\n                        return self.newVideo.thumbnail_url = angular.isDefined(res.data[0].sizes[6])\r\n                            ? res.data[0].sizes[6] : angular.isDefined(res.data[0].sizes[5])\r\n                            ? res.data[0].sizes[5] : angular.isDefined(res.data[0].sizes[4])\r\n                            ? res.data[0].sizes[4] : res.data[0].sizes[3];\r\n                    });\r\n                } else if (url.indexOf('dailymotion') != -1) {\r\n                    var video_id = url.split('video/')[1].split('_')[0];\r\n                    self.newVideo.hosting_type = 'dailymotion';\r\n                    self.newVideo.hosting_id = video_id;\r\n                    $http.get('https://api.dailymotion.com/video/' + video_id + '?fields=thumbnail_large_url').then(function (res) {\r\n                        return self.newVideo.thumbnail_url = res.data.thumbnail_large_url;\r\n                    });\r\n                } else if (url.indexOf('youku') != -1) {\r\n                    self.newVideo.hosting_type = 'youku';\r\n                    self.newVideo.hosting_id = undefined;\r\n\r\n                } else if (url.indexOf('vine') != -1) {\r\n                    self.newVideo.hosting_type = 'vine';\r\n                    self.newVideo.hosting_id = undefined;\r\n                    $http.get('/utils/get-vine-data.php?url=' + url).then(function (res) {\r\n                        return self.newVideo.thumbnail_url = res.data;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        self.validateNewVideoForm = function () {\r\n            var test = true;\r\n            var msg = 'Your project is missing:';\r\n            if (!self.newVideo.name.length) {\r\n                msg += 'Project Title, ';\r\n                $rootScope.toastMessage();\r\n                test = false;\r\n            }\r\n            if (self.uploadType == 2 && !self.newVideo.video_url.length) {\r\n                msg += 'Video URL, ';\r\n                test = false;\r\n            }\r\n            if (angular.isUndefined(self.genresArr) || (angular.isArray(self.genresArr) && !self.genresArr.length)) {\r\n                msg += 'Genres, ';\r\n                test = false;\r\n            }\r\n            if (angular.isUndefined(self.newVideo.type)) {\r\n                msg += 'Type, ';\r\n                test = false;\r\n            }\r\n            if (angular.isUndefined(self.newVideo.language)) {\r\n                msg += 'Language, ';\r\n                test = false;\r\n            }\r\n            if (self.newVideo.runTime == 0) {\r\n                msg += 'Duration';\r\n                test = false;\r\n            }\r\n            if (!test) {\r\n                $rootScope.toastMessage(msg);\r\n                alert(msg);\r\n            }\r\n            return test;\r\n        };\r\n\r\n        self.syncGenres = function (bool, item) {\r\n            if (bool) {\r\n                // add item\r\n                self.genresArr.push(item);\r\n            } else {\r\n                // remove item\r\n                for (var i = 0; i < self.genresArr.length; i++) {\r\n                    if (self.genresArr[i].id == item.id) {\r\n                        self.genresArr.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.isCheckedGenre = function (id) {\r\n            var match = false;\r\n            for (var i = 0; i < self.genresArr.length; i++) {\r\n                if (self.genresArr[i].id == id) {\r\n                    match = true;\r\n                }\r\n            }\r\n            return match;\r\n        };\r\n\r\n        self.submitNewVideo = function () {\r\n            if (!!self.validateNewVideoForm()) {\r\n                if (angular.isArray(self.genresArr) && self.genresArr.length) {\r\n                    self.newVideo.genres = _.pluck(self.genresArr, 'id');\r\n                }\r\n\r\n                var filmParams = {\r\n                    name: self.newVideo.name,\r\n                    description: self.newVideo.description,\r\n                    director: self.newVideo.director,\r\n                    writer: self.newVideo.writer,\r\n                    producers: self.newVideo.producers,\r\n                    keyCast: self.newVideo.keyCast,\r\n                    completionDate: moment({year: self.newVideo.completionDate}).startOf('year').format('YYYY-MM-DD HH:MM:SS'),\r\n                    owner_id: self.newVideo.owner,\r\n                    runTime: self.newVideo.runTime,\r\n                    video_url: self.newVideo.video_url,\r\n                    thumbnail_url: self.newVideo.thumbnail_url,\r\n                    hosting_type: self.newVideo.hosting_type,\r\n                    hosting_id: self.newVideo.hosting_id,\r\n                    tags: self.newVideo.tags,\r\n                    disableComments: self.newVideo.disableComments || false,\r\n                    disableCritique: self.newVideo.disableCritique || false,\r\n                    language_id: self.newVideo.language,\r\n                    filmingCountry_id: self.newVideo.filmingCountry,\r\n                    // originCountry: self.newVideo.originCountry,\r\n                    type_id: self.newVideo.type,\r\n                    unlist: self.newVideo.unlist,\r\n                    nsfw: self.newVideo.nsfw,\r\n                    copyrightOwner: self.newVideo.copyrightOwner,\r\n                    genres: self.newVideo.genres\r\n                };\r\n\r\n                DataService.save('projects', filmParams)\r\n                    .then(function (film) {\r\n                        console.log(film.data.data);\r\n                        $rootScope.toastMessage('Video Uploaded Successfully');\r\n                        // register Action\r\n                        $state.go('video', {url_id: film.data.data.url_id});\r\n                        //return film;\r\n                    }, function (err) {\r\n                        // console.log(err);\r\n                        alert('Failed to create new video, with error: ' + err.message);\r\n                    });\r\n\r\n            } else {\r\n                $rootScope.toastMessage('Please check the form!');\r\n            }\r\n        };\r\n\r\n\r\n        self.pickArtwork = function (){\r\n            filepickerService.pick(\r\n                {\r\n                    cropRatio: 4/3,\r\n                    mimetype: 'image/*',\r\n                    services: ['CONVERT', 'COMPUTER', 'FACEBOOK', 'GOOGLE_DRIVE', 'INSTAGRAM', 'URL'],\r\n                    conversions: ['crop', 'rotate', 'filter'],\r\n                    customSourcePath: self.user.url_id + '/films/'\r\n                },\r\n                function (Blob){\r\n                    self.newVideo.thumbnail_url = Blob.url + '?cache=true';\r\n                    $rootScope.$digest();\r\n                }\r\n            );\r\n        };\r\n\r\n\r\n        self.uploadArtwork = function (file) {\r\n            Upload.upload({\r\n                url: 'https://api.cloudinary.com/v1_1/indiewise/upload',\r\n                params: {upload_preset: 'dzachn6p'},\r\n                data: {file: file},\r\n                skipAuthorization: true  // `Authorization: Bearer <token>` will not be sent on this request.\r\n            }).then(function (resp) {\r\n                console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);\r\n                self.newVideo.thumbnail_url = resp.data.secure_url;\r\n            }, function (resp) {\r\n                console.log('Error status: ' + resp.status);\r\n            }, function (evt) {\r\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\r\n                console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);\r\n            });\r\n        };\r\n\r\n\r\n        self.files = []; //JSON.parse($window.localStorage.getItem('files') || '[]');\r\n\r\n        self.pickFile = function () {\r\n\r\n            filepickerService.pick({\r\n                    mimetype: 'video/mp4',\r\n                    customSourcePath: self.user.url_id + '/films/'\r\n                },\r\n                self.onSuccess\r\n            );\r\n        };\r\n\r\n        self.onSuccess = function (Blob) {\r\n            self.newVideo.hosting_type = 'HTML5';\r\n            self.newVideo.video_url = Blob.url + '?cache=true';\r\n            // self.files.push(Blob);\r\n            // $window.localStorage.setItem('files', JSON.stringify(self.files));\r\n        };\r\n    }\r\n\r\n    ProfileVideoEditCtrl.$inject = ['$rootScope', '$state', '$modal', 'UserActions', 'Project', 'DataService', 'anchorSmoothScroll', 'Upload', '_'];\r\n    function ProfileVideoEditCtrl($rootScope, $state, $modal, UserActions, Project, DataService, anchorSmoothScroll, Upload, _) {\r\n        var self = this;\r\n        self.project = Project.data.data;\r\n        self.uploadType = 2;\r\n        self.genresArr = self.project.genres;\r\n        self.saveComplete = false;\r\n        self.editedProject = angular.copy(self.project);\r\n        angular.extend(self.editedProject, {\r\n            type_id: self.project.type_id,\r\n            language_id: self.project.language_id,\r\n            filmingCountry_id: self.project.filmingCountry_id,\r\n            completionDate: moment(self.project.completionDate).year()\r\n        });\r\n        // console.log(self.editedProject);\r\n\r\n        if (self.project.runTime) {\r\n            var totalSeconds = self.project.runTime;\r\n            self.runtime = {};\r\n            self.runtime.hours = Math.floor(totalSeconds / 3600);\r\n            totalSeconds %= 3600;\r\n            self.runtime.mins = Math.floor(totalSeconds / 60);\r\n            self.runtime.secs = totalSeconds % 60;\r\n        }\r\n\r\n        if (angular.isString(self.project.video_url)) {\r\n            self.uploadType = 2;\r\n        }\r\n\r\n        $rootScope.generateGenres().then(function (res) {\r\n            $rootScope.genresList = self.genresList = res;\r\n        });\r\n        $rootScope.generateTypes().then(function (res) {\r\n            $rootScope.typesList = self.typesList = res;\r\n        });\r\n        $rootScope.generateCountries().then(function (res) {\r\n            $rootScope.countryList = self.countryList = res;\r\n        });\r\n        $rootScope.generateLanguages().then(function (res) {\r\n            $rootScope.languageList = self.languageList = res;\r\n        });\r\n\r\n        self.syncGenres = function (bool, item) {\r\n            if (bool) {\r\n                // add item\r\n                self.genresArr.push(item);\r\n                /*DataService.save('Genres', {project: self.editedProject.id, genre: item.id}, true, true)\r\n                 .then(function (res) {\r\n                 self.genresArr.push(res.data);\r\n                 });*/\r\n            } else {\r\n                // remove item\r\n                for (var i = 0; i < self.genresArr.length; i++) {\r\n                    if (self.genresArr[i].id == item.id) {\r\n                        DataService.delete('Genres', self.genresArr[i].id);\r\n                        self.genresArr.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.isCheckedGenre = function (id) {\r\n            var match = false;\r\n            for (var i = 0; i < self.genresArr.length; i++) {\r\n                if (self.genresArr[i].id == id) {\r\n                    match = true;\r\n                }\r\n            }\r\n            return match;\r\n        };\r\n\r\n        self.runtimeToSeconds = function () {\r\n            self.editedProject.runTime = self.project.runTime = (self.runtime.hours * 3600) + (self.runtime.mins * 60) + self.runtime.secs;\r\n        };\r\n\r\n        self.isURL = function (str) {\r\n            var urlRegex = '[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)';\r\n            var url = new RegExp(urlRegex, 'i');\r\n            return str.length < 2083 && url.test(str);\r\n        };\r\n\r\n        self.getThumbnailUrl = function (url) {\r\n            if (url != null && url != '') {\r\n                if (url.indexOf('youtu') != -1) {\r\n                    var video_id = url.split('v=')[1].split('&')[0];\r\n                    return self.editedProject.thumbnail_url = self.project.thumbnail_url = 'http://img.youtube.com/vi/' + video_id + '/mqdefault.jpg';\r\n                } else if (url.indexOf('vimeo') != -1) {\r\n                    var video_id = url.split('.com/')[1];\r\n                    $http.jsonp('http://www.vimeo.com/api/v2/video/' + video_id + '.json?callback=JSON_CALLBACK').then(function (res) {\r\n                        return self.editedProject.thumbnail_url = self.project.thumbnail_url = res.data[0].thumbnail_large;\r\n                    });\r\n                } else if (url.indexOf('dailymotion') != -1) {\r\n                    var video_id = url.split('video/')[1].split('_')[0];\r\n                    $http.get('https://api.dailymotion.com/video/' + video_id + '?fields=thumbnail_large_url').then(function (res) {\r\n                        return self.editedProject.thumbnail_url = self.project.thumbnail_url = res.data.thumbnail_large_url;\r\n                    });\r\n                } else if (url.indexOf('youku') != -1) {\r\n\r\n                } else if (url.indexOf('vine') != -1) {\r\n                    $http.get('api/utils/get-vine-data?url=' + url).then(function (res) {\r\n                        return self.editedProject.thumbnail_url = self.project.thumbnail_url = res.data;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        self.uploadArtwork = function (file) {\r\n            Upload.upload({\r\n                url: 'https://api.cloudinary.com/v1_1/indiewise/upload',\r\n                params: {upload_preset: 'dzachn6p'},\r\n                data: {file: file},\r\n                skipAuthorization: true  // `Authorization: Bearer <token>` will not be sent on this request.\r\n            }).then(function (resp) {\r\n                console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);\r\n                self.editedProject.thumbnail_url = resp.data.secure_url;\r\n                DataService.update('projects', self.editedProject.id, self.editedProject);\r\n            }, function (resp) {\r\n                console.log('Error status: ' + resp.status);\r\n            }, function (evt) {\r\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\r\n                console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);\r\n            });\r\n        };\r\n\r\n        self.updateProject = function () {\r\n            self.editedProject.genres = _.pluck(self.genresArr, 'id');\r\n            self.editedProject.completionDate = moment({year: self.editedProject.completionDate}).startOf('year').format('YYYY-MM-DD HH:mm:ss');\r\n            DataService.update('projects', self.editedProject.id, self.editedProject)\r\n                .then(function (res) {\r\n                    // console.log(res);\r\n                    self.saveComplete = true;\r\n                    // anchorSmoothScroll.scrollTo('success');\r\n                    $rootScope.toastMessage('Video Updated');\r\n                    $state.go('profile.videos');\r\n                });\r\n        };\r\n\r\n        /*self.deleteProject = function (ev) {\r\n         if ($rootScope.AppData.User && ($rootScope.AppData.User.id === self.project.owner.id)) {\r\n         var confirm = $modal.confirm()\r\n         .title('Would you like to delete your project?')\r\n         //.content('All of the banks have agreed to <span class=\"debt-be-gone\">forgive</span> you your debts.')\r\n         //.ariaLabel('Lucky day')\r\n         .targetEvent(ev)\r\n         .ok('Delete it!')\r\n         .cancel('Never mind');\r\n         $modal.show(confirm).then(function () {\r\n         //self.project.set('disableProject', true);\r\n         self.project.destroy({\r\n         success: function (myObject) {\r\n         // The object was deleted from the Parse Cloud.\r\n         $state.go('profile');\r\n         },\r\n         error: function (myObject, error) {\r\n         // The delete failed.\r\n         // error is a Parse.Error with an error code and message.\r\n         }\r\n         });\r\n         $state.go('profile');\r\n         }, function () {\r\n         //$scope.status = 'You decided to keep your debt.';\r\n         });\r\n         }\r\n         }*/\r\n\r\n    }\r\n\r\n    ProfilePlaylistsController.$inject = ['$rootScope', 'DataService', 'User', 'Playlists', 'UserActions', '_', '$interval', '$http'];\r\n    function ProfilePlaylistsController($rootScope, DataService, User, Playlists, UserActions, _, $interval, $http) {\r\n        var self = this;\r\n        self.user = User.data;\r\n        self.playlists = Playlists.data.playlists;\r\n        self.playlistItems = [];\r\n        var hasFave = _.findWhere(self.playlists, {name: 'Favorites', private: true});\r\n        self.selectedPlaylist = !!hasFave ? hasFave.id : self.playlists.length ? self.playlists[0].id : null;\r\n\r\n        self.loadPlaylistItems = function () {\r\n            DataService.collection('playlistItems', {playlist: self.selectedPlaylist, include: 'project.owner'})\r\n                .then(function (res) {\r\n                    // console.log(res);\r\n                    self.playlistItems = res.data.data;\r\n                })\r\n        };\r\n\r\n        self.removeItem = function (id) {\r\n            UserActions.checkAuth().then(function (res) {\r\n                if (res) {\r\n                    DataService.delete('PlaylistItem', id).then(function () {\r\n                        return self.playlists = _.reject(self.playlists, function (a) {\r\n                            return a.id === id;\r\n                        });\r\n                    })\r\n                }\r\n            });\r\n        };\r\n\r\n        // autoload if preselect\r\n        if (angular.isString(self.selectedPlaylist)) {\r\n            self.loadPlaylistItems();\r\n        }\r\n    }\r\n\r\n    ProfileSettingsController.$inject = ['$rootScope', 'AuthService', 'User', 'Genres', 'UserTypes', 'DataService', 'anchorSmoothScroll', '_', '$window', '$intercom', '$mdDialog'];\r\n    function ProfileSettingsController($rootScope, AuthService, User, Genres, UserTypes, DataService, anchorSmoothScroll, _, $window, $intercom, $mdDialog) {\r\n        var self = this;\r\n        self.countries = [];\r\n        self.genresArr = [];\r\n        self.typesArr = [];\r\n        self.saveComplete = false;\r\n        self.updating = false;\r\n        User.dob = moment(User.dob).startOf('day').toDate();\r\n        User.settings = angular.isObject(User.settings) ? User.settings : JSON.parse(User.settings||'{}');\r\n        self.user = User;\r\n        self.genresArr = User.genres; //Genres.data.data;\r\n        self.typesArr = User.types;// UserTypes.data.data;\r\n        self.updateUser = _.throttle(updateUser, 1000);\r\n        var pwSetting = $window.localStorage.getItem('pwAllowPushNotifications');\r\n        self.notificationsActive = pwSetting !== 'undefined' && !!JSON.parse(pwSetting);\r\n        self.toggleNotifications = toggleNotifications;\r\n        self.requestVerificationEmail = requestVerificationEmail;\r\n        self.confirmTerminate = confirmTerminate;\r\n        self.verificationEmailSentMessage = false;\r\n\r\n        function toggleNotifications() {\r\n            $window.localStorage.setItem('pwAllowPushNotifications', self.notificationsActive);\r\n\r\n            if (!!self.notificationsActive) {\r\n                // subscribe device push notifications\r\n                if ($window.pwCanUseServiceWorkers() || angular.isDefined(window.safari)) {\r\n                    if ($window.chrome && $window.pushwoosh.isBrowserChrome()) {\r\n                        $window.pushwoosh.subscribeAtStart();\r\n                    } else {\r\n                        $window.pushwooshSubscribe();\r\n\r\n                        $window.pushwooshSetTags({\r\n                            id: self.user.id,\r\n                            urlId: self.user.url_id,\r\n                            username: self.user.email,\r\n                            firstName: self.user.firstName,\r\n                            lastName: self.user.lastName\r\n                        });\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n        function updateUser() {\r\n            if (!self.updating) {\r\n                var user = self.user;\r\n                self.updating = true;\r\n                user.genres = _.pluck(self.genresArr, 'id');\r\n                user.types = _.pluck(self.typesArr, 'id');\r\n                user.settings = JSON.stringify(user.settings);\r\n                AuthService.updateUser(user).then(function (res) {\r\n                    // console.log(res);\r\n                    res.data.data.dob = moment(res.data.data.dob).toDate();\r\n                    res.data.data.settings = JSON.parse(res.data.data.settings);\r\n                    AuthService.currentUser = self.user = res.data.data;\r\n                    res.data.data.name = res.data.data.fullName;\r\n                    $intercom.update(res.data.data);\r\n                    self.saveComplete = true;\r\n                    self.updating = false;\r\n                    anchorSmoothScroll.scrollTo('success');\r\n                    $rootScope.toastMessage('Profile Updated');\r\n                });\r\n            } else {\r\n                $rootScope.toastMessage('Please wait...');\r\n            }\r\n        }\r\n\r\n        function requestVerificationEmail() {\r\n            AuthService.requestVerification().then(function () {\r\n                self.verificationEmailSentMessage = true;\r\n            });\r\n        }\r\n\r\n        $rootScope.generateCountries().then(function (res) {\r\n            self.countries = res;\r\n        });\r\n\r\n        $rootScope.generateGenres().then(function (res) {\r\n            self.genresList = res;\r\n        });\r\n\r\n        $rootScope.generateTypes().then(function (res) {\r\n            self.typesList = res;\r\n        });\r\n\r\n        self.syncGenres = function (bool, item) {\r\n            if (bool) {\r\n                // add item\r\n                self.genresArr.push(item);\r\n            } else {\r\n                // remove item\r\n                for (var i = 0; i < self.genresArr.length; i++) {\r\n                    if (self.genresArr[i].id == item.id) {\r\n                        DataService.delete('Genres', self.genresArr[i].id);\r\n                        self.genresArr.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.isCheckedGenre = function (id) {\r\n            var match = false;\r\n            for (var i = 0; i < self.genresArr.length; i++) {\r\n                if (self.genresArr[i].id == id) {\r\n                    match = true;\r\n                }\r\n            }\r\n            return match;\r\n        };\r\n\r\n        self.syncTypes = function (bool, item) {\r\n            if (bool) {\r\n                // add item\r\n                self.typesArr.push(item);\r\n            } else {\r\n                // remove item\r\n                for (var i = 0; i < self.typesArr.length; i++) {\r\n                    if (self.typesArr[i].id == item.id) {\r\n                        DataService.delete('UserTypes', self.typesArr[i].id);\r\n                        self.typesArr.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.isCheckedType = function (id) {\r\n            var match = false;\r\n            for (var i = 0; i < self.typesArr.length; i++) {\r\n                if (self.typesArr[i].id == id) {\r\n                    match = true;\r\n                }\r\n            }\r\n            return match;\r\n        };\r\n        function confirmTerminate(ev) {\r\n            var confirm = $mdDialog.confirm()\r\n                .title('Terminate Account')\r\n                .textContent('Are you sure you want to terminate your account?')\r\n                .ariaLabel('Terminate Account')\r\n                .targetEvent(ev)\r\n                .ok('Yes')\r\n                .cancel('No');\r\n\r\n            $mdDialog.show(confirm).then(function() {\r\n                AuthService.deleteUser(self.user).then(function (res) {\r\n                    AuthService.logout();\r\n                });\r\n            }, function() {\r\n\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    UserCtrl.$inject = ['$rootScope', 'DataService', 'User', 'UserStats', '$state', 'UserActions', '$modal', '_'];\r\n    function UserCtrl($rootScope, DataService, User, UserStats, $state, UserActions, $modal, _) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.userStats = UserStats;\r\n        $rootScope.metadata.title = 'Profile: ' + self.user.firstName + ' ' + self.user.lastName;\r\n\r\n        self.showMessageDialog = function () {\r\n            ContactUserDialogController.$inject = ['$rootScope', '$scope', '$modalInstance', 'UserActions', 'DataService', 'recipient', '$timeout'];\r\n            function ContactUserDialogController($rootScope, $scope, $modalInstance, UserActions, DataService, recipient, $timeout) {\r\n\r\n\r\n                $scope.recipient = recipient;\r\n                $scope.model = {\r\n                    mySubject: $rootScope.AppData.User.fullName + ', ' + $scope.recipient.fullName,\r\n                    myMessage: null\r\n                };\r\n\r\n                $scope.postMessage = function () {\r\n                    UserActions.checkAuth().then(function (res) {\r\n                        if (res) {\r\n                            // create new conversation\r\n                            DataService.save('messages', {\r\n                                subject: $scope.model.mySubject,\r\n                                message: $scope.model.myMessage,\r\n                                recipients: new Array($scope.recipient.id)\r\n                            }).then(function (convo) {\r\n                                $scope.model.myMessage = null;\r\n                                $rootScope.toastMessage('Message sent!');\r\n                                // register Action\r\n                                //result.participants = $scope.recipient;\r\n                                $scope.closeDialog();\r\n\r\n                                // Creates Duplicate entry Error\r\n                                /*DataService.update('Conversation', convo.data.id, {\r\n                                 id: convo.data.id,\r\n                                 participants: [\r\n                                 {user: $rootScope.AppData.User.id},\r\n                                 {user: $scope.recipient.id}\r\n                                 ],\r\n                                 messages: [\r\n                                 {body: $scope.model.myMessage, from: $rootScope.AppData.User.id}\r\n                                 ]\r\n                                 }, true, true).then(function (convo) {\r\n\r\n                                 });*/\r\n                            });\r\n                        }\r\n                    }, function (err) {\r\n                        $rootScope.toastMessage('Message failed. Please log in!');\r\n                        //UserActions.loginModal();\r\n                    });\r\n                };\r\n\r\n                $scope.closeDialog = function () {\r\n                    $modalInstance.close(true);\r\n                };\r\n\r\n                $scope.cancel = function () {\r\n                    $modalInstance.dismiss('cancel');\r\n                };\r\n\r\n            }\r\n\r\n            UserActions.checkAuth().then(function (res) {\r\n                if (res) {\r\n                    $modal.open({\r\n                        templateUrl: 'common/contactUserDialog.html',\r\n                        resolve: {\r\n                            recipient: function () {\r\n                                return self.user;\r\n                            }\r\n                        },\r\n                        controller: ContactUserDialogController\r\n                    });\r\n                }\r\n            }, function (err) {\r\n                UserActions.loginModal();\r\n            });\r\n        };\r\n    }\r\n\r\n    UserAboutController.$inject = ['$rootScope', 'DataService', 'User', '$state', 'UserActions'];\r\n    function UserAboutController($rootScope, DataService, User, $state, UserActions) {\r\n        var self = this;\r\n        self.user = User;\r\n        // console.log(self.user);\r\n    }\r\n\r\n    UserVideosController.$inject = ['$rootScope', 'DataService', 'User', 'Videos', '$modal', 'UserActions', '_'];\r\n    function UserVideosController($rootScope, DataService, User, Videos, $modal, UserActions, _) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.projects = Videos.data;\r\n\r\n        self.deleteProject = function (videoId) {\r\n            UserActions.checkAuth().then(function (res) {\r\n                if (res) {\r\n                    var modalInstance = $modal.open({\r\n                        templateUrl: 'common/confirmDialog.html',\r\n                        controller: ['$scope', '$modalInstance', function ($scope, $modalInstance) {\r\n                            $scope.ok = function () {\r\n                                $modalInstance.close(true);\r\n                            };\r\n\r\n                            $scope.cancel = function () {\r\n                                $modalInstance.dismiss('cancel');\r\n                            };\r\n                        }],\r\n                        size: Foundation.MediaQuery.atLeast('large') ? 'tiny' : 'small',\r\n                        keyboard: true\r\n                    });\r\n                    modalInstance.result.then(function () {\r\n                        DataService.delete('projects', videoId).then(function () {\r\n                            self.projects.data = _.reject(self.projects.data, function (a) {\r\n\r\n                                return a.id === videoId;\r\n                            });\r\n                        });\r\n                    }, function () {\r\n                        // console.info('Modal dismissed at: ' + new Date());\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    UserCritiquesController.$inject = ['$rootScope', 'User', 'Critiques', 'Critiqued'];\r\n    function UserCritiquesController($rootScope, User, Critiques, Critiqued) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.critiques = Critiques.data.data;\r\n        self.critiqued = Critiqued.data.data;\r\n    }\r\n\r\n    UserReactionsController.$inject = ['$rootScope', 'User', 'Reactions', 'Reacted', '_'];\r\n    function UserReactionsController($rootScope, User, Reactions, Reacted, _) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.reactions = Reactions.data.data;\r\n        self.reacted = Reacted.data.data;\r\n\r\n        self.getEmoticonByEmotion = function (emotion) {\r\n            var reactions = $rootScope.generateReactions();\r\n            return _.findWhere(reactions, {emotion: emotion});\r\n        };\r\n\r\n    }\r\n\r\n    UserAwardsController.$inject = ['$rootScope', 'DataService', 'User', 'Awards', 'Nominations', 'Nominated'];\r\n    function UserAwardsController($rootScope, DataService, User, Awards, Nominations, Nominated) {\r\n        var self = this;\r\n        self.user = User;\r\n        self.awards = Awards.data.data;\r\n        self.nominations = Nominations.data.data;\r\n        self.nominated = Nominated.data.data;\r\n    }\r\n\r\n    MessagesCtrl.$inject = ['$rootScope', '$scope', 'Conversations', 'DataService', '$window', '$modal', 'UserActions', '$timeout', '$q', '_'];\r\n    function MessagesCtrl($rootScope, $scope, Conversations, DataService, $window, $modal, UserActions, $filter, $q, _) {\r\n        $rootScope.metadata.title = 'Messages';\r\n        var self = this;\r\n        self.selectedConvo = null;\r\n        self.newConvo = null;\r\n        self.conversations = Conversations.data.conversations;\r\n        self.newMode = false;\r\n        self.newConversation = newConversation;\r\n        self.fetchConvos = fetchConvos;\r\n        self.querySearch = querySearch;\r\n        self.leaveConvo = leaveConvo;\r\n        self.doSendOnEnter = doSendOnEnter;\r\n        self.postReply = postReply;\r\n        self.selectConvo = selectConvo;\r\n        self.getParticipantById = getParticipantById;\r\n        self.myReply = null;\r\n        self.sendOnEnter = $window.localStorage.sendOnEnter ? JSON.parse($window.localStorage.sendOnEnter) : true;\r\n        self.inboxConvos = {};\r\n        self.convoMessages = {};\r\n        self.selectedConvoLoaded = false;\r\n        self.viewportHeight = { height: 500 + 'px' };\r\n\r\n        function selectConvo(convo) {\r\n            self.newMode = false;\r\n            self.selectedConvoLoaded = false;\r\n            self.selectedConvo = convo;\r\n            self.currentParticipants = convo.participants;\r\n            DataService.item('messages', convo.id).then(function (msgs) {\r\n                // console.log('Messages: ', msgs.data);\r\n                self.messages = msgs.data.conversation.messages;\r\n\r\n                self.convoMessages = {\r\n                    first: 1,\r\n                    data: [],\r\n                    meta: {\r\n                        pagination: {\r\n                            current_page: 1\r\n                        }\r\n                    },\r\n                    get: function (index, count, success) {\r\n                        console.log('index = ' + index + '; count = ' + count);\r\n                        var start = index;\r\n                        var end = Math.min(index + count - 1, this.first);\r\n                        if (this.meta.pagination.total_pages >= this.meta.pagination.current_page) {\r\n                            this.meta.pagination.current_page++;\r\n                        }\r\n                        DataService.collection('messages/' + self.selectedConvo.id + '/messages', {per_page: count, page: this.meta.pagination.current_page})\r\n                            .then(function(response) {\r\n                                self.convoMessages.data = _.union(self.convoMessages.data, response.data.data);\r\n                                angular.extend(self.convoMessages.meta, response.data.meta);\r\n                            })\r\n                            .then(function() {\r\n                                console.log(self.convoMessages);\r\n                                // reverse logic\r\n                                var result = [];\r\n                                if (start <= end) {\r\n                                    for (var i = start; i <= end; i++) {\r\n                                        var serverDataIndex = /*(self.convoMessages.meta.pagination.current_page > 1) ? 0 :*/ (-1) * i + self.convoMessages.first;\r\n                                        var item = self.convoMessages.data[serverDataIndex];\r\n                                        if (item) {\r\n                                            result.push(item);\r\n                                        }\r\n                                    }\r\n                                }\r\n\r\n                                success(result);\r\n                            });\r\n                    }\r\n                };\r\n                self.selectedConvoLoaded = true;\r\n            });\r\n        }\r\n\r\n        function doSendOnEnter() {\r\n            if (self.sendOnEnter && self.myReply) {\r\n                self.newMode ? self.postNewMsg() : self.postReply();\r\n            }\r\n        }\r\n\r\n        function postReply() {\r\n            if (self.myReply) {\r\n                if (self.newMode) {\r\n                    return self.postNewMsg();\r\n                }\r\n\r\n                UserActions.checkAuth().then(function (res) {\r\n                    if (res) {\r\n                        var reply = self.myReply;\r\n                        self.myReply = null;\r\n                        DataService.update('messages', self.selectedConvo.id, {message: reply})\r\n                            .then(function (result) {\r\n                                // self.adapter.append([result.data.message]);\r\n                                self.convoMessages.data.push(result.data.message);\r\n                                $scope.adapter.append([result.data.message]);\r\n                                // update convos\r\n                                self.messages.push(result.data.message);\r\n                                self.fetchConvos();\r\n\r\n                            }, function (response) {\r\n                                self.reply = reply;\r\n                            })\r\n                            .then(function () {\r\n                                // scroll to bottom of viewport\r\n                                var viewport = angular.element('.viewport.main-comment');\r\n                                viewport.scrollTop(viewport.prop(\"scrollHeight\"));\r\n                            });\r\n                    }\r\n                }, function (err) {\r\n                    UserActions.loginModal();\r\n                });\r\n            }\r\n        }\r\n\r\n        function newConversation() {\r\n            self.newMode = true;\r\n            self.selectedConvo = {\r\n                participants: [],\r\n                body: ''\r\n            };\r\n\r\n            self.postNewMsg = postNewMsg;\r\n\r\n            function postNewMsg() {\r\n                DataService.save('messages', {\r\n                    subject: _.pluck(self.selectedConvo.participants, 'fullName').toString() + ', ' + $rootScope.AppData.User.fullName,\r\n                    message: self.myReply,\r\n                    recipients: _.pluck(self.selectedConvo.participants, 'id')\r\n                }).then(function (response) {\r\n                    self.myReply = null;\r\n                    $rootScope.toastMessage('Message sent!');\r\n                    fetchConvos().then(function (conversations) {\r\n                        selectConvo(_.findWhere(conversations, {id: response.data.id}));\r\n                    });\r\n                });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Search for contacts.\r\n         */\r\n        function querySearch(query) {\r\n            return DataService.collection('users', { search: query, notUsers: $rootScope.AppData.User.id }).then(function (response) {\r\n                return response.data.data;\r\n            });\r\n        }\r\n\r\n        function fetchConvos() {\r\n            return DataService.collection('messages').then(function (result) {\r\n                return self.conversations = result.data.conversations;\r\n            });\r\n        }\r\n\r\n        function leaveConvo() {\r\n            // TODO replacve confirm dialog\r\n            var confirm = $modal.confirm()\r\n                .title('Leave Conversation?')\r\n                //.textContent('Are you sure you want to delete this conversation?')\r\n                //.ariaLabel('Lucky day')\r\n                //.targetEvent(ev)\r\n                .ok('Yes')\r\n                .cancel('No');\r\n            $modal.show(confirm).then(function () {\r\n                var me = $rootScope.AppData.User.id;\r\n                var message = new Parse.Object('Message');\r\n                message.set('body', me.first_name + ' ' + me.last_name + ' left the conversation...');\r\n                message.set('parent', {\r\n                    __type: 'Pointer',\r\n                    className: 'Conversation',\r\n                    objectId: self.selectedConvo.id\r\n                });\r\n                message.set('from', $rootScope.AppData.User.id);\r\n                message.save().then(function (result) {\r\n                    var relParticipants = self.selectedConvo.relation('participants');\r\n                    relParticipants.remove(me);\r\n\r\n                    self.selectedConvo.set('updatedAt', moment().toDate());\r\n                    self.selectedConvo.save().then(function () {\r\n                        self.myReply = null;\r\n                        self.messages = [];\r\n                        self.newMode = false;\r\n                        self.selectedConvo = null;\r\n                        self.currentParticipants = null;\r\n\r\n                        // Refresh List\r\n                        fetchConvos()\r\n                    });\r\n                });\r\n            }, function () {\r\n            });\r\n        }\r\n\r\n        function getParticipantById(convo, userId) {\r\n            return _.findWhere(convo.participants, {user_id: userId});\r\n        }\r\n    }\r\n\r\n    NotificationsCtrl.$inject = ['$rootScope', 'UserActions', '_'];\r\n    function NotificationsCtrl($rootScope, UserActions, _) {\r\n        var self = this;\r\n        self.refresh = function () {\r\n            //$rootScope.getFlatNotificationsFeed();\r\n        };\r\n\r\n        self.markAllAsRead = function () {\r\n            /*$rootScope.getNewToken('flat', $rootScope.AppData.User.id).then(function (token) {\r\n             var feed = window.StreamClient.feed('flat_notifications', $rootScope.AppData.User.id, token);\r\n             feed.get({limit: 20, mark_read: true}, function (a) {\r\n             _.each($rootScope.AppData.NotificationsFeed.list, function (n) {\r\n             n.is_read = true;\r\n             });\r\n             $rootScope.AppData.NotificationsFeed.unread = 0;\r\n             })\r\n             });*/\r\n        };\r\n\r\n        self.markAsRead = function (n) {\r\n            /*$rootScope.getNewToken('flat', $rootScope.AppData.User.id).then(function (token) {\r\n             var feed = window.StreamClient.feed('flat_notifications', $rootScope.AppData.User.id, token);\r\n             feed.get({limit: 5, mark_read: [n.id]}, function (a) {\r\n             n.is_read = true;\r\n             --$rootScope.AppData.NotificationsFeed.unseen;\r\n             --$rootScope.AppData.NotificationsFeed.unread;\r\n             return n;\r\n             })\r\n             });*/\r\n        };\r\n\r\n        self.refresh();\r\n    }\r\n\r\n    ContactPageCtrl.$inject = ['$rootScope', 'DataService', '$sce', '_'];\r\n    function ContactPageCtrl($rootScope, DataService, $sce, _) {\r\n        var self = this;\r\n        self.emails = [\r\n            {\r\n                title: 'Technical Support',\r\n                address: 'support@getindiewise.com',\r\n                description: 'For all your Tech Support Needs and Issues.'\r\n            },\r\n            {\r\n                title: 'SafeGuard',\r\n                address: 'safeguard@getindiewise.com',\r\n                description: 'IndieWise cares about the safety and well-being of its users. Contact us immediately, if you come across any inappropriate content on the site. This includes, but is not limited to: content that is Excessively Violent, Pornographic, Racially Offensive, Unlawful, of a Bullying Nature, Directly Harmful to any Individual, Copyright Infringement, Spam, etc.'\r\n            },\r\n            {\r\n                title: 'Marketing',\r\n                address: 'marketing@getindiewise.com',\r\n                description: 'Would you like to advertise your company to our vast and diverse audience? Would you like a featured listing of your film at the top of our Homepage for all to see? Reach out today!'\r\n            },\r\n            {\r\n                title: 'Awards',\r\n                address: 'awards@getindiewise.com',\r\n                description: 'So you have such an amazing project, that 5 or more Users felt like you deserve an Award for it! Congrats! We can help!'\r\n            },\r\n            {\r\n                title: 'Public Relations',\r\n                address: 'pr@getindiewise.com',\r\n                description: 'Reach out for any press and/or media inquiries. Also let us know if youd like to be featured in our bi-weekly newsletter. Also stay tuned for important announcements and updates!'\r\n            },\r\n            {\r\n                title: 'Career Center',\r\n                address: 'careers@getindiewise.com',\r\n                description: 'Interested in joining Team IndieWise? Let us know! There are several internship opportunities available.'\r\n            },\r\n            {\r\n                title: 'Become a Sponsor',\r\n                address: 'sponsor@getindiewise.com',\r\n                description: 'Weve reserved a unique spot on our homepage to showcase our amazing sponsors. If youre interested in becoming a sponsor of IndieWise, let us know!'\r\n            },\r\n            {\r\n                title: 'Invest in IndieWise',\r\n                address: 'investors@getindiewise.com',\r\n                description: 'So youd like to take the bold step of investing in IndieWise! Great choice. Lets talk!'\r\n            },\r\n            {\r\n                title: 'Register for IndieWise Convention (JULY 28-30, 2017)',\r\n                address: 'convention@getindiewise.com',\r\n                description: 'Register for our Annual Convention, in Miami, FL! Registration opens on JAN 2, 2017. Over 10,000 Filmmakers from 140+ Countries will be in attendance, as we provide you with 3 days of interactive workshops, educational seminars, film screenings, VIP Receptions, a Yacht Party, and a Closing Gala.<br>Regular 3- Day Package: $150  |  VIP 3-Day Package (Including Yacht Party): $250 (450 Tickets max. To Be Sold)'\r\n            },\r\n            {\r\n                title: 'Feedback Center',\r\n                address: 'feedback@getindiewise.com',\r\n                description: 'We welcome any feedback you have, to help us to provide you with the very best experience! Tell us!'\r\n            },\r\n        ];\r\n        self.selectedEmail = _.contains(_.pluck(self.emails, 'address'), $rootScope.$stateParams.email) ? _.findWhere(self.emails, { address: $rootScope.$stateParams.email}) : null;\r\n        self.description = '';\r\n        self.getDescription = function () {\r\n            self.description = angular.isObject(self.selectedEmail) ? $sce.trustAsHtml(self.selectedEmail.description) : $sce.trustAsHtml('');\r\n        };\r\n        self.getDescription();\r\n\r\n        self.form = {\r\n            to: '',\r\n            name: '',\r\n            email: '',\r\n            subject: '',\r\n            message: ''\r\n        };\r\n\r\n        self.submitForm = function () {\r\n            self.form.to = self.selectedEmail.address;\r\n            DataService.mail('contact', self.form).then(function (res) {\r\n                $rootScope.toastMessage('Message Sent, Thank you!');\r\n                self.form = {\r\n                    to: '',\r\n                    name: '',\r\n                    email: '',\r\n                    subject: '',\r\n                    message: ''\r\n                };\r\n            });\r\n        }\r\n    }\r\n})\r\n();","(function () {\r\n    'use strict';\r\n\r\n    angular.module('IndieWise.winners', [])\r\n        .controller('WinnersCtrl', WinnersController);\r\n\r\n    WinnersController.$inject = ['$rootScope', '$scope', 'DataService'];\r\n    function WinnersController($rootScope, $scope, DataService) {\r\n        var self = this;\r\n        self.awards = [];\r\n        self.date = '';\r\n        DataService.collection('winners').then(function (response) {\r\n            self.awards = response.data.Awards;\r\n        });\r\n\r\n    }\r\n})();\r\n","/**\r\n * Created by Jerez Bain on 9/14/2015.\r\n */\r\n(function () {\r\n    'use strict';\r\n    angular.module('IndieWise.directives', [])\r\n        .directive('layerSlider', ['$rootScope', '$timeout', 'DataService', '$q', function ($rootScope, $timeout, DataService, $q) {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                templateUrl: 'directives/layerSlider.html',\r\n                scope: {},\r\n                link: function (scope, el, attrs) {\r\n                    scope.BASE = BASE || '/';\r\n                    var a = DataService.collection('users/count').then(function (res) {\r\n                        scope.users = res.data;\r\n                    });\r\n\r\n                    /*var b = DataService.collection('projects/count').then(function (res) {\r\n                        scope.projects = res.data;\r\n                    });*/\r\n\r\n                    var b = DataService.collection('projects', {per_page: 3}).then(function (res) {\r\n                        scope.projects = res.data;\r\n                    });\r\n\r\n                    $q.all([a, b]).then(function () {\r\n                        $timeout(function () {\r\n                            // jQuery('#slippry').slippry();\r\n                            jQuery(\"#layerslider\").layerSlider({\r\n                                responsive: true,\r\n                                // responsiveUnder: 950,\r\n                                layersContainer: 950,\r\n                                skin: 'noskin',\r\n                                hoverPrevNext: false,\r\n                                skinsPath: BASE + 'assets/layerslider/skins/'\r\n                            });\r\n                        }, 0)\r\n\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('premiumCarousel', ['$rootScope', '$state', '$timeout', 'DataService', function ($rootScope, $state, $timeout, DataService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                //transclude: true,\r\n                templateUrl: 'directives/featured-area.html',\r\n                scope: {},\r\n                link: function (scope, el, attrs) {\r\n                    DataService.collection(\"projects\", { random: true }).then(function (result) {\r\n                        scope.featuredFilms = result.data;\r\n                        // console.log(\"featuredFilms: \", scope.featuredFilms);\r\n                    }).then(function () {\r\n                        $timeout(function () {\r\n                            // console.log('run owl');\r\n                            //Premium carousel\r\n                            var carouselEl = jQuery('#owl-featured');\r\n                            carouselEl.each(function () {\r\n                                var owl = jQuery(this);\r\n                                jQuery(\".prev\").on('click', function () {\r\n                                    carouselEl.trigger('prev.owl.carousel');\r\n                                });\r\n\r\n                                jQuery(\".next\").on('click', function () {\r\n                                    carouselEl.trigger('next.owl.carousel');\r\n                                });\r\n                                var loopLength = owl.data('car-length');\r\n                                var divLength = jQuery(this).find(\"div.item\").length;\r\n                                if (divLength > loopLength) {\r\n                                    owl.owlCarousel({\r\n                                        dots: owl.data(\"dots\"),\r\n                                        items: owl.data(\"items\"),\r\n                                        slideBy: owl.data(\"slideby\"),\r\n                                        center: owl.data(\"center\"),\r\n                                        loop: owl.data(\"loop\"),\r\n                                        margin: owl.data(\"margin\"),\r\n                                        nav: owl.data(\"nav\"),\r\n                                        autoplay: owl.data(\"autoplay\"),\r\n                                        autoplayTimeout: owl.data(\"autoplay-timeout\"),\r\n                                        autoWidth: owl.data(\"auto-width\"),\r\n                                        autoHeight: owl.data(\"auto-Height\"),\r\n                                        merge: owl.data(\"merge\"),\r\n                                        responsive: {\r\n                                            0: {\r\n                                                items: owl.data(\"responsive-small\"),\r\n                                                nav: false\r\n                                            },\r\n                                            600: {\r\n                                                items: owl.data(\"responsive-medium\"),\r\n                                                nav: false\r\n                                            },\r\n                                            1000: {\r\n                                                items: owl.data(\"responsive-large\"),\r\n                                                nav: false\r\n                                            },\r\n                                            1900: {\r\n                                                items: owl.data(\"responsive-xlarge\"),\r\n                                                nav: false\r\n                                            }\r\n                                        }\r\n                                    });\r\n\r\n                                } else {\r\n                                    owl.owlCarousel({\r\n                                        dots: false,\r\n                                        items: owl.data(\"items\"),\r\n                                        loop: false,\r\n                                        margin: owl.data(\"margin\"),\r\n                                        autoplay: false,\r\n                                        autoplayHoverPause: true,\r\n                                        responsiveClass: true,\r\n                                        autoWidth: owl.data(\"auto-width\"),\r\n                                        autoHeight: owl.data(\"auto-Height\"),\r\n                                    });\r\n                                }\r\n                            });\r\n                        }, 300);\r\n                    });\r\n\r\n                    scope.isMobile = $rootScope.isMobile;\r\n\r\n                }\r\n            }\r\n        }])\r\n        .directive('watchingCarousel', ['$rootScope', '$timeout', '$interval', 'DataService', function ($rootScope, $timeout, $interval, DataService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'directives/people-watching.html',\r\n                scope: {},\r\n                link: function (scope, el, attrs) {\r\n                    scope.getWatchedList = function () {\r\n                        DataService.collection('projects/watched').then(function (result) {\r\n                            scope.watched = result.data;\r\n                            // console.log('watched');\r\n                            // console.log(scope.watched);\r\n                            $timeout(function () {\r\n                                //console.log('run owl');\r\n                                //Premium carousel\r\n                                jQuery('.owl-carousel').each(function () {\r\n                                    var owl = jQuery(this);\r\n                                    jQuery(\".prev\").on('click', function () {\r\n                                        jQuery(this).parent().parent().parent().parent().next().trigger('prev.owl.carousel');\r\n                                    });\r\n\r\n                                    jQuery(\".next\").on('click', function () {\r\n                                        jQuery(this).parent().parent().parent().parent().next().trigger('next.owl.carousel');\r\n                                    });\r\n                                    var loopLength = owl.data('car-length');\r\n                                    var divLength = jQuery(this).find(\"div.item\").length;\r\n                                    if (divLength > loopLength) {\r\n                                        owl.owlCarousel({\r\n                                            dots: owl.data(\"dots\"),\r\n                                            items: owl.data(\"items\"),\r\n                                            slideBy: owl.data(\"slideby\"),\r\n                                            center: owl.data(\"center\"),\r\n                                            loop: owl.data(\"loop\"),\r\n                                            margin: owl.data(\"margin\"),\r\n                                            nav: owl.data(\"nav\"),\r\n                                            autoplay: owl.data(\"autoplay\"),\r\n                                            autoplayTimeout: owl.data(\"autoplay-timeout\"),\r\n                                            autoWidth: owl.data(\"auto-width\"),\r\n                                            autoHeight: owl.data(\"auto-Height\"),\r\n                                            merge: owl.data(\"merge\"),\r\n                                            responsive: {\r\n                                                0: {\r\n                                                    items: owl.data(\"responsive-small\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                600: {\r\n                                                    items: owl.data(\"responsive-medium\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                1000: {\r\n                                                    items: owl.data(\"responsive-large\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                1900: {\r\n                                                    items: owl.data(\"responsive-xlarge\"),\r\n                                                    nav: false\r\n                                                }\r\n                                            }\r\n                                        });\r\n\r\n                                    } else {\r\n                                        owl.owlCarousel({\r\n                                            dots: false,\r\n                                            items: owl.data(\"items\"),\r\n                                            loop: false,\r\n                                            margin: owl.data(\"margin\"),\r\n                                            autoplay: false,\r\n                                            autoplayHoverPause: true,\r\n                                            responsiveClass: true,\r\n                                            autoWidth: owl.data(\"auto-width\"),\r\n                                            autoHeight: owl.data(\"auto-Height\"),\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }, 0);\r\n                        });\r\n                    };\r\n                    /*$interval(function () {\r\n                     scope.getWatchedList()\r\n                     }, 60000);*/\r\n\r\n                    scope.getWatchedList();\r\n                }\r\n            }\r\n        }])\r\n        .directive('owlCarousel', ['$rootScope', '$timeout', '$interval', 'DataService', function ($rootScope, $timeout, $interval, DataService) {\r\n            return {\r\n                restrict: 'A',\r\n                //scope: {},\r\n                link: function (scope, el, attrs) {\r\n                    scope.getWatchedList = function () {\r\n                        $timeout(function () {\r\n                                //console.log('run owl');\r\n                                //Premium carousel\r\n                                el.each(function () {\r\n                                    var owl = jQuery(this);\r\n                                    jQuery(\".prev\").on('click', function () {\r\n                                        jQuery(this).parent().parent().parent().parent().next().trigger('prev.owl.carousel');\r\n                                    });\r\n\r\n                                    jQuery(\".next\").on('click', function () {\r\n                                        jQuery(this).parent().parent().parent().parent().next().trigger('next.owl.carousel');\r\n                                    });\r\n                                    var loopLength = owl.data('car-length');\r\n                                    var divLength = jQuery(this).find(\"div.item\").length;\r\n                                    if (divLength > loopLength) {\r\n                                        owl.owlCarousel({\r\n                                            dots: owl.data(\"dots\"),\r\n                                            items: owl.data(\"items\"),\r\n                                            slideBy: owl.data(\"slideby\"),\r\n                                            center: owl.data(\"center\"),\r\n                                            loop: owl.data(\"loop\"),\r\n                                            margin: owl.data(\"margin\"),\r\n                                            nav: owl.data(\"nav\"),\r\n                                            autoplay: owl.data(\"autoplay\"),\r\n                                            autoplayTimeout: owl.data(\"autoplay-timeout\"),\r\n                                            autoWidth: owl.data(\"auto-width\"),\r\n                                            autoHeight: owl.data(\"auto-Height\"),\r\n                                            merge: owl.data(\"merge\"),\r\n                                            responsive: {\r\n                                                0: {\r\n                                                    items: owl.data(\"responsive-small\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                600: {\r\n                                                    items: owl.data(\"responsive-medium\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                1000: {\r\n                                                    items: owl.data(\"responsive-large\"),\r\n                                                    nav: false\r\n                                                },\r\n                                                1900: {\r\n                                                    items: owl.data(\"responsive-xlarge\"),\r\n                                                    nav: false\r\n                                                }\r\n                                            }\r\n                                        });\r\n\r\n                                    } else {\r\n                                        owl.owlCarousel({\r\n                                            dots: false,\r\n                                            items: owl.data(\"items\"),\r\n                                            loop: false,\r\n                                            margin: owl.data(\"margin\"),\r\n                                            autoplay: false,\r\n                                            autoplayHoverPause: true,\r\n                                            responsiveClass: true,\r\n                                            autoWidth: owl.data(\"auto-width\"),\r\n                                            autoHeight: owl.data(\"auto-Height\"),\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }, 0);\r\n                    };\r\n                    /*$interval(function () {\r\n                     scope.getWatchedList()\r\n                     }, 60000);*/\r\n\r\n                    scope.getWatchedList();\r\n                }\r\n            }\r\n        }])\r\n        .directive('playlists', ['$rootScope', 'DataService', 'UserActions', '_', function ($rootScope, DataService, UserActions, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/playlists.html',\r\n                replace: false,\r\n                scope: {\r\n                    project: '='\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    scope.model = {\r\n                        newName: null,\r\n                        playlistArr: [],\r\n                    };\r\n                    scope.playlists = [];\r\n                    scope.newPlInput = false;\r\n\r\n                    // Get playlists\r\n                    if ($rootScope.AppData.User) {\r\n                        DataService.collection('playlists')\r\n                            .then(function (res) {\r\n                                // Check playlist items for this video\r\n                                DataService.collection('playlistItems', {project: scope.project.id, playlists: _.pluck(res.data.playlists, 'id').toString()})\r\n                                    .then(function (resA) {\r\n                                        // console.log(resA);\r\n                                        scope.model.playlistArr = resA.data.data;\r\n\r\n                                        // list playlists\r\n                                        scope.playlists = res.data.playlists;\r\n                                        // console.log(scope.playlists);\r\n                                    });\r\n                            });\r\n                    }\r\n\r\n\r\n                    scope.toggleNewPlInput = function (clear) {\r\n                        scope.newPlInput = !scope.newPlInput;\r\n                        if (clear) {\r\n                            scope.model.newName = null;\r\n                        }\r\n                    };\r\n\r\n                    scope.newPlaylist = function () {\r\n                        UserActions.checkAuth().then(function (res) {\r\n                            DataService.save('playlists', {\r\n                                name: scope.model.newName,\r\n                                user_id: $rootScope.AppData.User.id\r\n                            }, false, true).then(function (pl) {\r\n                                scope.toggleNewPlInput(false);\r\n                                scope.model.newName = null;\r\n                                scope.playlists.push(pl.data.data)\r\n                            });\r\n                        }, function (err) {\r\n                            UserActions.loginModal().then(function (res) {\r\n                                debugger;\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    scope.syncPlaylists = function (bool, item) {\r\n                        if (bool) {\r\n                            // add item\r\n                            scope.model.playlistArr.push(item);\r\n                            DataService.save('playlistItems', {playlist: item.id, project: scope.project.id});\r\n                            $rootScope.toastMessage('Added to playlist');\r\n                            // console.log('Added to playlist: ', item);\r\n                        } else {\r\n                            // remove item\r\n\r\n                            for (var i = 0; i < scope.model.playlistArr.length; i++) {\r\n                                if (scope.model.playlistArr[i].id == item.id) {\r\n                                    var genreSetting = _.findWhere(scope.model.playlistArr, {\r\n                                        project: scope.project.id,\r\n                                        playlist_id: item.id\r\n                                    });\r\n                                    // console.log(genreSetting);\r\n                                    if (genreSetting) {\r\n                                        DataService.delete('PlaylistItem', genreSetting.id);\r\n                                    }\r\n                                    scope.model.playlistArr.splice(i, 1);\r\n                                    $rootScope.toastMessage('Removed from playlist');\r\n                                    // console.log('Removed from playlist: ', item);\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    scope.isCheckedPlaylist = function (id) {\r\n                        var match = false;\r\n                        for (var i = 0; i < scope.model.playlistArr.length; i++) {\r\n                            if (scope.model.playlistArr[i].playlist_id == id) {\r\n                                match = true;\r\n                            }\r\n                        }\r\n                        return match;\r\n                    };\r\n                }\r\n            }\r\n        }])\r\n        .directive('toggleShowMore', ['$rootScope', '$timeout', function ($rootScope, $timeout) {\r\n            return {\r\n                restrict: 'A',\r\n                scope: {\r\n                    showMoreHeight: '=showMoreHeight'\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    $timeout(function () {\r\n                        //show more and less\r\n                        el.showMore({\r\n                            speedDown: 300,\r\n                            speedUp: 300,\r\n                            height: scope.showMoreHeight ? scope.showMoreHeight + 'px' : '165px',\r\n                            showText: 'Show more',\r\n                            hideText: 'Show less'\r\n                        });\r\n                    }, 500);\r\n\r\n                }\r\n            }\r\n        }])\r\n        .directive('videoPlayer', ['$rootScope', 'DataService', 'UserActions', '$timeout', '$interval', '$state', 'anchorSmoothScroll', '_', function ($rootScope, DataService, UserActions, $timeout, $interval, $state, anchorSmoothScroll, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/video-player.html',\r\n                transclude: true,\r\n                // replace: true,\r\n                scope: {film: '=film', type: '=type', lightsOff: '=lightsOff'},\r\n                link: function (scope, el, attrs) {\r\n                    var sources = [];\r\n                    var tracks = [];\r\n                    var otherSources = [];\r\n                    scope.hideSidebar = false;\r\n                    scope.loaded = false;\r\n                    scope.setupOptions = {\r\n                        controls: true,\r\n                        preload: 'auto',\r\n                        autoplay: false,\r\n                        techOrder: ['youtube', 'vimeo', 'Html5'],\r\n                        plugins: {\r\n                            // airplayButton: {},\r\n                            /*chromecast: {\r\n                                appId: \"AppID of your Chromecast App\",\r\n                                metadata: {\r\n                                    title: 'IndieWise',\r\n                                    subtitle: scope.film.name\r\n                                }\r\n                            },*/\r\n                            videoJsResolutionSwitcher: {\r\n                                default: 'high',\r\n                                dynamicLabel: true\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    // Setup Source\r\n                    setupSource(scope.film, sources);\r\n\r\n                    // build media object\r\n                    scope.media = {\r\n                        sources: sources,\r\n                        tracks: tracks,\r\n                    };\r\n\r\n                    // Setup Playlist\r\n                    // Generate playlist\r\n                    DataService.collection('projects', {owner: scope.film.owner.id, notVideo: scope.film.id, per_page: 20})\r\n                        .then(function (response) {\r\n                            scope.otherSources = response.data.data;\r\n                            _.each(response.data.data, function (vid) {\r\n                                // setupSource(vid, otherSources);\r\n                                otherSources.push({\r\n                                    title: vid.name,\r\n                                    url: '/' + vid.url_id,\r\n                                    image: vid.thumbnail_url || 'https://getindiewise.com/assets/img/default_video_thumbnail.jpg', // could be an animated GIF\r\n                                    alt: vid.description, // optional photo description, defaults to the title\r\n                                    target: '_self' // can be any anchor target type\r\n                                })\r\n                            });\r\n\r\n                            console.log(scope.media);\r\n                        }).finally(function (res) {\r\n                            scope.loaded = true;\r\n                        });\r\n\r\n                    scope.$on('vjsVideoReady', function (e, data) {\r\n                        //data contains `id`, `vid`, `player` and `controlBar`\r\n                        //NOTE: vid is depricated, use player instead\r\n                        console.log('video id:' + data.id);\r\n                        console.log('video.js player instance: ', data.player);\r\n                        window.player = scope.player = data.player;\r\n                        console.log('video.js controlBar instance: ', data.controlBar);\r\n                        scope.controlBar = data.controlBar;\r\n\r\n                        // Add Playlist toggle button\r\n                        /*var Button = videojs.getComponent('Button');\r\n                        var MyButton = videojs.extend(Button, {\r\n                            constructor: function() {\r\n                                Button.apply(this, arguments);\r\n                                /!* initialize your button *!/\r\n                            },\r\n                            handleClick: function() {\r\n                                /!* do something on click *!/\r\n                            }\r\n                        });\r\n                        videojs.registerComponent('MyButton', MyButton);\r\n                        scope.player.getChild('controlBar').addChild('myButton', {});*/\r\n\r\n                        // Use playlist as suggested others\r\n                        scope.player.suggestedVideoEndcap({\r\n                            header: 'Other videos from ' + scope.film.owner.fullName + '...',\r\n                            suggestions: otherSources\r\n                        });\r\n                        // handle watched\r\n                        //if (scope.type !== 'vimeo') {\r\n                            var timeForPlayButton = scope.$watch('player.currentTime()', function (newValue, oldValue) {\r\n                                if (newValue > 5) {\r\n                                    $rootScope.initWatch();\r\n                                    timeForPlayButton();\r\n                                }\r\n                            });\r\n                        //}\r\n\r\n                        // Setup watcher\r\n                        scope.player.on('sourcechanged', function(e, data) {\r\n                            videojs.log('SOURCE CHANGED!', e, data);\r\n\r\n                            // Find which source it changed to\r\n                            /*if (angular.isDefined(data.from)) {\r\n                                var videoObj = _.findWhere(scope.otherSources, {id: _.findWhere(scope.media.sources, {src: data.to}).id});\r\n                                if (videoObj && videoObj.hasOwnProperty('id')) {\r\n                                    // Send video object to rest of page or reload\r\n                                    scope.$emit('VideoPlayer:sourceChanged', videoObj);\r\n                                }\r\n                            }*/\r\n                        });\r\n\r\n                        // Init behaviours\r\n                        // scope.player.perSourceBehaviors();\r\n\r\n                        // Init Sharing\r\n                        scope.player.socialShare({\r\n                            facebook: { // optional, includes a Facebook share button (See the [Facebook documentation](https://developers.facebook.com/docs/sharing/reference/share-dialog) for more information)\r\n                                // shareUrl: '', // optional, defaults to window.location.href\r\n                                shareImage: scope.film.thumbnail_url, // optional, defaults to the Facebook-scraped image\r\n                                shareText: 'I\\'m watching ' + scope.film.name + ' on IndieWise - Check it out!'\r\n                            },\r\n                            twitter: { // optional, includes a Twitter share button (See the [Twitter documentation](https://dev.twitter.com/web/tweet-button/web-intent) for more information)\r\n                                handle: 'indiewise', // optional, appends `via @handle` to the end of the tweet\r\n                                shareUrl: '', // optional, defaults to window.location.href\r\n                                shareText: 'I\\'m watching ' + scope.film.name + ' on IndieWise - Check it out!'\r\n                            }\r\n                        });\r\n\r\n                        // init Playlist\r\n                        // scope.player.playlist({ videos: sources, playlist: { hideSidebar: scope.hideSidebar, upNext: true, hideIcons: true, thumbnailSize: 300, items: 5 } })\r\n\r\n                        /*$timeout(function () {\r\n                            console.log('hiding sidebar');\r\n                            scope.hideSidebar = true;\r\n\r\n                            updateElementWidth(scope.player);\r\n                        }, 5000)*/\r\n                    });\r\n\r\n                    scope.$on('vjsVideoMediaChanged', function (e, data) {\r\n                        console.log('vjsVideoMediaChanged event was fired');\r\n                    });\r\n\r\n                    function setupSource(video, dest) {\r\n                        var source = {\r\n                            id: video.id,\r\n                            src: video.video_url,\r\n                            title: video.name,\r\n                            thumbnail: video.thumbnail_url || 'https://getindiewise.com/assets/img/default_video_thumbnail.jpg'\r\n                        };\r\n                        switch (video.hosting_type) {\r\n                            case 'HTML5':\r\n                                source.type = 'video/mp4';\r\n                                break;\r\n                            case 'youtube':\r\n                                source.type = 'video/youtube';\r\n                                source.src = 'https://www.youtube.com/watch?v=' + video.hosting_id;\r\n                                // source.youtube = { 'ytControls': 2, 'cc_load_policy': 1, 'iv_load_policy': 1, 'modestbranding': 1, 'cc': 1};\r\n                                break;\r\n                            case 'vimeo':\r\n                                source.type = 'video/vimeo';\r\n                                source.src = 'https://vimeo.com/' + video.hosting_id;\r\n                                // source.vimeo = { \"ytControls\": 2 };\r\n                                break;\r\n                        }\r\n                        dest.push(source);\r\n                    }\r\n\r\n                    function updateElementWidth(player) {\r\n                        var resize = function resize(p) {\r\n                            var itemWidth = scope.hideSidebar ? 0 : 300;\r\n\r\n                            var playerWidth = p.el().offsetWidth;\r\n                            var playerHeight = p.el().offsetHeight;\r\n                            var itemHeight = Math.round(playerHeight / 5);\r\n\r\n                            var youtube = p.$(\".vjs-tech\");\r\n                            var newSize = playerWidth - itemWidth;\r\n\r\n                            if (newSize >= 0) {\r\n\r\n                                var style = document.createElement('style');\r\n                                var def = ' ' + '.vjs-playlist .vjs-poster { width: ' + newSize + 'px !important; }' + '.vjs-playlist .vjs-playlist-items { width: ' + itemWidth + 'px !important; }' + '.vjs-playlist .vjs-playlist-items li { width: ' + itemWidth + 'px !important; height: ' + itemHeight + 'px !important; }' + '.vjs-playlist .vjs-modal-dialog { width: ' + newSize + 'px !important; } ' + '.vjs-playlist .vjs-control-bar, .vjs-playlist .vjs-tech { width: ' + newSize + 'px !important; } ' + '.vjs-playlist .vjs-big-play-button, .vjs-playlist .vjs-loading-spinner { left: ' + Math.round(newSize / 2) + 'px !important; } ';\r\n\r\n                                style.setAttribute('type', 'text/css');\r\n                                style.setAttribute('id', 'videoplayer-playlist-stylesheet');\r\n                                document.getElementsByTagName('head')[0].appendChild(style);\r\n\r\n                                if (style.styleSheet) {\r\n                                    style.styleSheet.cssText = def;\r\n                                } else {\r\n                                    style.appendChild(document.createTextNode(def));\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        if (player) {\r\n                            resize(player);\r\n                        }\r\n\r\n                        if (!scope.hideSidebar) {\r\n                            window.onresize = function () {\r\n                                resize(player);\r\n                            };\r\n\r\n                        }\r\n                    };\r\n\r\n                    function toggleLights() {\r\n                        scope.lightsOff = !scope.lightsOff;\r\n                        var overlay = jQuery('#overlay');\r\n                        var body = jQuery('body');\r\n                        overlay.fadeToggle(1000);\r\n                        /* Choose desired delay */\r\n                        if (!scope.lightsOff) {\r\n                            $timeout(function () {\r\n                                overlay.removeClass('highlight');\r\n                                body.removeClass('cinema-mode');\r\n                            }, 1000);\r\n                            /* Same delay */\r\n                        } else {\r\n                            overlay.addClass('highlight');\r\n                            body.addClass('cinema-mode');\r\n                        }\r\n                    }\r\n\r\n                    jQuery('#overlay').on('click', function () {\r\n                        toggleLights();\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('videogularPlayer', ['$rootScope', 'DataService', 'UserActions', '$timeout', '$interval', '$state', 'anchorSmoothScroll', '$sce', '_', function ($rootScope, DataService, UserActions, $timeout, $interval, $state, anchorSmoothScroll, $sce, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/videogular-player.html',\r\n                transclude: true,\r\n                // replace: true,\r\n                scope: {film: '=film', type: '=type', lightsOff: '=lightsOff'},\r\n                link: function (scope, el, attrs) {\r\n\r\n                    scope.onPlayerReady = false;\r\n                    scope.config = {\r\n                        sources: [\r\n                            {src: $sce.trustAsResourceUrl(scope.film.video_url), type: (scope.type === 'HTML5' ? 'video/mp4': undefined) }\r\n                        ],\r\n                        tracks: [],\r\n                        theme: 'http://www.videogular.com/styles/themes/default/latest/videogular.css',\r\n                        plugins: {\r\n                            poster: scope.film.thumbnail_url,\r\n                            controls: {\r\n                                autoHide: false,\r\n                                autoHideTime: 3000,\r\n                            },\r\n                        },\r\n                    };\r\n                    var sources = [];\r\n                    var tracks = [];\r\n                        // var otherSources = [];\r\n                    scope.hideSidebar = false;\r\n                    scope.loaded = false;\r\n\r\n\r\n                    // Setup Playlist\r\n                    // Generate playlist\r\n                    DataService.collection('projects', {owner: scope.film.owner.id, notVideo: scope.film.id, per_page: 20})\r\n                        .then(function (response) {\r\n                            /*scope.otherSources = response.data.data;\r\n                            _.each(response.data.data, function (vid) {\r\n                                setupSource(vid, sources);\r\n                            });*/\r\n\r\n                            // build media object\r\n                            scope.media = {\r\n                                sources: sources,\r\n                                tracks: tracks,\r\n                            };\r\n                            console.log(scope.media);\r\n                        }).finally(function (res) {\r\n                            scope.loaded = true;\r\n                        });\r\n                }\r\n            }\r\n        }])\r\n        .directive('elitePlayer', ['$rootScope', 'DataService', 'UserActions', '$timeout', '$interval', '$state', 'anchorSmoothScroll', '_', function ($rootScope, DataService, UserActions, $timeout, $interval, $state, anchorSmoothScroll, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/videoPlayer.html',\r\n                scope: {film: '=film', type: '=type', lightsOff: '=lightsOff'},\r\n                link: function (scope, el, attrs) {\r\n                    var listenerStarted = false;\r\n                    var hasWatched = false;\r\n                    var playlist = [];\r\n                    //console.log(scope.film);\r\n                    var video = scope.film;\r\n                    //attrs.$observe(\"film\", function (video) {\r\n                    //video = JSON.parse(video);\r\n                    playlist.push({\r\n                        videoType: scope.type,                                      //choose video type: \"HTML5\", \"youtube\", \"vimeo\", \"image\"\r\n                        title: video.name,                                             //video title\r\n                        youtubeID: scope.type === 'youtube' ? video.hosting_id : \"\",   //last part if the URL https://www.youtube.com/watch?v=0dJO0HyE8xE\r\n                        vimeoID: scope.type === 'vimeo' ? video.hosting_id : \"\",          //last part of the URL http://vimeo.com/119641053\r\n                        mp4: scope.type === 'HTML5' ? video.video_url : \"\",               //HTML5 video mp4 url\r\n                        imageUrl: video.thumbnail_url,                                     //display image instead of playing video\r\n                        imageTimer: 4, \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  //set time how long image will display\r\n                        prerollAD: \"no\",                                                                  //show pre-roll \"yes\",\"no\"\r\n                        prerollGotoLink: \"http://getindiewise.com/\",                                         //pre-roll goto link\r\n                        // preroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Short_Elegant_Logo_Reveal.mp4\",   //pre-roll video mp4 format\r\n                        prerollSkipTimer: 5,\r\n                        midrollAD: \"no\",                                                                  //show mid-roll \"yes\",\"no\"\r\n                        midrollAD_displayTime: \"00:10\",                                                    //show mid-roll at any custom time in format \"minutes:seconds\" (\"00:00\")\r\n                        midrollGotoLink: \"http://getindiewise.com/\",                                         //mid-roll goto link\r\n                        // midroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Explode.mp4\", //mid-roll video mp4 format\r\n                        midrollSkipTimer: 5,\r\n                        postrollAD: \"no\",                                                                 //show post-roll \"yes\",\"no\"\r\n                        postrollGotoLink: \"http://getindiewise.com/\",                                        //post-roll goto link\r\n                        // postroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Light.mp4\",  //post-roll video mp4 format\r\n                        postrollSkipTimer: 5,\r\n                        // popupImg: \"images/preview_images/popup.jpg\",                        \t\t\t  \t  //popup image URL\r\n                        popupAdShow: \"no\",                                                                //enable/disable popup image: \"yes\",\"no\"\r\n                        popupAdStartTime: \"00:03\",                                                         //time to show popup ad during playback\r\n                        popupAdEndTime: \"00:07\",                                                           //time to hide popup ad during playback\r\n                        popupAdGoToLink: \"http://getindiewise.com/\",                                         //re-direct to URL when popup ad clicked\r\n                        description: video.description,                                                      //video description\r\n                        thumbImg: video.thumbnail_url||'/assets/img/default_avatar.jpg',                //path to playlist thumbnail image\r\n                        info: \"\"                                                                                    //video info\r\n                    });\r\n\r\n                    // Generate playlist\r\n                    DataService.collection('projects', {owner: video.owner.id, notVideo: video.id, per_page: 20}).then(function (result) {\r\n                        scope.playlistFilms = result.data.data;\r\n                        return scope.playlistFilms;\r\n                    }).then(function (res) {\r\n                        _.each(res, function (vid) {\r\n                            var type = '';\r\n                            if (vid.video_url.indexOf('youtu') != -1) {\r\n                                type = 'youtube';\r\n                            } else if (vid.video_url.indexOf('vimeo') != -1) {\r\n                                type = 'vimeo';\r\n                            } else {\r\n                                type = 'other';\r\n                            }\r\n\r\n                            playlist.push({\r\n                                videoType: type,                                                              //choose video type: \"HTML5\", \"youtube\", \"vimeo\", \"image\"\r\n                                title: vid.name,                                                            //video title\r\n                                youtubeID: type === 'youtube' ? vid.hosting_id : \"\",                                                          //last part if the URL https://www.youtube.com/watch?v=0dJO0HyE8xE\r\n                                vimeoID: type === 'vimeo' ? vid.hosting_id : \"\",                                                              //last part of the URL http://vimeo.com/119641053\r\n                                mp4: type === 'hosted' ? vid.video_url : \"\",               //HTML5 video mp4 url\r\n                                //imageUrl:\"images/preview_images/poster2.jpg\",                                     //display image instead of playing video\r\n                                //imageTimer:4, \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  //set time how long image will display\r\n                                prerollAD: \"no\",                                                                  //show pre-roll \"yes\",\"no\"\r\n                                prerollGotoLink: \"http://getindiewise.com/\",                                         //pre-roll goto link\r\n                                preroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Short_Elegant_Logo_Reveal.mp4\",   //pre-roll video mp4 format\r\n                                prerollSkipTimer: 5,\r\n                                midrollAD: \"no\",                                                                  //show mid-roll \"yes\",\"no\"\r\n                                midrollAD_displayTime: \"00:10\",                                                    //show mid-roll at any custom time in format \"minutes:seconds\" (\"00:00\")\r\n                                midrollGotoLink: \"http://getindiewise.com/\",                                         //mid-roll goto link\r\n                                midroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Explode.mp4\", //mid-roll video mp4 format\r\n                                midrollSkipTimer: 5,\r\n                                postrollAD: \"no\",                                                                 //show post-roll \"yes\",\"no\"\r\n                                postrollGotoLink: \"http://getindiewise.com/\",                                        //post-roll goto link\r\n                                postroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Light.mp4\",  //post-roll video mp4 format\r\n                                postrollSkipTimer: 5,\r\n                                popupImg: \"images/preview_images/popup.jpg\",                        \t\t\t  \t  //popup image URL\r\n                                popupAdShow: \"no\",                                                                //enable/disable popup image: \"yes\",\"no\"\r\n                                popupAdStartTime: \"00:03\",                                                         //time to show popup ad during playback\r\n                                popupAdEndTime: \"00:07\",                                                           //time to hide popup ad during playback\r\n                                popupAdGoToLink: \"http://getindiewise.com/\",                                         //re-direct to URL when popup ad clicked\r\n                                description: vid.url_id,                                                      //video description\r\n                                thumbImg: vid.thumbnail_url||'/assets/img/default_avatar.jpg',                //path to playlist thumbnail image\r\n                                info: \"\"                                                                                    //video info\r\n                            });\r\n                        });\r\n                    }).finally(function () {\r\n                        window.videoPlayer = scope.videoPlayer = el.Video({                  //ALL PLUGIN OPTIONS\r\n                            instanceName: \"player1\",                      //name of the player instance\r\n                            instanceTheme:\"dark\",                        //choose video player theme: \"dark\", \"light\"\r\n                            autohideControls: 2,                          //autohide HTML5 player controls\r\n                            hideControlsOnMouseOut: \"No\",                 //hide HTML5 player controls on mouse out of the player: \"Yes\",\"No\"\r\n                            playerLayout: \"fitToContainer\",                   //Select player layout: \"fitToContainer\", \"fixedSize\", \"fitToBrowser\"\r\n                            // videoPlayerWidth: '100%',                     //fixed total player width\r\n                            // videoPlayerHeight: Foundation.MediaQuery.atLeast('large') ? 470 : 420,                       //fixed total player height\r\n                            responsive: true,  //!Foundation.MediaQuery.atLeast('large'),\t\t\t\t             //this option will overwrite above videoPlayerWidth/videoPlayerHeight and set player to fit your div (parent) container: true/false\r\n                            playlist: /*scope.type === 'vimeo' ? \"Off\" :*/ \"Right playlist\",                   //choose playlist type: \"Right playlist\", \"Off\"\r\n                            playlistScrollType: \"light\",                  //choose scrollbar type: \"light\",\"minimal\",\"light-2\",\"light-3\",\"light-thick\",\"light-thin\",\"inset\",\"inset-2\",\"inset-3\",\"rounded\",\"rounded-dots\",\"3d\"\r\n                            playlistBehaviourOnPageload: \"closed\",\t\t //choose playlist behaviour when webpage loads: \"closed\", \"opened\" (not apply to Vimeo player)\r\n                            autoplay: false,                              //autoplay when webpage loads: true/false\r\n                            colorAccent: \"#3F51B5\",                       //plugin colors accent (hexadecimal or RGB value - http://www.colorpicker.com/)\r\n                            vimeoColor: \"00adef\",                         //set \"hexadecimal value\", default vimeo color is \"00adef\"\r\n                            youtubeControls: \"custom controls\",\t\t\t //choose youtube player controls: \"custom controls\", \"default controls\"\r\n                            youtubeSkin: \"dark\",                          //default youtube controls theme: light, dark\r\n                            youtubeColor: \"red\",                          //default youtube controls bar color: red, white\r\n                            youtubeQuality: \"default\",                    //choose youtube quality: \"small\", \"medium\", \"large\", \"hd720\", \"hd1080\", \"highres\", \"default\"\r\n                            youtubeShowRelatedVideos: \"No\",\t\t\t\t //choose to show youtube related videos when video finish: \"Yes\", \"No\" (onFinish:\"Stop video\" needs to be enabled)\r\n                            videoPlayerShadow: \"effect2\",                 //choose player shadow:  \"effect1\" , \"effect2\", \"effect3\", \"effect4\", \"effect5\", \"effect6\", \"off\"\r\n                            loadRandomVideoOnStart: \"No\",                 //choose to load random video when webpage loads: \"Yes\", \"No\"\r\n                            shuffle: \"No\",\t\t\t\t                 //choose to shuffle videos when playing one after another: \"Yes\", \"No\" (shuffle button enabled/disabled on start)\r\n                            posterImg: '',//video.thumbnail_url,                               //player poster image\r\n                            onFinish: \"Stop video\",                      //\"Play next video\",\"Restart video\", \"Stop video\",\r\n                            nowPlayingText: \"Yes\",                        //enable disable now playing title: \"Yes\",\"No\"\r\n                            fullscreen: \"Fullscreen native\",              //choose fullscreen type: \"Fullscreen native\",\"Fullscreen browser\"\r\n                            rightClickMenu: false,                         //enable/disable right click over HTML5 player: true/false\r\n                            hideVideoSource: true,\t\t\t\t\t\t //option to hide self hosted video sources (to prevent users from download/steal your videos): true/false\r\n                            showAllControls: true,\t\t\t\t\t\t //enable/disable all HTML5 player controls: true/false\r\n                            allowSkipAd: true,                            //enable/disable \"Skip advertisement\" option: true/false\r\n                            infoShow: \"No\",                              //enable/disable info option: \"Yes\",\"No\"\r\n                            shareShow: \"No\",                             //enable/disable all share options: \"Yes\",\"No\"\r\n                            facebookShow: \"No\",                          //enable/disable facebook option individually: \"Yes\",\"No\"\r\n                            twitterShow: \"No\",                           //enable/disable twitter option individually: \"Yes\",\"No\"\r\n                            mailShow: \"No\",                              //enable/disable mail option individually: \"Yes\",\"No\"\r\n                            facebookShareName: video.name,      //first parametar of facebook share in facebook feed dialog is title\r\n                            facebookShareLink: window.location.href,  //second parametar of facebook share in facebook feed dialog is link below title\r\n                            facebookShareDescription: video.description, //third parametar of facebook share in facebook feed dialog is description below link\r\n                            facebookSharePicture: video.thumbnail_url, //fourth parametar in facebook feed dialog is picture on left side\r\n                            twitterText: video.name,\t\t\t //first parametar of twitter share in twitter feed dialog is text\r\n                            twitterLink: window.location.href, //second parametar of twitter share in twitter feed dialog is link\r\n                            twitterHashtags: \"indiewise\",\t\t //third parametar of twitter share in twitter feed dialog is hashtag\r\n                            twitterVia: \"IndieWise\",\t\t\t\t //fourth parametar of twitter share in twitter feed dialog is via (@)\r\n                            googlePlus: window.location.href, //share link over Google +\r\n                            logoShow: \"Yes\",                              //\"Yes\",\"No\"\r\n                            logoClickable: \"No\",                         //\"Yes\",\"No\"\r\n                            logoPath: \"/assets/img/Logo_alt2_web_87x45.png\",             //path to logo image\r\n                            logoGoToLink: \"http://getindiewise.com\",       //redirect to page when logo clicked\r\n                            logoPosition: \"bottom-left\",                  //choose logo position: \"bottom-right\",\"bottom-left\"\r\n                            embedShow: \"No\",                             //enable/disable embed option: \"Yes\",\"No\"\r\n                            embedCodeSrc: \"www.yourwebsite.com/videoplayer/index.html\", //path to your video player on server\r\n                            embedCodeW: \"746\",                            //embed player code width\r\n                            embedCodeH: \"420\",                            //embed player code height\r\n                            embedShareLink: window.location.href, //direct link to your site (or any other URL) you want to be \"shared\"\r\n                            youtubePlaylistID: \"\",                        //automatic youtube playlist ID (leave blank \"\" if you want to use manual playlist) LL4qbSRobYCjvwo4FCQFrJ4g\r\n                            youtubeChannelID: \"\",                         //automatic youtube channel ID (leave blank \"\" if you want to use manual playlist) UCHqaLr9a9M7g9QN6xem9HcQ\r\n\r\n                            //manual playlist\r\n                            videos: playlist\r\n                        });\r\n\r\n                        // playlist actions\r\n                        el.find('.elite_vp_item:not(:first) *').bind('click', function (event) {\r\n                            event.preventDefault();\r\n                            var $parent = jQuery(this).hasClass('elite_vp_item') ? jQuery(this) : jQuery(this).parents('.elite_vp_item');\r\n                            var $description = $parent.find('.elite_vp_description');\r\n                            var urlId = $description.html().trim();\r\n                            $state.go('video', {url_id: urlId});\r\n                        });\r\n\r\n                        el.find('.fa-elite-backward').bind('click', function (event) {\r\n                            event.preventDefault();\r\n                            var $parent = jQuery('.elite_vp_itemSelected').prev();\r\n                            if (!$parent.length) {\r\n                                $parent = jQuery('.elite_vp_item').last();\r\n                            }\r\n                            var $description = $parent.find('.elite_vp_description');\r\n                            var urlId = $description.html().trim();\r\n                            $state.go('video', {url_id: urlId});\r\n                        });\r\n\r\n                        el.find('.fa-elite-forward').bind('click', function (event) {\r\n                            event.preventDefault();\r\n                            var $parent = jQuery('.elite_vp_itemSelected').next();\r\n                            var $description = $parent.find('.elite_vp_description');\r\n                            var urlId = $description.html().trim();\r\n                            $state.go('video', {url_id: urlId});\r\n                        });\r\n\r\n                        // $timeout(function () {\r\n                        //     scope.startedPlaying();\r\n                        // }, 100);\r\n\r\n                        scope.startedPlaying = $interval(function () {\r\n                            // If Vimeo video\r\n                            if (scope.videoPlayer.state === 'loading' && !!angular.element('#elite_vp_vimeoWrapper iframe')) {\r\n                                // Listen for messages from the player\r\n                                if (!listenerStarted) {\r\n                                    if (window.addEventListener) {\r\n                                        window.addEventListener('message', vimeoListener, false);\r\n                                    }\r\n                                    else {\r\n                                        window.attachEvent('onmessage', vimeoListener);\r\n                                    }\r\n                                    listenerStarted = true;\r\n                                }\r\n                            }\r\n\r\n                            // if YouTube Video\r\n                            if (scope.videoPlayer.state === \"elite_vp_playing\") {\r\n                                toggleLights();\r\n                                $rootScope.initWatch();\r\n\r\n                                switch (scope.type) {\r\n                                    case \"youtube\":\r\n                                        //console.log('Youtube API is Ready');\r\n                                        scope.videoPlayer.youtubePlayer.addEventListener(\"onStateChange\", function (a) {\r\n                                            //console.log(a.target.getPlayerState());\r\n                                            if (a.target.getPlayerState() == 0) {\r\n                                                //console.log('Scroll page to content');\r\n                                                if (!!scope.lightsOff) {\r\n                                                    toggleLights();\r\n                                                }\r\n                                                //anchorSmoothScroll.scrollTo('SinglePostStats');\r\n                                            }\r\n                                        });\r\n                                        break;\r\n                                }\r\n\r\n                                $interval.cancel(scope.startedPlaying)\r\n                            }\r\n                        }, 1000);\r\n\r\n                    });\r\n\r\n                    function vimeoListener(event) {\r\n                        // Handle messages from the vimeo player only\r\n                        if (!(/^https?:\\/\\/player.vimeo.com/).test(event.origin)) {\r\n                            return false;\r\n                        }\r\n                        var data = JSON.parse(event.data);\r\n\r\n                        if (data.event === 'playProgress') {\r\n                            if (!hasWatched) {\r\n                                if (!!scope.lightsOff) {\r\n                                    toggleLights();\r\n                                }\r\n                                $rootScope.initWatch();\r\n                                hasWatched = true;\r\n                                $interval.cancel(scope.startedPlaying)\r\n                            }\r\n\r\n                            if (window.addEventListener) {\r\n                                window.removeEventListener('message', vimeoListener, false);\r\n                            }\r\n                            else {\r\n                                window.detachEvent('onmessage', vimeoListener);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    function toggleLights() {\r\n                        scope.lightsOff = !scope.lightsOff;\r\n                        var overlay = jQuery('#overlay');\r\n                        overlay.fadeToggle(1000);\r\n                        /* Choose desired delay */\r\n                        if (!scope.lightsOff) {\r\n                            $timeout(function () {\r\n                                overlay.removeClass('highlight');\r\n                            }, 1000);\r\n                            /* Same delay */\r\n                        } else {\r\n                            overlay.addClass('highlight');\r\n                        }\r\n                    }\r\n\r\n                    jQuery('#overlay').on('click', function () {\r\n                        toggleLights();\r\n                    });\r\n\r\n                    // TODO: on playlist end, exit fullscreen\r\n                    //videoPlayer.fsEnter.click()\r\n\r\n\r\n                    //$state.go('stateName',params,{\r\n                    //    // prevent the events onStart and onSuccess from firing\r\n                    //    notify:false,\r\n                    //    // prevent reload of the current state\r\n                    //    reload:false,\r\n                    //    // replace the last record when changing the params so you don't hit the back button and get old params\r\n                    //    location:'replace',\r\n                    //    // inherit the current params on the url\r\n                    //    inherit:true\r\n                    //});\r\n                }\r\n            }\r\n        }])\r\n        .directive('elitePlayerEmbed', ['$rootScope', '_', function ($rootScope, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/videoPlayer.html',\r\n                scope: { name: '=', hosting_id: '=', url: '=', type: '=', thumbnail: '=', description: '=' },\r\n                link: function (scope, el, attrs) {\r\n                    var playlist = [];\r\n                    playlist.push({\r\n                        videoType: scope.type,                                      //choose video type: \"HTML5\", \"youtube\", \"vimeo\", \"image\"\r\n                        title: scope.name,                                             //video title\r\n                        youtubeID: scope.type === 'youtube' ? scope.hosting_id : \"\",   //last part if the URL https://www.youtube.com/watch?v=0dJO0HyE8xE\r\n                        vimeoID: scope.type === 'vimeo' ? scope.hosting_id : \"\",          //last part of the URL http://vimeo.com/119641053\r\n                        mp4: scope.type === 'HTML5' ? scope.url : \"\",               //HTML5 video mp4 url\r\n                        imageUrl: scope.thumbnail,                                     //display image instead of playing video\r\n                        imageTimer: 4, \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  //set time how long image will display\r\n                        prerollAD: \"no\",                                                                  //show pre-roll \"yes\",\"no\"\r\n                        prerollGotoLink: \"http://getindiewise.com/\",                                         //pre-roll goto link\r\n                        // preroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Short_Elegant_Logo_Reveal.mp4\",   //pre-roll video mp4 format\r\n                        prerollSkipTimer: 5,\r\n                        midrollAD: \"no\",                                                                  //show mid-roll \"yes\",\"no\"\r\n                        midrollAD_displayTime: \"00:10\",                                                    //show mid-roll at any custom time in format \"minutes:seconds\" (\"00:00\")\r\n                        midrollGotoLink: \"http://getindiewise.com/\",                                         //mid-roll goto link\r\n                        // midroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Explode.mp4\", //mid-roll video mp4 format\r\n                        midrollSkipTimer: 5,\r\n                        postrollAD: \"no\",                                                                 //show post-roll \"yes\",\"no\"\r\n                        postrollGotoLink: \"http://getindiewise.com/\",                                        //post-roll goto link\r\n                        // postroll_mp4: \"http://creativeinteractivemedia.com/player/videos/Logo_Light.mp4\",  //post-roll video mp4 format\r\n                        postrollSkipTimer: 5,\r\n                        // popupImg: \"images/preview_images/popup.jpg\",                        \t\t\t  \t  //popup image URL\r\n                        popupAdShow: \"no\",                                                                //enable/disable popup image: \"yes\",\"no\"\r\n                        popupAdStartTime: \"00:03\",                                                         //time to show popup ad during playback\r\n                        popupAdEndTime: \"00:07\",                                                           //time to hide popup ad during playback\r\n                        popupAdGoToLink: \"http://getindiewise.com/\",                                         //re-direct to URL when popup ad clicked\r\n                        description: '',                                                      //video description\r\n                        thumbImg: scope.thumbnail,                                                      //path to playlist thumbnail image\r\n                        info: \"\"                                                                                    //video info\r\n                    });\r\n\r\n                    scope.videoPlayer = el.Video({                  //ALL PLUGIN OPTIONS\r\n                        instanceName: \"player_\" + new Date().valueOf().toString(),                      //name of the player instance\r\n                        instanceTheme:\"dark\",                        //choose video player theme: \"dark\", \"light\"\r\n                        autohideControls: 2,                          //autohide HTML5 player controls\r\n                        hideControlsOnMouseOut: \"No\",                 //hide HTML5 player controls on mouse out of the player: \"Yes\",\"No\"\r\n                        playerLayout: \"fixedSize\",\r\n                        videoPlayerWidth: '100%',                     //fixed total player width\r\n                        videoPlayerHeight: Foundation.MediaQuery.atLeast('large') ? 470 : 420,                       //fixed total player height\r\n                        // responsive: true,  //!Foundation.MediaQuery.atLeast('large'),\t\t\t\t             //this option will overwrite above videoPlayerWidth/videoPlayerHeight and set player to fit your div (parent) container: true/false\r\n                        playlist: \"Off\",                   //choose playlist type: \"Right playlist\", \"Off\"\r\n                        playlistScrollType: \"light\",                  //choose scrollbar type: \"light\",\"minimal\",\"light-2\",\"light-3\",\"light-thick\",\"light-thin\",\"inset\",\"inset-2\",\"inset-3\",\"rounded\",\"rounded-dots\",\"3d\"\r\n                        playlistBehaviourOnPageload: \"closed\",\t\t //choose playlist behaviour when webpage loads: \"closed\", \"opened\" (not apply to Vimeo player)\r\n                        autoplay: false,                              //autoplay when webpage loads: true/false\r\n                        colorAccent: \"#3F51B5\",                       //plugin colors accent (hexadecimal or RGB value - http://www.colorpicker.com/)\r\n                        vimeoColor: \"00adef\",                         //set \"hexadecimal value\", default vimeo color is \"00adef\"\r\n                        youtubeControls: \"custom controls\",\t\t\t //choose youtube player controls: \"custom controls\", \"default controls\"\r\n                        youtubeSkin: \"dark\",                          //default youtube controls theme: light, dark\r\n                        youtubeColor: \"red\",                          //default youtube controls bar color: red, white\r\n                        youtubeQuality: \"default\",                    //choose youtube quality: \"small\", \"medium\", \"large\", \"hd720\", \"hd1080\", \"highres\", \"default\"\r\n                        youtubeShowRelatedVideos: \"No\",\t\t\t\t //choose to show youtube related videos when video finish: \"Yes\", \"No\" (onFinish:\"Stop video\" needs to be enabled)\r\n                        videoPlayerShadow: \"effect2\",                 //choose player shadow:  \"effect1\" , \"effect2\", \"effect3\", \"effect4\", \"effect5\", \"effect6\", \"off\"\r\n                        loadRandomVideoOnStart: \"No\",                 //choose to load random video when webpage loads: \"Yes\", \"No\"\r\n                        shuffle: \"No\",\t\t\t\t                 //choose to shuffle videos when playing one after another: \"Yes\", \"No\" (shuffle button enabled/disabled on start)\r\n                        posterImg: '',//video.thumbnail_url,                               //player poster image\r\n                        onFinish: \"Stop video\",                      //\"Play next video\",\"Restart video\", \"Stop video\",\r\n                        nowPlayingText: \"Yes\",                        //enable disable now playing title: \"Yes\",\"No\"\r\n                        fullscreen: \"Fullscreen native\",              //choose fullscreen type: \"Fullscreen native\",\"Fullscreen browser\"\r\n                        rightClickMenu: false,                         //enable/disable right click over HTML5 player: true/false\r\n                        hideVideoSource: true,\t\t\t\t\t\t //option to hide self hosted video sources (to prevent users from download/steal your videos): true/false\r\n                        showAllControls: true,\t\t\t\t\t\t //enable/disable all HTML5 player controls: true/false\r\n                        allowSkipAd: true,                            //enable/disable \"Skip advertisement\" option: true/false\r\n                        infoShow: \"No\",                              //enable/disable info option: \"Yes\",\"No\"\r\n                        shareShow: \"No\",                             //enable/disable all share options: \"Yes\",\"No\"\r\n                        facebookShow: \"No\",                          //enable/disable facebook option individually: \"Yes\",\"No\"\r\n                        twitterShow: \"No\",                           //enable/disable twitter option individually: \"Yes\",\"No\"\r\n                        mailShow: \"No\",                              //enable/disable mail option individually: \"Yes\",\"No\"\r\n                        facebookShareName: scope.name,      //first parametar of facebook share in facebook feed dialog is title\r\n                        facebookShareLink: window.location.href,  //second parametar of facebook share in facebook feed dialog is link below title\r\n                        facebookShareDescription: scope.description, //third parametar of facebook share in facebook feed dialog is description below link\r\n                        facebookSharePicture: scope.thumbnail, //fourth parametar in facebook feed dialog is picture on left side\r\n                        twitterText: scope.name,\t\t\t //first parametar of twitter share in twitter feed dialog is text\r\n                        twitterLink: window.location.href, //second parametar of twitter share in twitter feed dialog is link\r\n                        twitterHashtags: \"indiewise\",\t\t //third parametar of twitter share in twitter feed dialog is hashtag\r\n                        twitterVia: \"IndieWise\",\t\t\t\t //fourth parametar of twitter share in twitter feed dialog is via (@)\r\n                        googlePlus: window.location.href, //share link over Google +\r\n                        logoShow: \"Yes\",                              //\"Yes\",\"No\"\r\n                        logoClickable: \"No\",                         //\"Yes\",\"No\"\r\n                        logoPath: \"/assets/img/Logo_alt2_web_87x45.png\",             //path to logo image\r\n                        logoGoToLink: \"http://getindiewise.com\",       //redirect to page when logo clicked\r\n                        logoPosition: \"bottom-left\",                  //choose logo position: \"bottom-right\",\"bottom-left\"\r\n                        embedShow: \"No\",                             //enable/disable embed option: \"Yes\",\"No\"\r\n                        embedCodeSrc: \"www.yourwebsite.com/videoplayer/index.html\", //path to your video player on server\r\n                        embedCodeW: \"746\",                            //embed player code width\r\n                        embedCodeH: \"420\",                            //embed player code height\r\n                        embedShareLink: window.location.href, //direct link to your site (or any other URL) you want to be \"shared\"\r\n                        youtubePlaylistID: \"\",                        //automatic youtube playlist ID (leave blank \"\" if you want to use manual playlist) LL4qbSRobYCjvwo4FCQFrJ4g\r\n                        youtubeChannelID: \"\",                         //automatic youtube channel ID (leave blank \"\" if you want to use manual playlist) UCHqaLr9a9M7g9QN6xem9HcQ\r\n\r\n                        //manual playlist\r\n                        videos: playlist\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('offCanvasNav', ['$rootScope', function ($rootScope) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, el, attrs) {\r\n                    el.find('a').on('click', function () {\r\n                        angular.element('#offCanvas-responsive').foundation('close');\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('messagesHeight', ['$window', function ($window) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, el, attrs) {\r\n                    setHeight();\r\n                    angular.element($window).bind('resize', function(){\r\n                        setHeight();\r\n\r\n                        scope.$digest();\r\n                    });\r\n\r\n                    function setHeight() {\r\n                        var parentEl = el.parent();\r\n                        var prevElHeight = el.prev().height();\r\n                        var nextElHeight = el.next().height();\r\n                        var newHeight = $window.innerHeight - (parentEl.offset().top + prevElHeight + nextElHeight);\r\n                        scope.Msgs.viewportHeight = {height: newHeight + 'px'};\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('sideNavNotif', ['$mdSidenav', function ($mdSidenav) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, el, attrs) {\r\n                    el.find('a').bind('click', function () {\r\n                        $mdSidenav('right').close();\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('helpInfo', [function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                templateUrl: 'directives/help-info.html',\r\n                scope: {\r\n                    text: '=text',\r\n                    direction: '=direction'\r\n                }\r\n            }\r\n        }])\r\n        .directive('projectCard', ['$rootScope', '$state', '$modal', '$mdMedia', 'UserActions', function ($rootScope, $state, $modal, $mdMedia, UserActions) {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: false,\r\n                templateUrl: 'directives/project-card.html',\r\n                scope: {\r\n                    video: '=video',\r\n                    type: '=type',\r\n                    related: '=related',\r\n                    queried: '=queried'\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    scope.isQueried = scope.queried === 'true';\r\n                    scope.isLoggedIn = $rootScope.AppData.User;\r\n                    scope.openShareDialog = openShareDialog;\r\n\r\n                    function openShareDialog(video) {\r\n                        $modal.open({\r\n                            templateUrl: 'common/shareDialog.html',\r\n                            resolve: {\r\n                                Video: function () {\r\n                                    return video;\r\n                                }\r\n                            },\r\n                            controller: ['$scope', '$modalInstance', 'Video', function ($scope, $modalInstance, Video) {\r\n                                $scope.video = Video;\r\n                                $scope.shareLink = window.location.origin + '/' + Video.url_id;\r\n                                $scope.cancel = function () {\r\n                                    $modalInstance.close();\r\n                                };\r\n                            }]\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('commentsBlock', ['$rootScope', 'DataService', 'UserActions', '$modal', '_', function ($rootScope, DataService, UserActions, $modal, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/comments.html',\r\n                scope: {\r\n                    comments: '=comments',\r\n                    disable: '=disable',\r\n                    parent: '=parent',\r\n                    child: '=child',\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    scope.model = {\r\n                        myComment: null,\r\n                        isLoggedIn: $rootScope.AppData.User,\r\n                    };\r\n                    scope.myReply = null;\r\n                    scope.showCommentInput = false;\r\n                    scope.showReplyInput = false;\r\n                    scope.editCommentMode = false;\r\n                    scope.postComment = _.throttle(postComment, 1000);\r\n                    scope.deleteComment = deleteComment;\r\n                    scope.loadReplies = loadReplies;\r\n                    scope.showReplies = false;\r\n                    scope.toggleCommentInput = toggleCommentInput;\r\n                    scope.toggleEditCommentMode = toggleEditCommentMode;\r\n                    scope.toggleReplyInput = toggleReplyInput;\r\n\r\n                    function postComment() {\r\n                        if (!$rootScope.isAuthenticated()) {\r\n                            UserActions.loginModal();\r\n                            return false;\r\n                        }\r\n\r\n                        if ($rootScope.isNotVerified()) {\r\n                            $rootScope.toastAction('Please verify your account so you can rate videos! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                            return false;\r\n                        }\r\n\r\n                        DataService.save('comments', {\r\n                            body: scope.model.myComment,\r\n                            critique_id: !scope.parent.hasOwnProperty('unlist') ? scope.parent.id : undefined,\r\n                            user_id: scope.model.isLoggedIn.id\r\n                        })\r\n                            .then(function (comment) {\r\n                                scope.comments.data.push(comment.data.data);\r\n                                $rootScope.toastMessage('Comment posted!');\r\n                                scope.model.myComment = null;\r\n                                clearCommentinput();\r\n                                scope.parent.comments_count++;\r\n                            }, function (error) {\r\n                                console.log('Failed to create new comment, with error code: ' + error.message);\r\n                            });\r\n                    }\r\n\r\n                    function deleteComment(c, ev) {\r\n                        UserActions.checkAuth().then(function (res) {\r\n                            if (res) {\r\n                                var confirm = $modal.confirm()\r\n                                    .title('Would you like to delete your comment?')\r\n                                    //.content('All of the banks have agreed to <span class=\"debt-be-gone\">forgive</span> you your debts.')\r\n                                    //.ariaLabel('Lucky day')\r\n                                    .targetEvent(ev)\r\n                                    .ok('Delete')\r\n                                    .cancel('Cancel');\r\n                                $modal.show(confirm).then(function () {\r\n                                    var p = c.parentComment || undefined;\r\n\r\n                                    DataService.delete('comments', c.id).then(function (res) {\r\n                                        // Decrement film commentCount\r\n                                        scope.parent.commentCount--;\r\n\r\n\r\n                                        if (angular.isUndefined(p)) {\r\n                                            // normal comment\r\n                                            scope.comments = _.reject(scope.comments, function (a) {\r\n                                                return a.id === c.id;\r\n                                            });\r\n\r\n                                        } else {\r\n                                            // reply comment\r\n                                            var z = _.find(scope.comments, function (a) {\r\n                                                return a.id === p.id;\r\n                                            });\r\n\r\n                                            z.replies = _.reject(z.replies, function (a) {\r\n                                                return a.id === c.id;\r\n                                            });\r\n                                            // Increment film commentCount\r\n                                            var pcQuery = new Parse.Query(\"Comment\");\r\n                                            pcQuery.get(p.id).then(function (res) {\r\n                                                res.increment('replyCount', -1);\r\n                                                res.save();\r\n                                            });\r\n\r\n                                            return c = undefined;\r\n                                        }\r\n\r\n                                        $rootScope.toastMessage('Your comment was deleted.');\r\n                                    });\r\n                                }, function () {\r\n                                    //$scope.status = 'You decided to keep your debt.';\r\n                                });\r\n                            }\r\n                        })\r\n                    }\r\n\r\n                    function loadReplies(comment) {\r\n                        // Fetch Replies\r\n                        if (!comment.repliesLoaded) {\r\n                            DataService.collection('comments', {comment: comment.id}).then(function (replies) {\r\n                                comment.replies = replies.data.data;\r\n                                comment.repliesLoaded = true;\r\n                                comment.showReplies = !comment.showReplies;\r\n                                return comment;\r\n                            });\r\n                        } else {\r\n                            comment.showReplies = !comment.showReplies;\r\n                            return comment;\r\n                        }\r\n                    }\r\n\r\n                    function toggleCommentInput() {\r\n                        scope.showCommentInput = !scope.showCommentInput;\r\n                    }\r\n\r\n                    function clearCommentinput() {\r\n                        scope.model.myComment = null;\r\n                    }\r\n\r\n                    function toggleEditCommentMode(comment) {\r\n                        scope.editCommentMode = !scope.editCommentMode;\r\n                        scope.editComment = !!scope.editCommentMode ? comment : undefined;\r\n                    }\r\n\r\n                    function toggleReplyInput(comment) {\r\n                        scope.showReplyInput = !scope.showReplyInput;\r\n                        scope.targetComment = comment;\r\n                    }\r\n\r\n                    scope.$on('reply:complete', function (event, comment) {\r\n                        scope.toggleReplyInput(undefined);\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('critiquesBlock', ['$rootScope', 'DataService', 'UserActions', '$modal', '_', function ($rootScope, DataService, UserActions, $modal, _) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/critiques.html',\r\n                scope: {\r\n                    critiques: '=critiques',\r\n                    disable: '=disable',\r\n                    parentUrlId: '=',\r\n                    parentOwnerId: '='\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    scope.isLoggedIn = $rootScope.AppData.User;\r\n                    scope.showQuickReply = Foundation.MediaQuery.atLeast('large');\r\n\r\n                    scope.isPrivate = function (critique) {\r\n                        return critique.private;\r\n                    };\r\n\r\n                    scope.isOwnerOrAuthor = function (critique) {\r\n                        return scope.isLoggedIn && (scope.isLoggedIn.id == critique.user_id || scope.isLoggedIn.id == scope.parentOwnerId);\r\n                    };\r\n\r\n                    scope.deleteCritique = function (c) {\r\n                        UserActions.checkAuth().then(function (res) {\r\n                            if (res) {\r\n                                var modalInstance = $modal.open({\r\n                                    templateUrl: 'common/confirmDialog.html',\r\n                                    controller: ['$scope', '$modalInstance', function ($scope, $modalInstance) {\r\n                                        $scope.ok = function () {\r\n                                            $modalInstance.close(true);\r\n                                        };\r\n\r\n                                        $scope.cancel = function () {\r\n                                            $modalInstance.dismiss('cancel');\r\n                                        };\r\n                                    }],\r\n                                    size: Foundation.MediaQuery.atLeast('large') ? 'tiny' : 'small',\r\n                                    keyboard: true\r\n                                });\r\n                                modalInstance.result.then(function () {\r\n                                    if (scope.isOwnerOrAuthor) {\r\n                                        DataService.delete('Critique', c.id).then(function () {\r\n                                            $rootScope.toastMessage('Your critique was deleted.');\r\n                                            // Decrement film critiques_count\r\n                                            self.film.critiques_count--;\r\n                                            scope.updateVideoObj();\r\n                                            self.checkUserActions();\r\n                                            scope.critiques = _.reject(scope.critiques, function (a) {\r\n                                                return a.id === c.id;\r\n                                            });\r\n                                        });\r\n                                    }\r\n                                }, function () {\r\n                                    // console.info('Modal dismissed at: ' + new Date());\r\n                                });\r\n                            }\r\n                        })\r\n                    };\r\n                }\r\n            }\r\n        }])\r\n        .directive('toggleReplies', ['$rootScope', function ($rootScope) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, el, attrs) {\r\n                    /*if (scope.comment.replies_count) {\r\n                        el.html('Show replies <i class=\"fa fa-angle-down\"></i>');\r\n                    }*/\r\n                    //comments reply hide show\r\n                    el.on('click', function () {\r\n                        scope.loadReplies(scope.comment);\r\n                        if (scope.comment.replies_count  /*jQuery(this).parent().next().length > 0*/) {\r\n                            jQuery(this).parent().nextAll().slideToggle();\r\n                            //jQuery(this).html(jQuery(this).text() === 'Hide replies' ? 'Show replies' : 'Hide replies');\r\n                            if (jQuery(this).hasClass('hide-reply')) {\r\n                                jQuery(this).removeClass('hide-reply');\r\n                                jQuery(this).html('Show replies <i class=\"fa fa-angle-down\"></i>');\r\n                            } else {\r\n                                jQuery(this).addClass('hide-reply');\r\n                                jQuery(this).html('Hide replies <i class=\"fa fa-angle-up\"></i>');\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                }\r\n            }\r\n        }])\r\n        .directive('repliesBlock', [function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'directives/replies.html',\r\n                link: function (scope, el, attrs) {\r\n\r\n                }\r\n            }\r\n        }])\r\n        .directive('replyBlock', ['$rootScope', 'UserActions', 'DataService', '_', function ($rootScope, UserActions, DataService, _) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'directives/reply-comment.html',\r\n                link: function (scope, el, attrs) {\r\n                    scope.postReply = _.throttle(postReply, 1000);\r\n                    function postReply() {\r\n                        if (!$rootScope.isAuthenticated()) {\r\n                            UserActions.loginModal();\r\n                            return false;\r\n                        }\r\n\r\n                        if ($rootScope.isNotVerified()) {\r\n                            $rootScope.toastAction('Please verify your account so you can rate videos! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                            return false;\r\n                        }\r\n\r\n                                var repliedTo = angular.isString(scope.targetComment.comment_id) ? scope.targetComment.comment_id : scope.targetComment;\r\n                                if (angular.isString(repliedTo)) {\r\n                                    repliedTo = _.findWhere(scope.comments.data, {id: scope.targetComment.comment_id})\r\n                                }\r\n                                DataService.save('comments', {\r\n                                    body: scope.myReply,\r\n                                    critique_id: scope.parent.id,\r\n                                    comment_id: repliedTo.id,\r\n                                    user_id: scope.model.isLoggedIn.id\r\n                                }).then(function (comment) {\r\n\r\n                                    if (!!repliedTo.repliesLoaded) {\r\n                                        var repliesLoaded = true;\r\n                                        var oldReplies = repliedTo.replies || [];\r\n                                    }\r\n                                    if (!repliedTo.replies) {\r\n                                        repliedTo.replies = [];\r\n                                    }\r\n\r\n                                    repliedTo.replies.push(comment.data.data);\r\n                                    repliedTo.replies_count++;\r\n                                    scope.toggleReplyInput();\r\n                                    // refresh parent data\r\n                                    scope.parent.comments_count++;\r\n                                    if (scope.parent.hasOwnProperty('unlist')) {\r\n                                        DataService.item('projects', scope.parent.id).then(function (a) {\r\n                                            angular.extend(scope.parent, a.data.data);\r\n                                            if (repliesLoaded) {\r\n                                                repliedTo.repliesLoaded = true;\r\n                                                oldReplies.push(comment.data.data);\r\n                                                repliedTo.replies = oldReplies;\r\n                                            }\r\n                                        });\r\n                                    } else {\r\n                                        DataService.item('critiques', scope.parent.id).then(function (a) {\r\n                                            angular.extend(scope.parent, a.data.data);\r\n                                            if (repliesLoaded) {\r\n                                                repliedTo.repliesLoaded = true;\r\n                                                oldReplies.push(comment.data.data);\r\n                                                repliedTo.replies = oldReplies;\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                    $rootScope.toastMessage('Reply posted!');\r\n                                    scope.myReply = null;\r\n\r\n                                }, function (error) {\r\n                                    console.log('Failed to create new reply, with error code: ' + error.message);\r\n                                });\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('quickReplyBlock', ['$rootScope', 'UserActions', 'DataService', '_', function ($rootScope, UserActions, DataService, _) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'directives/reply-comment.html',\r\n                link: function (scope, el, attrs) {\r\n                    scope.model = {\r\n                        isLoggedIn: $rootScope.AppData.User\r\n                    };\r\n\r\n                    scope.postReply = _.throttle(postReply, 1000);\r\n                    function postReply() {\r\n                        if (!$rootScope.isAuthenticated()) {\r\n                            UserActions.loginModal();\r\n                            return false;\r\n                        }\r\n\r\n                        if ($rootScope.isNotVerified()) {\r\n                            $rootScope.toastAction('Please verify your account so you can rate videos! Check your spam folder too.', 'Verify Now', $rootScope.requestVerificationEmail());\r\n                            return false;\r\n                        }\r\n\r\n                        DataService.save('comments', {\r\n                            body: scope.myReply,\r\n                            critique_id: scope.critique.id,\r\n                            user_id: scope.model.isLoggedIn.id\r\n                        }).then(function (comment) {\r\n                            scope.critique.comments_count++;\r\n                            scope.myReply = null;\r\n                            scope.showQuickReply = false;\r\n\r\n                            // register Action\r\n                            $rootScope.toastMessage('Quick Reply posted!');\r\n                        }, function (error) {\r\n                            console.log('Failed to create new reply, with error code: ' + error.message);\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('editCommentBlock', ['$rootScope', 'UserActions', 'DataService', '_', function ($rootScope, UserActions, DataService, _) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'directives/edit-comment.html',\r\n                link: function (scope, el, attrs) {\r\n                    scope.editedBody = scope.editComment.body;\r\n                    scope.updateComment = _.throttle(updateComment, 1000);\r\n                    function updateComment() {\r\n                        if (scope.editedBody === scope.editComment.body) {\r\n                            scope.toggleEditCommentMode();\r\n                            return scope.editComment;\r\n                        }\r\n                        UserActions.checkAuth().then(function (res) {\r\n                            DataService.update('comments', scope.editComment.id, {\r\n                                body: scope.editedBody,\r\n                                editedAt: moment().toDate()\r\n                            }).then(function (comment) {\r\n                                scope.toggleEditCommentMode();\r\n                                return comment.data;\r\n                            })\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('focusOn', ['$timeout', function ($timeout) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function ($scope, $element, $attr) {\r\n                    $scope.$watch($attr.focusOn, function (_focusVal) {\r\n                        $timeout(function () {\r\n                            _focusVal ? $element.focus() :\r\n                                $element.blur();\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n        .directive('validateEmail', function () {\r\n            // var EMAIL_REGEXP = /^[_a-z0-9]+(\\.[_a-z0-9]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,5})$/;\r\n            var EMAIL_REGEXP = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n            // var EMAIL_REGEXP = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n            return {\r\n                require: 'ngModel',\r\n                restrict: '',\r\n                link: function (scope, elm, attrs, ctrl) {\r\n                    // only apply the validator if ngModel is present and Angular has added the email validator\r\n                    if (ctrl && ctrl.$validators.email) {\r\n\r\n                        // this will overwrite the default Angular email validator\r\n                        ctrl.$validators.email = function (modelValue) {\r\n                            return ctrl.$isEmpty(modelValue) || EMAIL_REGEXP.test(modelValue);\r\n                        };\r\n                    }\r\n                }\r\n            };\r\n        })\r\n        .directive('myEnter', function () {\r\n            return function (scope, element, attrs) {\r\n                element.bind(\"keydown keypress\", function (event) {\r\n                    if (event.which === 13) {\r\n                        scope.$apply(function () {\r\n                            scope.$eval(attrs.myEnter);\r\n                        });\r\n\r\n                        event.preventDefault();\r\n                    }\r\n                });\r\n            };\r\n        })\r\n        .directive('datepicker', ['$document', function ($document) {\r\n            return {\r\n                require: 'ngModel',\r\n                restrict: 'A',\r\n                scope: {format: \"=\"},\r\n                link: function (scope, el, attrs, ngModel) {\r\n                    var FIREFOX = /Firefox/i.test(navigator.userAgent);\r\n                    var IEXPLORER = $document.documentMode||false;\r\n\r\n                    if (FIREFOX || IEXPLORER) {\r\n                        jQuery(el).fdatepicker({format: scope.format || \"mm-dd-yyyy\"}).on('changeDate', function (ev) {\r\n                            scope.$apply(function () {\r\n                                ngModel.$setViewValue(ev.date);\r\n                            });\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }])\r\n        .directive('linkify', ['$filter', '$timeout', 'linkify', function ($filter, $timeout, linkify) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs) {\r\n                    var type = attrs.linkify || 'normal';\r\n                    $timeout(function () {\r\n                        element.html(linkify[type](element.html()));\r\n                    });\r\n                }\r\n            };\r\n        }])\r\n        .directive('broadstreetZone', ['$window', '$sce', function ($window, $sce) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/broadstreet-zone.html',\r\n                transclude: true,\r\n                scope: { \r\n                    zone: \"=\",\r\n                    width: \"=\",\r\n                    height: \"=\",\r\n                },\r\n                link: function (scope, el, attrs) {\r\n                    scope.link = $sce.trustAsResourceUrl('https://ad.broadstreetads.com/zdisplay/' + scope.zone + '.html');\r\n                }\r\n            }\r\n        }])\r\n        .directive('staticSideBar', ['$window', '$sce', function ($window, $sce) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'directives/static-sidebar.html',\r\n                transclude: true,\r\n                replace: true\r\n            }\r\n        }])\r\n        .directive('nonAngularRoutes', ['$window', '$rootElement', function ($window, $rootElement) {\r\n            return {\r\n                restrict: 'A',\r\n                // templateUrl: 'directives/static-sidebar.html',\r\n                // transclude: true,\r\n                link: function () {\r\n                    $rootElement.off('click');\r\n                }\r\n            }\r\n        }]);\r\n\r\n    angular.module('IndieWise.filters', [])\r\n        .filter('truncate', function () {\r\n            return function (text, length, end) {\r\n                if (angular.isString(text)) {\r\n                    if (isNaN(length))\r\n                        length = 10;\r\n\r\n                    if (end === undefined)\r\n                        end = \"...\";\r\n\r\n                    if (text.length <= length || text.length - end.length <= length) {\r\n                        return text;\r\n                    }\r\n                    else {\r\n                        return String(text).substring(0, length - end.length) + end;\r\n                    }\r\n                }\r\n            };\r\n        })\r\n        .filter('secondsToDateTime', [function () {\r\n            return function (seconds) {\r\n                return new Date(1970, 0, 1).setSeconds(seconds);\r\n            };\r\n        }])\r\n        .filter('linkify', function () {\r\n\r\n            function linkify(_str, type) {\r\n                if (!_str) {\r\n                    return;\r\n                }\r\n\r\n                var _text = _str.replace(/(?:https?\\:\\/\\/|www\\.)+(?![^\\s]*?\")([\\w.,@?!^=%&amp;:\\/~+#-]*[\\w@?!^=%&amp;\\/~+#-])?/ig, function (url) {\r\n                    var wrap = document.createElement('div');\r\n                    var anch = document.createElement('a');\r\n                    anch.href = url;\r\n                    anch.target = \"_blank\";\r\n                    anch.innerHTML = url;\r\n                    wrap.appendChild(anch);\r\n                    return wrap.innerHTML;\r\n                });\r\n\r\n                // bugfix\r\n                if (!_text) {\r\n                    return '';\r\n                }\r\n\r\n                // Twitter\r\n                if (type === 'twitter') {\r\n                    _text = _text.replace(/(|\\s)*@([\\u00C0-\\u1FFF\\w]+)/g, '$1<a href=\"https://twitter.com/$2\" target=\"_blank\">@$2</a>');\r\n                    _text = _text.replace(/(^|\\s)*#([\\u00C0-\\u1FFF\\w]+)/g, '$1<a href=\"https://twitter.com/search?q=%23$2\" target=\"_blank\">#$2</a>');\r\n                }\r\n\r\n\r\n                // Github\r\n                if (type === 'github') {\r\n                    _text = _text.replace(/(|\\s)*@(\\w+)/g, '$1<a href=\"https://github.com/$2\" target=\"_blank\">@$2</a>');\r\n                }\r\n\r\n                return _text;\r\n            }\r\n\r\n            //\r\n            return function (text, type) {\r\n                return linkify(text, type);\r\n            };\r\n        });\r\n        /*.filter('moment', function () {\r\n            return function (input, momentFn /!*, param1, param2, ...param n *!/) {\r\n                var args = Array.prototype.slice.call(arguments, 2),\r\n                    momentObj = moment(input);\r\n                return momentObj[momentFn].apply(momentObj, args);\r\n            };\r\n        })*/\r\n})();","(function () {\r\n    'use strict';\r\n    angular\r\n        .module('IndieWise.services', [])\r\n        .factory('FacebookAngularPatch', ['$q', '$timeout', '$window', function ($q, $timeout, $window) {\r\n\r\n            var fbApiAngular = function () {\r\n\r\n                var params = [].splice.call(arguments, 0);\r\n                var defer = $q.defer();\r\n                var angularWrap = $timeout;\r\n\r\n                $window.fbPromise.then(function () {\r\n\r\n                    // Pushing callback function that will resolve to the params array\r\n                    params.push(function (response) {\r\n                        if (!___.isUndefined(response.error)) {\r\n                            angularWrap(function () {\r\n                                defer.reject(response.error);\r\n                            });\r\n                            return;\r\n                        }\r\n\r\n                        angularWrap(function () {\r\n                            defer.resolve(response);\r\n                        });\r\n                    });\r\n\r\n                    FB.api.apply(FB, params);\r\n\r\n                });\r\n\r\n                return defer.promise;\r\n            };\r\n\r\n\r\n            // using the fbPromise we set up in index.html, we extend the FB SDK with FB.apiAngular\r\n            // now we use FB.apiAngular instead of FB.api, which gives us an angular wrapped promise\r\n            if (angular.isObject($window.FB)) {\r\n                $window.FB.init({\r\n                    appId: '150687055270744',\r\n                    status: true,\r\n                    cookie: true,\r\n                    xfbml: true,\r\n                    version: 'v2.7'\r\n                });\r\n\r\n                $window.FB.AppEvents.activateApp();\r\n\r\n                /*$window.fbPromise.then(function () {\r\n                    FB.apiAngular = fbApiAngular;\r\n                });*/\r\n            }\r\n\r\n            return fbApiAngular;\r\n        }])\r\n        .factory('AuthService', AuthService)\r\n        .factory('UserActions', UserActions)\r\n        .factory('DataService', DataService)\r\n        .factory('socket', ['$rootScope', '$window',function ($rootScope, $window) {\r\n            var socket = io($window.location.origin, {\r\n                'secure': true,\r\n                'reconnect': true,\r\n                'reconnection delay': 500,\r\n                'max reconnection attempts': 10\r\n            });\r\n            return {\r\n                on: function (eventName, callback) {\r\n                    socket.on(eventName, function () {\r\n                        var args = arguments;\r\n                        $rootScope.$apply(function () {\r\n                            callback.apply(socket, args);\r\n                        });\r\n                    });\r\n                },\r\n                emit: function (eventName, data, callback) {\r\n                    socket.emit(eventName, data, function () {\r\n                        var args = arguments;\r\n                        $rootScope.$apply(function () {\r\n                            if (callback) {\r\n                                callback.apply(socket, args);\r\n                            }\r\n                        });\r\n                    })\r\n                }\r\n            };\r\n        }])\r\n        .factory('linkify', ['$filter', function ($filter) {\r\n            function _linkifyAsType(type) {\r\n                return function (str) {\r\n                    // (type, str);\r\n                    return $filter('linkify')(str, type);\r\n                };\r\n            }\r\n\r\n            return {\r\n                twitter: _linkifyAsType('twitter'),\r\n                github: _linkifyAsType('github'),\r\n                normal: _linkifyAsType()\r\n            };\r\n        }])\r\n        .service('anchorSmoothScroll', function(){\r\n\r\n            this.scrollTo = function(eID) {\r\n\r\n                // This scrolling function\r\n                // is from http://www.itnewb.com/tutorial/Creating-the-Smooth-Scroll-Effect-with-JavaScript\r\n\r\n                var startY = currentYPosition();\r\n                var stopY = elmYPosition(eID);\r\n                var distance = stopY > startY ? stopY - startY : startY - stopY;\r\n                if (distance < 100) {\r\n                    scrollTo(0, stopY); return;\r\n                }\r\n                var speed = Math.round(distance / 100);\r\n                if (speed >= 20) speed = 20;\r\n                var step = Math.round(distance / 25);\r\n                var leapY = stopY > startY ? startY + step : startY - step;\r\n                var timer = 0;\r\n                if (stopY > startY) {\r\n                    for ( var i=startY; i<stopY; i+=step ) {\r\n                        setTimeout(\"window.scrollTo(0, \"+leapY+\")\", timer * speed);\r\n                        leapY += step; if (leapY > stopY) leapY = stopY; timer++;\r\n                    } return;\r\n                }\r\n                for ( var i=startY; i>stopY; i-=step ) {\r\n                    setTimeout(\"window.scrollTo(0, \"+leapY+\")\", timer * speed);\r\n                    leapY -= step; if (leapY < stopY) leapY = stopY; timer++;\r\n                }\r\n\r\n                function currentYPosition() {\r\n                    // Firefox, Chrome, Opera, Safari\r\n                    if (self.pageYOffset) return self.pageYOffset;\r\n                    // Internet Explorer 6 - standards mode\r\n                    if (document.documentElement && document.documentElement.scrollTop)\r\n                        return document.documentElement.scrollTop;\r\n                    // Internet Explorer 6, 7 and 8\r\n                    if (document.body.scrollTop) return document.body.scrollTop;\r\n                    return 0;\r\n                }\r\n\r\n                function elmYPosition(eID) {\r\n                    var elm = document.getElementById(eID);\r\n                    var y = elm.offsetTop;\r\n                    var node = elm;\r\n                    while (node.offsetParent && node.offsetParent != document.body) {\r\n                        node = node.offsetParent;\r\n                        y += node.offsetTop;\r\n                    } return y;\r\n                }\r\n\r\n            };\r\n\r\n        });\r\n\r\n    UserActions.$inject = ['$rootScope', '$q', 'AuthService', 'DataService', 'UtilsService', '$timeout', '$modal', '$mdMedia'];\r\n    function UserActions($rootScope, $q, AuthService, DataService, UtilsService, $timeout, $modal, $mdMedia) {\r\n        var service = {\r\n            checkAuth: function () {\r\n                var deferred = $q.defer();\r\n                AuthService.isAuthenticated() ? deferred.resolve(true) : deferred.reject(false);\r\n                return deferred.promise;\r\n            },\r\n            markAsWatched: function (video) {\r\n                // Set as watched when user has watched 20% for the video's runtime or 6 seconds\r\n                var time = 0;// (video.attributes.runTime * 200) || 6000;\r\n                return $timeout(function () {\r\n                    //console.log('Marked as Watched');\r\n                    DataService.save('projects/watched', {\r\n                        project_id: video.id\r\n                    });\r\n                }, time);\r\n            },\r\n            cancelWatched: function (promise) {\r\n                $timeout.cancel(promise);\r\n            },\r\n            canCritique: function (filmId) {\r\n                var deferred = $q.defer();\r\n                if (AuthService.isAuthenticated()) {\r\n                    DataService.collection('critiques', {project: filmId, user: AuthService.currentUser.id})\r\n                        .then(function (res) {\r\n                            res.data.data.length\r\n                                // critique exists already from this user\r\n                                ? deferred.reject(res.data.data[0])\r\n                                // user hasn't critiqued yet\r\n                                : deferred.resolve(true);\r\n                        });\r\n                } else {\r\n                    deferred.reject(false);\r\n                }\r\n                return deferred.promise;\r\n            },\r\n            canReact: function (filmId) {\r\n                var deferred = $q.defer();\r\n                if (AuthService.currentUser) {\r\n                    DataService.collection('reactions', {project: filmId, user: AuthService.currentUser.id})\r\n                        .then(function (res) {\r\n                            res.data.data.length\r\n                                // critique exists already from this user\r\n                                ? deferred.reject(res.data.data[0])\r\n                                // user hasn't critiqued yet\r\n                                : deferred.resolve(true);\r\n                        });\r\n                } else {\r\n                    deferred.reject(false);\r\n                }\r\n                return deferred.promise;\r\n            },\r\n            canRate: function (filmId) {\r\n                var deferred = $q.defer();\r\n                if (AuthService.currentUser) {\r\n                    DataService.collection('ratings', {project: filmId, user: AuthService.currentUser.id})\r\n                        .then(function (res) {\r\n                            res.data.ratings.length\r\n                                // critique exists already from this user\r\n                                ? deferred.reject(res.data.ratings[0])\r\n                                // user hasn't critiqued yet\r\n                                : deferred.resolve(true);\r\n                        });\r\n                } else {\r\n                    deferred.reject(false);\r\n                }\r\n                return deferred.promise;\r\n            },\r\n            loginModal: function () {\r\n                if (!$rootScope.authModalOpen) {\r\n                    var options = {\r\n                        controller: SignInModalCtrl,\r\n                        controllerAs: 'SIC',\r\n                        templateUrl: 'auth/sign-in-dialog.html',\r\n                        size: Foundation.MediaQuery.atLeast('medium') ? 'large' : 'full'\r\n                    };\r\n\r\n                    var modalInstance = $modal.open(options);\r\n                    modalInstance.result.then(function (answer) {\r\n                        console.log(answer);\r\n                        $rootScope.authModalOpen = false;\r\n                        zIndexPlayer(true);\r\n                    }, function () {\r\n                        console.log('You cancelled the dialog.');\r\n                        $rootScope.authModalOpen = false;\r\n                        zIndexPlayer(true);\r\n                    });\r\n                    $rootScope.authModalOpen = true;\r\n                }\r\n            }\r\n        };\r\n        return service;\r\n    }\r\n\r\n    AuthService.$inject = ['$rootScope', '$q', '$state', '$http', 'DataService', '$auth', 'API'];\r\n    function AuthService($rootScope, $q, $state, $http, DataService, $auth, API) {\r\n        /**\r\n         *\r\n         * @returns {*}\r\n         */\r\n\r\n\r\n        var service = {\r\n            /**\r\n             *\r\n             * @param _userParams\r\n             */\r\n            createUser: function (_userParams) {\r\n\r\n                var user = {\r\n                    email: _userParams.email,\r\n                    password: _userParams.password,\r\n                    password_confirmation:_userParams.passwordCheck,\r\n                    username: _userParams.email,\r\n                    firstName: _userParams.firstName,\r\n                    lastName: _userParams.lastName,\r\n                    fullName: _userParams.firstName + ' ' + _userParams.lastName,\r\n                    country_id: _userParams.country,\r\n                    dob: _userParams.dob,\r\n                    gender: _userParams.gender,\r\n                };\r\n\r\n                return $auth.signup(user)\r\n                    .then(function (userData) {\r\n                        service.error = '';\r\n                        console.log('User ' + userData.username + ' created successfully!');\r\n                        return service.login(_userParams.email, _userParams.password).then(function (res) {\r\n                            console.log(res);\r\n                            service.getCurrentUser().then(function (res) {\r\n                                console.log(res);\r\n                                $state.go('profile.about');\r\n                            });\r\n                        });\r\n                    })\r\n                    .catch(function (error) {\r\n                        return {\r\n                            status: false,\r\n                            errors: service.error = error.data.errors || 'Unknown error from server'\r\n                        };\r\n                    });\r\n            },\r\n            /**\r\n             *\r\n             * @param _userParams\r\n             */\r\n            updateUser: function (_userParams) {\r\n                return DataService.update('users/me', _userParams.id, _userParams).then(function (response) {\r\n                    return response;\r\n                }).catch(function (error) {\r\n                    console.log(error);\r\n                    return error;\r\n                });\r\n            },\r\n            /**\r\n             *\r\n             * @param _userParams\r\n             */\r\n            deleteUser: function (_userParams) {\r\n                return DataService.delete('users/me/' + _userParams.id).then(function (response) {\r\n                    return response;\r\n                });\r\n            },\r\n            /**\r\n             *\r\n             * @param _userParams\r\n             */\r\n            requestVerification: function () {\r\n                return DataService.collection('request_verification').then(function (response) {\r\n                    return response;\r\n                });\r\n            },\r\n            /**\r\n             *\r\n             * @param Back&\r\n             * @returns {Promise}\r\n             */\r\n            currentUser: null,\r\n            getCurrentUser: function (force) {\r\n                var deferred = $q.defer();\r\n                if(service.isAuthenticated()) {\r\n                    if (!angular.isObject(service.currentUser)) {\r\n                        $http.get(API + 'authenticate').then(function (response) {\r\n                            deferred.resolve($rootScope.AppData.User = service.currentUser = response.data.user);\r\n                        });\r\n                    } else {\r\n                        deferred.resolve(service.currentUser);\r\n                    }\r\n                } else {\r\n                    deferred.reject(false);\r\n                }\r\n                return deferred.promise;\r\n\r\n            },\r\n            /**\r\n             *\r\n             * @param _user\r\n             * @param _password\r\n             * @returns {Promise}\r\n             */\r\n            login: function (_user, _password) {\r\n                return $auth.login({ email: _user, password: _password })\r\n                    .then(function (response) {\r\n                        if (response.status === 200) {\r\n                            $http.defaults.headers.common.Authorization = 'Bearer ' + response.data.token;\r\n                            $auth.setToken(response.data.token);\r\n                            service.getCurrentUser();\r\n                            return true;\r\n                        } else {\r\n                            return {\r\n                                status: false,\r\n                                errors: service.error = { credentials: ['Invalid email or password']}\r\n                            };\r\n                        }\r\n                    })\r\n                    .catch(function(response) {\r\n                        // Handle errors here, such as displaying a notification\r\n                        // for invalid email and/or password.\r\n                        console.log(response);\r\n                        return {\r\n                            status: false,\r\n                            errors: service.error = response.data.errors || 'Unknown error from server'\r\n                        };\r\n                    });\r\n            },\r\n            socialLogin: function (provider, isModal) {\r\n                isModal = isModal || false;\r\n                return $auth.authenticate(provider)\r\n                    .then(function(response) {\r\n                        // console.log(response.data);\r\n                        service.getCurrentUser().then(function (user) {\r\n                            self.error = '';\r\n                            if (!isModal) {\r\n                                if (moment(user.created_at).isSame(moment(), 'hour')) {\r\n                                    console.log('User ' + user.fullName + ' created successfully!');\r\n                                    $state.go('profile.about');\r\n                                } else {\r\n                                    if($rootScope.$stateParams.redirect) {\r\n                                        return window.location.href = $rootScope.$stateParams.redirect;\r\n                                    };\r\n                                    $state.go('home');\r\n                                }\r\n                            } else {\r\n                                return user;\r\n                            }\r\n                        });\r\n                    })\r\n                    .catch(function(response) {\r\n                        return {\r\n                            status: false,\r\n                            errors: service.error = response.data.errors || 'Unknown error from server'\r\n                        };\r\n                    });\r\n            },\r\n            /**\r\n             *\r\n             * @returns {Promise}\r\n             */\r\n            logout: function () {\r\n                //var deferred = $q.defer();\r\n                return $http.post(API + 'logout', null).then(function () {\r\n                    $auth.removeToken();\r\n                    $auth.logout();\r\n                    // localStorage.removeItem('User');\r\n                    // $rootScope.AppData.User = undefined;\r\n                    //deferred.resolve(true);\r\n                });\r\n                //return deferred.promise;\r\n            },\r\n            /**\r\n             *\r\n             * @param email\r\n             * @returns {Promise}\r\n             */\r\n            requestPasswordReset: function (email) {\r\n                return $http.post(API + 'requestPasswordReset', {email: email}).then(function (res) {\r\n                    console.log(res);\r\n                    return res;\r\n                }, function (error) {\r\n                    //console.log(error);\r\n                    return error;\r\n                });\r\n            },\r\n            passwordReset: function (email, password, password_confirmation,token) {\r\n                return $http.post(API + 'resetPassword', {email: email, password: password, password_confirmation: password_confirmation, token: token})\r\n                    .then(function (res) {\r\n                        console.log(res);\r\n                        $state.go('sign_in');\r\n                        return res;\r\n                    }, function (error) {\r\n                        //console.log(error);\r\n                        return error;\r\n                    });\r\n            },\r\n            parseJwt: function(token) {\r\n                var base64Url = token.split('.')[1];\r\n                var base64 = base64Url.replace('-', '+').replace('_', '/');\r\n                return JSON.parse(atob(base64));\r\n            },\r\n            isAuthenticated: function() {\r\n                //var params = $auth.getPayload();\r\n                //console.log(params);\r\n                return $auth.isAuthenticated();\r\n            }\r\n        };\r\n\r\n        function _init() {\r\n            service.getCurrentUser();\r\n        }\r\n\r\n        _init();\r\n        return service;\r\n    }\r\n\r\n    DataService.$inject = ['$http', 'API'];\r\n    function DataService($http, API) {\r\n        var vm = this;\r\n\r\n        vm.collection = function (name, params) {\r\n            var data = angular.extend({per_page: 10, page: 1}, params);\r\n            return $http({\r\n                method: 'GET',\r\n                url: API + name,\r\n                params: data\r\n            });\r\n        };\r\n        vm.item = function (name, id, include, search) {\r\n            return $http({\r\n                method: 'GET',\r\n                url: API + name + '/' + id,\r\n                params: {\r\n                    include: include,\r\n                    search: search\r\n                }\r\n            });\r\n        };\r\n        vm.save = function (name, data, params) {\r\n            return $http({\r\n                method: 'POST',\r\n                url: API + name,\r\n                params: params,\r\n                data: data\r\n            });\r\n        };\r\n        vm.update = function (name, id, data, params) {\r\n            return $http({\r\n                method: 'PUT',\r\n                url: API + name + '/' + id,\r\n                params: params,\r\n                data: data\r\n            });\r\n        };\r\n        vm.delete = function (name, id) {\r\n            return $http({\r\n                method: 'DELETE',\r\n                url: API + name + '/' + id\r\n            });\r\n        };\r\n        vm.mail = function (route, params) {\r\n            return $http.post(API + route, params);\r\n        };\r\n\r\n\r\n        // Newsletter Form\r\n        vm.notifyMe = function (params) {\r\n            return $http.post('utils/notify-me.php', params);\r\n        };\r\n\r\n        return vm;\r\n    }\r\n\r\n    SignInModalCtrl.$inject = ['$rootScope', '$timeout', 'AuthService', '$modalInstance'];\r\n    function SignInModalCtrl($rootScope, $timeout, AuthService, $modalInstance) {\r\n        zIndexPlayer();\r\n        $rootScope.metadata.title = 'Sign In';\r\n        var self = this;\r\n        self.user = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        self.doLogin = function (redirect) {\r\n            redirect = redirect || true;\r\n            self.error = false;\r\n            AuthService.login(self.user.email, self.user.password).then(function (res) {\r\n                console.log('Success', res);\r\n                if (redirect) {\r\n                    //$state.go('home');\r\n                    //window.location.reload();\r\n                }\r\n            }, function (res) {\r\n                self.error = res;\r\n                console.log('Failed', res);\r\n            }).then(function () {\r\n                self.ok();\r\n            });\r\n        };\r\n\r\n\r\n        self.authenticate = function (provider) {\r\n            self.error = null;\r\n            AuthService.socialLogin(provider, true).then(function (a) {\r\n                console.log(a);\r\n                self.ok();\r\n            });\r\n        };\r\n\r\n        self.ok = function () {\r\n            $modalInstance.close();\r\n        };\r\n\r\n        self.cancel = function () {\r\n            $modalInstance.dismiss('cancel');\r\n        };\r\n\r\n        $timeout(function () {\r\n            jQuery(document).foundation();\r\n            $timeout(function () {\r\n                jQuery(document).foundation();\r\n            }, 500);\r\n        }, 0);\r\n    }\r\n\r\n    function zIndexPlayer(remove) {\r\n        var vidDiv = jQuery('.flex-video');\r\n        if (vidDiv) {\r\n            !!remove ? vidDiv.css('z-index', '') : vidDiv.css('z-index', 0);\r\n        }\r\n    }\r\n\r\n})();\r\n\r\n","/**\r\n * Utility Functions\r\n * Created by Jerez on 11/8/2015.\r\n */\r\nangular.module('IndieWise.utilities', [])\r\n.factory('UtilsService',  ['$rootScope', '$window', 'DataService', function ($rootScope, $window, DataService) {\r\n        'use strict';\r\n        return {\r\n            compressArray: function (original) {\r\n                var compressed = [];\r\n                // make a copy of the input array\r\n                var copy = original.slice(0);\r\n\r\n                // first loop goes over every element\r\n                for (var i = 0; i < original.length; i++) {\r\n\r\n                    var myCount = 0;\r\n                    // loop over every element in the copy and see if it's the same\r\n                    for (var w = 0; w < copy.length; w++) {\r\n                        if (original[i] == copy[w]) {\r\n                            // increase amount of times duplicate is found\r\n                            myCount++;\r\n                            // sets item to undefined\r\n                            delete copy[w];\r\n                        }\r\n                    }\r\n\r\n                    if (myCount > 0) {\r\n                        var a = new Object();\r\n                        a.value = original[i];\r\n                        a.count = myCount;\r\n                        compressed.push(a);\r\n                    }\r\n                }\r\n\r\n                return compressed;\r\n            },\r\n            parseJwt: function(token) {\r\n                var base64Url = token.split('.')[1];\r\n                var base64 = base64Url.replace('-', '+').replace('_', '/');\r\n                return JSON.parse($window.atob(base64));\r\n            }\r\n        }\r\n    }]);\r\n\r\nif (!String.prototype.endsWith) {\r\n    String.prototype.endsWith = function(searchString, position) {\r\n        var subjectString = this.toString();\r\n        if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {\r\n            position = subjectString.length;\r\n        }\r\n        position -= searchString.length;\r\n        var lastIndex = subjectString.indexOf(searchString, position);\r\n        return lastIndex !== -1 && lastIndex === position;\r\n    };\r\n}\r\n\r\n/**\r\n *  @function String.reverse\r\n *  @description Reverse a string\r\n *  @return string\r\n **/\r\nString.prototype.reverse = function(){\r\n    return this.split('').reverse().join('');\r\n};\r\n"],"sourceRoot":"/source/"}